var t=Object.defineProperty;import{P as e,p as i}from"./phaser-o_ujPeV6.js";function s(t,e){const i=new Set(t.split(","));return e?t=>i.has(t.toLowerCase()):t=>i.has(t)}!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const o={},n=[],r=()=>{},a=()=>!1,l=t=>111===t.charCodeAt(0)&&110===t.charCodeAt(1)&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),c=t=>t.startsWith("onUpdate:"),h=Object.assign,m=(t,e)=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)},u=Object.prototype.hasOwnProperty,_=(t,e)=>u.call(t,e),p=Array.isArray,d=t=>"[object Map]"===B(t),y=t=>"[object Set]"===B(t),f=t=>"function"==typeof t,v=t=>"string"==typeof t,g=t=>"symbol"==typeof t,x=t=>null!==t&&"object"==typeof t,b=t=>(x(t)||f(t))&&f(t.then)&&f(t.catch),A=Object.prototype.toString,B=t=>A.call(t),w=t=>B(t).slice(8,-1),V=t=>"[object Object]"===B(t),C=t=>v(t)&&"NaN"!==t&&"-"!==t[0]&&""+parseInt(t,10)===t,S=s(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),M=t=>{const e=Object.create(null);return i=>e[i]||(e[i]=t(i))},P=/-(\w)/g,z=M((t=>t.replace(P,((t,e)=>e?e.toUpperCase():"")))),I=/\B([A-Z])/g,F=M((t=>t.replace(I,"-$1").toLowerCase())),T=M((t=>t.charAt(0).toUpperCase()+t.slice(1))),L=M((t=>t?`on${T(t)}`:"")),k=(t,e)=>!Object.is(t,e),q=(t,e)=>{for(let i=0;i<t.length;i++)t[i](e)},N=(t,e,i)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:i})},D=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let O;const j=()=>O||(O="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{});function R(t){if(p(t)){const e={};for(let i=0;i<t.length;i++){const s=t[i],o=v(s)?W(s):R(s);if(o)for(const t in o)e[t]=o[t]}return e}if(v(t)||x(t))return t}const E=/;(?![^(]*\))/g,Y=/:([^]+)/,J=/\/\*[^]*?\*\//g;function W(t){const e={};return t.replace(J,"").split(E).forEach((t=>{if(t){const i=t.split(Y);i.length>1&&(e[i[0].trim()]=i[1].trim())}})),e}function U(t){let e="";if(v(t))e=t;else if(p(t))for(let i=0;i<t.length;i++){const s=U(t[i]);s&&(e+=s+" ")}else if(x(t))for(const i in t)t[i]&&(e+=i+" ");return e.trim()}const H=s("itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly");function G(t){return!!t||""===t}let X,K;class Z{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this.parent=X,!t&&X&&(this.index=(X.scopes||(X.scopes=[])).push(this)-1)}get active(){return this._active}run(t){if(this._active){const e=X;try{return X=this,t()}finally{X=e}}}on(){X=this}off(){X=this.parent}stop(t){if(this._active){let e,i;for(e=0,i=this.effects.length;e<i;e++)this.effects[e].stop();for(e=0,i=this.cleanups.length;e<i;e++)this.cleanups[e]();if(this.scopes)for(e=0,i=this.scopes.length;e<i;e++)this.scopes[e].stop(!0);if(!this.detached&&this.parent&&!t){const t=this.parent.scopes.pop();t&&t!==this&&(this.parent.scopes[this.index]=t,t.index=this.index)}this.parent=void 0,this._active=!1}}}class ${constructor(t,e,i,s){this.fn=t,this.trigger=e,this.scheduler=i,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,function(t,e=X){e&&e.active&&e.effects.push(t)}(this,s)}get dirty(){if(2===this._dirtyLevel||3===this._dirtyLevel){this._dirtyLevel=1,nt();for(let t=0;t<this._depsLength;t++){const e=this.deps[t];if(e.computed&&(e.computed.value,this._dirtyLevel>=4))break}1===this._dirtyLevel&&(this._dirtyLevel=0),rt()}return this._dirtyLevel>=4}set dirty(t){this._dirtyLevel=t?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let t=it,e=K;try{return it=!0,K=this,this._runnings++,Q(this),this.fn()}finally{tt(this),this._runnings--,K=e,it=t}}stop(){var t;this.active&&(Q(this),tt(this),null==(t=this.onStop)||t.call(this),this.active=!1)}}function Q(t){t._trackId++,t._depsLength=0}function tt(t){if(t.deps.length>t._depsLength){for(let e=t._depsLength;e<t.deps.length;e++)et(t.deps[e],t);t.deps.length=t._depsLength}}function et(t,e){const i=t.get(e);void 0!==i&&e._trackId!==i&&(t.delete(e),0===t.size&&t.cleanup())}let it=!0,st=0;const ot=[];function nt(){ot.push(it),it=!1}function rt(){const t=ot.pop();it=void 0===t||t}function at(){st++}function lt(){for(st--;!st&&ht.length;)ht.shift()()}function ct(t,e,i){if(e.get(t)!==t._trackId){e.set(t,t._trackId);const i=t.deps[t._depsLength];i!==e?(i&&et(i,t),t.deps[t._depsLength++]=e):t._depsLength++}}const ht=[];function mt(t,e,i){at();for(const s of t.keys()){let i;s._dirtyLevel<e&&(null!=i?i:i=t.get(s)===s._trackId)&&(s._shouldSchedule||(s._shouldSchedule=0===s._dirtyLevel),s._dirtyLevel=e),s._shouldSchedule&&(null!=i?i:i=t.get(s)===s._trackId)&&(s.trigger(),s._runnings&&!s.allowRecurse||2===s._dirtyLevel||(s._shouldSchedule=!1,s.scheduler&&ht.push(s.scheduler)))}lt()}const ut=(t,e)=>{const i=new Map;return i.cleanup=t,i.computed=e,i},_t=new WeakMap,pt=Symbol(""),dt=Symbol("");function yt(t,e,i){if(it&&K){let e=_t.get(t);e||_t.set(t,e=new Map);let s=e.get(i);s||e.set(i,s=ut((()=>e.delete(i)))),ct(K,s)}}function ft(t,e,i,s,o,n){const r=_t.get(t);if(!r)return;let a=[];if("clear"===e)a=[...r.values()];else if("length"===i&&p(t)){const t=Number(s);r.forEach(((e,i)=>{("length"===i||!g(i)&&i>=t)&&a.push(e)}))}else switch(void 0!==i&&a.push(r.get(i)),e){case"add":p(t)?C(i)&&a.push(r.get("length")):(a.push(r.get(pt)),d(t)&&a.push(r.get(dt)));break;case"delete":p(t)||(a.push(r.get(pt)),d(t)&&a.push(r.get(dt)));break;case"set":d(t)&&a.push(r.get(pt))}at();for(const l of a)l&&mt(l,4);lt()}const vt=s("__proto__,__v_isRef,__isVue"),gt=new Set(Object.getOwnPropertyNames(Symbol).filter((t=>"arguments"!==t&&"caller"!==t)).map((t=>Symbol[t])).filter(g)),xt=bt();function bt(){const t={};return["includes","indexOf","lastIndexOf"].forEach((e=>{t[e]=function(...t){const i=ae(this);for(let e=0,o=this.length;e<o;e++)yt(i,0,e+"");const s=i[e](...t);return-1===s||!1===s?i[e](...t.map(ae)):s}})),["push","pop","shift","unshift","splice"].forEach((e=>{t[e]=function(...t){nt(),at();const i=ae(this)[e].apply(this,t);return lt(),rt(),i}})),t}function At(t){const e=ae(this);return yt(e,0,t),e.hasOwnProperty(t)}class Bt{constructor(t=!1,e=!1){this._isReadonly=t,this._isShallow=e}get(t,e,i){const s=this._isReadonly,o=this._isShallow;if("__v_isReactive"===e)return!s;if("__v_isReadonly"===e)return s;if("__v_isShallow"===e)return o;if("__v_raw"===e)return i===(s?o?Qt:$t:o?Zt:Kt).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(i)?t:void 0;const n=p(t);if(!s){if(n&&_(xt,e))return Reflect.get(xt,e,i);if("hasOwnProperty"===e)return At}const r=Reflect.get(t,e,i);return(g(e)?gt.has(e):vt(e))?r:(s||yt(t,0,e),o?r:pe(r)?n&&C(e)?r:r.value:x(r)?s?ee(r):te(r):r)}}class wt extends Bt{constructor(t=!1){super(!1,t)}set(t,e,i,s){let o=t[e];if(!this._isShallow){const e=oe(o);if(ne(i)||oe(i)||(o=ae(o),i=ae(i)),!p(t)&&pe(o)&&!pe(i))return!e&&(o.value=i,!0)}const n=p(t)&&C(e)?Number(e)<t.length:_(t,e),r=Reflect.set(t,e,i,s);return t===ae(s)&&(n?k(i,o)&&ft(t,"set",e,i):ft(t,"add",e,i)),r}deleteProperty(t,e){const i=_(t,e);t[e];const s=Reflect.deleteProperty(t,e);return s&&i&&ft(t,"delete",e,void 0),s}has(t,e){const i=Reflect.has(t,e);return g(e)&&gt.has(e)||yt(t,0,e),i}ownKeys(t){return yt(t,0,p(t)?"length":pt),Reflect.ownKeys(t)}}class Vt extends Bt{constructor(t=!1){super(!0,t)}set(t,e){return!0}deleteProperty(t,e){return!0}}const Ct=new wt,St=new Vt,Mt=new wt(!0),Pt=t=>t,zt=t=>Reflect.getPrototypeOf(t);function It(t,e,i=!1,s=!1){const o=ae(t=t.__v_raw),n=ae(e);i||(k(e,n)&&yt(o,0,e),yt(o,0,n));const{has:r}=zt(o),a=s?Pt:i?he:ce;return r.call(o,e)?a(t.get(e)):r.call(o,n)?a(t.get(n)):void(t!==o&&t.get(e))}function Ft(t,e=!1){const i=this.__v_raw,s=ae(i),o=ae(t);return e||(k(t,o)&&yt(s,0,t),yt(s,0,o)),t===o?i.has(t):i.has(t)||i.has(o)}function Tt(t,e=!1){return t=t.__v_raw,!e&&yt(ae(t),0,pt),Reflect.get(t,"size",t)}function Lt(t){t=ae(t);const e=ae(this);return zt(e).has.call(e,t)||(e.add(t),ft(e,"add",t,t)),this}function kt(t,e){e=ae(e);const i=ae(this),{has:s,get:o}=zt(i);let n=s.call(i,t);n||(t=ae(t),n=s.call(i,t));const r=o.call(i,t);return i.set(t,e),n?k(e,r)&&ft(i,"set",t,e):ft(i,"add",t,e),this}function qt(t){const e=ae(this),{has:i,get:s}=zt(e);let o=i.call(e,t);o||(t=ae(t),o=i.call(e,t)),s&&s.call(e,t);const n=e.delete(t);return o&&ft(e,"delete",t,void 0),n}function Nt(){const t=ae(this),e=0!==t.size,i=t.clear();return e&&ft(t,"clear",void 0,void 0),i}function Dt(t,e){return function(i,s){const o=this,n=o.__v_raw,r=ae(n),a=e?Pt:t?he:ce;return!t&&yt(r,0,pt),n.forEach(((t,e)=>i.call(s,a(t),a(e),o)))}}function Ot(t,e,i){return function(...s){const o=this.__v_raw,n=ae(o),r=d(n),a="entries"===t||t===Symbol.iterator&&r,l="keys"===t&&r,c=o[t](...s),h=i?Pt:e?he:ce;return!e&&yt(n,0,l?dt:pt),{next(){const{value:t,done:e}=c.next();return e?{value:t,done:e}:{value:a?[h(t[0]),h(t[1])]:h(t),done:e}},[Symbol.iterator](){return this}}}}function jt(t){return function(...e){return"delete"!==t&&("clear"===t?void 0:this)}}function Rt(){const t={get(t){return It(this,t)},get size(){return Tt(this)},has:Ft,add:Lt,set:kt,delete:qt,clear:Nt,forEach:Dt(!1,!1)},e={get(t){return It(this,t,!1,!0)},get size(){return Tt(this)},has:Ft,add:Lt,set:kt,delete:qt,clear:Nt,forEach:Dt(!1,!0)},i={get(t){return It(this,t,!0)},get size(){return Tt(this,!0)},has(t){return Ft.call(this,t,!0)},add:jt("add"),set:jt("set"),delete:jt("delete"),clear:jt("clear"),forEach:Dt(!0,!1)},s={get(t){return It(this,t,!0,!0)},get size(){return Tt(this,!0)},has(t){return Ft.call(this,t,!0)},add:jt("add"),set:jt("set"),delete:jt("delete"),clear:jt("clear"),forEach:Dt(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach((o=>{t[o]=Ot(o,!1,!1),i[o]=Ot(o,!0,!1),e[o]=Ot(o,!1,!0),s[o]=Ot(o,!0,!0)})),[t,i,e,s]}const[Et,Yt,Jt,Wt]=Rt();function Ut(t,e){const i=e?t?Wt:Jt:t?Yt:Et;return(e,s,o)=>"__v_isReactive"===s?!t:"__v_isReadonly"===s?t:"__v_raw"===s?e:Reflect.get(_(i,s)&&s in e?i:e,s,o)}const Ht={get:Ut(!1,!1)},Gt={get:Ut(!1,!0)},Xt={get:Ut(!0,!1)},Kt=new WeakMap,Zt=new WeakMap,$t=new WeakMap,Qt=new WeakMap;function te(t){return oe(t)?t:ie(t,!1,Ct,Ht,Kt)}function ee(t){return ie(t,!0,St,Xt,$t)}function ie(t,e,i,s,o){if(!x(t))return t;if(t.__v_raw&&(!e||!t.__v_isReactive))return t;const n=o.get(t);if(n)return n;const r=(a=t).__v_skip||!Object.isExtensible(a)?0:function(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(w(a));var a;if(0===r)return t;const l=new Proxy(t,2===r?s:i);return o.set(t,l),l}function se(t){return oe(t)?se(t.__v_raw):!(!t||!t.__v_isReactive)}function oe(t){return!(!t||!t.__v_isReadonly)}function ne(t){return!(!t||!t.__v_isShallow)}function re(t){return se(t)||oe(t)}function ae(t){const e=t&&t.__v_raw;return e?ae(e):t}function le(t){return Object.isExtensible(t)&&N(t,"__v_skip",!0),t}const ce=t=>x(t)?te(t):t,he=t=>x(t)?ee(t):t;class me{constructor(t,e,i,s){this.getter=t,this._setter=e,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new $((()=>t(this._value)),(()=>_e(this,2===this.effect._dirtyLevel?2:3))),this.effect.computed=this,this.effect.active=this._cacheable=!s,this.__v_isReadonly=i}get value(){const t=ae(this);return t._cacheable&&!t.effect.dirty||!k(t._value,t._value=t.effect.run())||_e(t,4),ue(t),t.effect._dirtyLevel>=2&&_e(t,2),t._value}set value(t){this._setter(t)}get _dirty(){return this.effect.dirty}set _dirty(t){this.effect.dirty=t}}function ue(t){var e;it&&K&&(t=ae(t),ct(K,null!=(e=t.dep)?e:t.dep=ut((()=>t.dep=void 0),t instanceof me?t:void 0)))}function _e(t,e=4,i){const s=(t=ae(t)).dep;s&&mt(s,e)}function pe(t){return!(!t||!0!==t.__v_isRef)}function de(t){return pe(e=t)?e:new ye(e,!1);var e}class ye{constructor(t,e){this.__v_isShallow=e,this.dep=void 0,this.__v_isRef=!0,this._rawValue=e?t:ae(t),this._value=e?t:ce(t)}get value(){return ue(this),this._value}set value(t){const e=this.__v_isShallow||ne(t)||oe(t);t=e?t:ae(t),k(t,this._rawValue)&&(this._rawValue=t,this._value=e?t:ce(t),_e(this,4))}}const fe={get:(t,e,i)=>{return pe(s=Reflect.get(t,e,i))?s.value:s;var s},set:(t,e,i,s)=>{const o=t[e];return pe(o)&&!pe(i)?(o.value=i,!0):Reflect.set(t,e,i,s)}};function ve(t){return se(t)?t:new Proxy(t,fe)}function ge(t,e,i,s){try{return s?t(...s):t()}catch(o){be(o,e,i)}}function xe(t,e,i,s){if(f(t)){const o=ge(t,e,i,s);return o&&b(o)&&o.catch((t=>{be(t,e,i)})),o}const o=[];for(let n=0;n<t.length;n++)o.push(xe(t[n],e,i,s));return o}function be(t,e,i,s=!0){if(e&&e.vnode,e){let s=e.parent;const o=e.proxy,n=`https://vuejs.org/error-reference/#runtime-${i}`;for(;s;){const e=s.ec;if(e)for(let i=0;i<e.length;i++)if(!1===e[i](t,o,n))return;s=s.parent}const r=e.appContext.config.errorHandler;if(r)return void ge(r,null,10,[t,o,n])}!function(t,e,i,s=!0){console.error(t)}(t,0,0,s)}let Ae=!1,Be=!1;const we=[];let Ve=0;const Ce=[];let Se=null,Me=0;const Pe=Promise.resolve();let ze=null;function Ie(t){const e=ze||Pe;return t?e.then(this?t.bind(this):t):e}function Fe(t){we.length&&we.includes(t,Ae&&t.allowRecurse?Ve+1:Ve)||(null==t.id?we.push(t):we.splice(function(t){let e=Ve+1,i=we.length;for(;e<i;){const s=e+i>>>1,o=we[s],n=qe(o);n<t||n===t&&o.pre?e=s+1:i=s}return e}(t.id),0,t),Te())}function Te(){Ae||Be||(Be=!0,ze=Pe.then(De))}function Le(t,e,i=(Ae?Ve+1:0)){for(;i<we.length;i++){const e=we[i];if(e&&e.pre){if(t&&e.id!==t.uid)continue;we.splice(i,1),i--,e()}}}function ke(t){if(Ce.length){const t=[...new Set(Ce)].sort(((t,e)=>qe(t)-qe(e)));if(Ce.length=0,Se)return void Se.push(...t);for(Se=t,Me=0;Me<Se.length;Me++)Se[Me]();Se=null,Me=0}}const qe=t=>null==t.id?1/0:t.id,Ne=(t,e)=>{const i=qe(t)-qe(e);if(0===i){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return i};function De(t){Be=!1,Ae=!0,we.sort(Ne);try{for(Ve=0;Ve<we.length;Ve++){const t=we[Ve];t&&!1!==t.active&&ge(t,null,14)}}finally{Ve=0,we.length=0,ke(),Ae=!1,ze=null,(we.length||Ce.length)&&De()}}function Oe(t,e,...i){if(t.isUnmounted)return;const s=t.vnode.props||o;let n=i;const r=e.startsWith("update:"),a=r&&e.slice(7);if(a&&a in s){const t=`${"modelValue"===a?"model":a}Modifiers`,{number:e,trim:r}=s[t]||o;r&&(n=i.map((t=>v(t)?t.trim():t))),e&&(n=i.map(D))}let l,c=s[l=L(e)]||s[l=L(z(e))];!c&&r&&(c=s[l=L(F(e))]),c&&xe(c,t,6,n);const h=s[l+"Once"];if(h){if(t.emitted){if(t.emitted[l])return}else t.emitted={};t.emitted[l]=!0,xe(h,t,6,n)}}function je(t,e,i=!1){const s=e.emitsCache,o=s.get(t);if(void 0!==o)return o;const n=t.emits;let r={},a=!1;if(!f(t)){const s=t=>{const i=je(t,e,!0);i&&(a=!0,h(r,i))};!i&&e.mixins.length&&e.mixins.forEach(s),t.extends&&s(t.extends),t.mixins&&t.mixins.forEach(s)}return n||a?(p(n)?n.forEach((t=>r[t]=null)):h(r,n),x(t)&&s.set(t,r),r):(x(t)&&s.set(t,null),null)}function Re(t,e){return!(!t||!l(e))&&(e=e.slice(2).replace(/Once$/,""),_(t,e[0].toLowerCase()+e.slice(1))||_(t,F(e))||_(t,e))}let Ee=null,Ye=null;function Je(t){const e=Ee;return Ee=t,Ye=t&&t.type.__scopeId||null,e}function We(t){const{type:e,vnode:i,proxy:s,withProxy:o,props:n,propsOptions:[r],slots:a,attrs:l,emit:h,render:m,renderCache:u,data:_,setupState:p,ctx:d,inheritAttrs:y}=t;let f,v;const g=Je(t);try{if(4&i.shapeFlag){const t=o||s,e=t;f=Is(m.call(e,t,u,n,p,_,d)),v=l}else{const t=e;f=Is(t.length>1?t(n,{attrs:l,slots:a,emit:h}):t(n,null)),v=e.props?l:Ue(l)}}catch(b){ps.length=0,be(b,t,1),f=Ss(us)}let x=f;if(v&&!1!==y){const t=Object.keys(v),{shapeFlag:e}=x;t.length&&7&e&&(r&&t.some(c)&&(v=He(v,r)),x=Ms(x,v))}return i.dirs&&(x=Ms(x),x.dirs=x.dirs?x.dirs.concat(i.dirs):i.dirs),i.transition&&(x.transition=i.transition),f=x,Je(g),f}const Ue=t=>{let e;for(const i in t)("class"===i||"style"===i||l(i))&&((e||(e={}))[i]=t[i]);return e},He=(t,e)=>{const i={};for(const s in t)c(s)&&s.slice(9)in e||(i[s]=t[s]);return i};function Ge(t,e,i){const s=Object.keys(e);if(s.length!==Object.keys(t).length)return!0;for(let o=0;o<s.length;o++){const n=s[o];if(e[n]!==t[n]&&!Re(i,n))return!0}return!1}const Xe=Symbol.for("v-ndc"),Ke=Symbol.for("v-scx"),Ze=()=>Ji(Ke),$e={};function Qe(t,e,i){return ti(t,e,i)}function ti(t,e,{immediate:i,deep:s,flush:n,once:a,onTrack:l,onTrigger:c}=o){if(e&&a){const t=e;e=(...e)=>{t(...e),C()}}const h=Os,u=t=>!0===s?t:si(t,!1===s?1:void 0);let _,d,y=!1,v=!1;if(pe(t)?(_=()=>t.value,y=ne(t)):se(t)?(_=()=>u(t),y=!0):p(t)?(v=!0,y=t.some((t=>se(t)||ne(t))),_=()=>t.map((t=>pe(t)?t.value:se(t)?u(t):f(t)?ge(t,h,2):void 0))):_=f(t)?e?()=>ge(t,h,2):()=>(d&&d(),xe(t,h,3,[x])):r,e&&s){const t=_;_=()=>si(t())}let g,x=t=>{d=w.onStop=()=>{ge(t,h,4),d=w.onStop=void 0}};if(Js){if(x=r,e?i&&xe(e,h,3,[_(),v?[]:void 0,x]):_(),"sync"!==n)return r;{const t=Ze();g=t.__watcherHandles||(t.__watcherHandles=[])}}let b=v?new Array(t.length).fill($e):$e;const A=()=>{if(w.active&&w.dirty)if(e){const t=w.run();(s||y||(v?t.some(((t,e)=>k(t,b[e]))):k(t,b)))&&(d&&d(),xe(e,h,3,[t,b===$e?void 0:v&&b[0]===$e?[]:b,x]),b=t)}else w.run()};let B;A.allowRecurse=!!e,"sync"===n?B=A:"post"===n?B=()=>os(A,h&&h.suspense):(A.pre=!0,h&&(A.id=h.uid),B=()=>Fe(A));const w=new $(_,r,B),V=X,C=()=>{w.stop(),V&&m(V.effects,w)};return e?i?A():b=w.run():"post"===n?os(w.run.bind(w),h&&h.suspense):w.run(),g&&g.push(C),C}function ei(t,e,i){const s=this.proxy,o=v(t)?t.includes(".")?ii(s,t):()=>s[t]:t.bind(s,s);let n;f(e)?n=e:(n=e.handler,i=e);const r=js(this),a=ti(o,n.bind(s),i);return r(),a}function ii(t,e){const i=e.split(".");return()=>{let e=t;for(let t=0;t<i.length&&e;t++)e=e[i[t]];return e}}function si(t,e,i=0,s){if(!x(t)||t.__v_skip)return t;if(e&&e>0){if(i>=e)return t;i++}if((s=s||new Set).has(t))return t;if(s.add(t),pe(t))si(t.value,e,i,s);else if(p(t))for(let o=0;o<t.length;o++)si(t[o],e,i,s);else if(y(t)||d(t))t.forEach((t=>{si(t,e,i,s)}));else if(V(t))for(const o in t)si(t[o],e,i,s);return t}function oi(t,e,i,s){const o=t.dirs,n=e&&e.dirs;for(let r=0;r<o.length;r++){const a=o[r];n&&(a.oldValue=n[r].value);let l=a.dir[s];l&&(nt(),xe(l,i,8,[t.el,a,t,e]),rt())}}function ni(t,e){return f(t)?(()=>h({name:t.name},e,{setup:t}))():t}const ri=t=>!!t.type.__asyncLoader,ai=t=>t.type.__isKeepAlive;function li(t,e){hi(t,"a",e)}function ci(t,e){hi(t,"da",e)}function hi(t,e,i=Os){const s=t.__wdc||(t.__wdc=()=>{let e=i;for(;e;){if(e.isDeactivated)return;e=e.parent}return t()});if(ui(e,s,i),i){let t=i.parent;for(;t&&t.parent;)ai(t.parent.vnode)&&mi(s,e,i,t),t=t.parent}}function mi(t,e,i,s){const o=ui(e,t,s,!0);gi((()=>{m(s[e],o)}),i)}function ui(t,e,i=Os,s=!1){if(i){const o=i[t]||(i[t]=[]),n=e.__weh||(e.__weh=(...s)=>{if(i.isUnmounted)return;nt();const o=js(i),n=xe(e,i,t,s);return o(),rt(),n});return s?o.unshift(n):o.push(n),n}}const _i=t=>(e,i=Os)=>(!Js||"sp"===t)&&ui(t,((...t)=>e(...t)),i),pi=_i("bm"),di=_i("m"),yi=_i("bu"),fi=_i("u"),vi=_i("bum"),gi=_i("um"),xi=_i("sp"),bi=_i("rtg"),Ai=_i("rtc");function Bi(t,e=Os){ui("ec",t,e)}const wi=t=>t?Es(t)?Hs(t)||t.proxy:wi(t.parent):null,Vi=h(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>wi(t.parent),$root:t=>wi(t.root),$emit:t=>t.emit,$options:t=>Fi(t),$forceUpdate:t=>t.f||(t.f=()=>{t.effect.dirty=!0,Fe(t.update)}),$nextTick:t=>t.n||(t.n=Ie.bind(t.proxy)),$watch:t=>ei.bind(t)}),Ci=(t,e)=>t!==o&&!t.__isScriptSetup&&_(t,e),Si={get({_:t},e){const{ctx:i,setupState:s,data:n,props:r,accessCache:a,type:l,appContext:c}=t;let h;if("$"!==e[0]){const l=a[e];if(void 0!==l)switch(l){case 1:return s[e];case 2:return n[e];case 4:return i[e];case 3:return r[e]}else{if(Ci(s,e))return a[e]=1,s[e];if(n!==o&&_(n,e))return a[e]=2,n[e];if((h=t.propsOptions[0])&&_(h,e))return a[e]=3,r[e];if(i!==o&&_(i,e))return a[e]=4,i[e];Pi&&(a[e]=0)}}const m=Vi[e];let u,p;return m?("$attrs"===e&&yt(t,0,e),m(t)):(u=l.__cssModules)&&(u=u[e])?u:i!==o&&_(i,e)?(a[e]=4,i[e]):(p=c.config.globalProperties,_(p,e)?p[e]:void 0)},set({_:t},e,i){const{data:s,setupState:n,ctx:r}=t;return Ci(n,e)?(n[e]=i,!0):s!==o&&_(s,e)?(s[e]=i,!0):!(_(t.props,e)||"$"===e[0]&&e.slice(1)in t||(r[e]=i,0))},has({_:{data:t,setupState:e,accessCache:i,ctx:s,appContext:n,propsOptions:r}},a){let l;return!!i[a]||t!==o&&_(t,a)||Ci(e,a)||(l=r[0])&&_(l,a)||_(s,a)||_(Vi,a)||_(n.config.globalProperties,a)},defineProperty(t,e,i){return null!=i.get?t._.accessCache[e]=0:_(i,"value")&&this.set(t,e,i.value,null),Reflect.defineProperty(t,e,i)}};function Mi(t){return p(t)?t.reduce(((t,e)=>(t[e]=null,t)),{}):t}let Pi=!0;function zi(t,e,i){xe(p(t)?t.map((t=>t.bind(e.proxy))):t.bind(e.proxy),e,i)}function Ii(t,e,i,s){const o=s.includes(".")?ii(i,s):()=>i[s];if(v(t)){const i=e[t];f(i)&&Qe(o,i)}else if(f(t))Qe(o,t.bind(i));else if(x(t))if(p(t))t.forEach((t=>Ii(t,e,i,s)));else{const s=f(t.handler)?t.handler.bind(i):e[t.handler];f(s)&&Qe(o,s,t)}}function Fi(t){const e=t.type,{mixins:i,extends:s}=e,{mixins:o,optionsCache:n,config:{optionMergeStrategies:r}}=t.appContext,a=n.get(e);let l;return a?l=a:o.length||i||s?(l={},o.length&&o.forEach((t=>Ti(l,t,r,!0))),Ti(l,e,r)):l=e,x(e)&&n.set(e,l),l}function Ti(t,e,i,s=!1){const{mixins:o,extends:n}=e;n&&Ti(t,n,i,!0),o&&o.forEach((e=>Ti(t,e,i,!0)));for(const r in e)if(s&&"expose"===r);else{const s=Li[r]||i&&i[r];t[r]=s?s(t[r],e[r]):e[r]}return t}const Li={data:ki,props:Oi,emits:Oi,methods:Di,computed:Di,beforeCreate:Ni,created:Ni,beforeMount:Ni,mounted:Ni,beforeUpdate:Ni,updated:Ni,beforeDestroy:Ni,beforeUnmount:Ni,destroyed:Ni,unmounted:Ni,activated:Ni,deactivated:Ni,errorCaptured:Ni,serverPrefetch:Ni,components:Di,directives:Di,watch:function(t,e){if(!t)return e;if(!e)return t;const i=h(Object.create(null),t);for(const s in e)i[s]=Ni(t[s],e[s]);return i},provide:ki,inject:function(t,e){return Di(qi(t),qi(e))}};function ki(t,e){return e?t?function(){return h(f(t)?t.call(this,this):t,f(e)?e.call(this,this):e)}:e:t}function qi(t){if(p(t)){const e={};for(let i=0;i<t.length;i++)e[t[i]]=t[i];return e}return t}function Ni(t,e){return t?[...new Set([].concat(t,e))]:e}function Di(t,e){return t?h(Object.create(null),t,e):e}function Oi(t,e){return t?p(t)&&p(e)?[...new Set([...t,...e])]:h(Object.create(null),Mi(t),Mi(null!=e?e:{})):e}function ji(){return{app:null,config:{isNativeTag:a,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Ri=0;function Ei(t,e){return function(i,s=null){f(i)||(i=h({},i)),null==s||x(s)||(s=null);const o=ji(),n=new WeakSet;let r=!1;const a=o.app={_uid:Ri++,_component:i,_props:s,_container:null,_context:o,_instance:null,version:Xs,get config(){return o.config},set config(t){},use:(t,...e)=>(n.has(t)||(t&&f(t.install)?(n.add(t),t.install(a,...e)):f(t)&&(n.add(t),t(a,...e))),a),mixin:t=>(o.mixins.includes(t)||o.mixins.push(t),a),component:(t,e)=>e?(o.components[t]=e,a):o.components[t],directive:(t,e)=>e?(o.directives[t]=e,a):o.directives[t],mount(n,l,c){if(!r){const h=Ss(i,s);return h.appContext=o,!0===c?c="svg":!1===c&&(c=void 0),l&&e?e(h,n):t(h,n,c),r=!0,a._container=n,n.__vue_app__=a,Hs(h.component)||h.component.proxy}},unmount(){r&&(t(null,a._container),delete a._container.__vue_app__)},provide:(t,e)=>(o.provides[t]=e,a),runWithContext(t){const e=Yi;Yi=a;try{return t()}finally{Yi=e}}};return a}}let Yi=null;function Ji(t,e,i=!1){const s=Os||Ee;if(s||Yi){const o=s?null==s.parent?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:Yi._context.provides;if(o&&t in o)return o[t];if(arguments.length>1)return i&&f(e)?e.call(s&&s.proxy):e}}function Wi(t,e,i,s){const[n,r]=t.propsOptions;let a,l=!1;if(e)for(let o in e){if(S(o))continue;const c=e[o];let h;n&&_(n,h=z(o))?r&&r.includes(h)?(a||(a={}))[h]=c:i[h]=c:Re(t.emitsOptions,o)||o in s&&c===s[o]||(s[o]=c,l=!0)}if(r){const e=ae(i),s=a||o;for(let o=0;o<r.length;o++){const a=r[o];i[a]=Ui(n,e,a,s[a],t,!_(s,a))}}return l}function Ui(t,e,i,s,o,n){const r=t[i];if(null!=r){const t=_(r,"default");if(t&&void 0===s){const t=r.default;if(r.type!==Function&&!r.skipFactory&&f(t)){const{propsDefaults:n}=o;if(i in n)s=n[i];else{const r=js(o);s=n[i]=t.call(null,e),r()}}else s=t}r[0]&&(n&&!t?s=!1:!r[1]||""!==s&&s!==F(i)||(s=!0))}return s}function Hi(t,e,i=!1){const s=e.propsCache,r=s.get(t);if(r)return r;const a=t.props,l={},c=[];let m=!1;if(!f(t)){const s=t=>{m=!0;const[i,s]=Hi(t,e,!0);h(l,i),s&&c.push(...s)};!i&&e.mixins.length&&e.mixins.forEach(s),t.extends&&s(t.extends),t.mixins&&t.mixins.forEach(s)}if(!a&&!m)return x(t)&&s.set(t,n),n;if(p(a))for(let n=0;n<a.length;n++){const t=z(a[n]);Gi(t)&&(l[t]=o)}else if(a)for(const o in a){const t=z(o);if(Gi(t)){const e=a[o],i=l[t]=p(e)||f(e)?{type:e}:h({},e);if(i){const e=Zi(Boolean,i.type),s=Zi(String,i.type);i[0]=e>-1,i[1]=s<0||e<s,(e>-1||_(i,"default"))&&c.push(t)}}}const u=[l,c];return x(t)&&s.set(t,u),u}function Gi(t){return"$"!==t[0]&&!S(t)}function Xi(t){return null===t?"null":"function"==typeof t?t.name||"":"object"==typeof t&&t.constructor&&t.constructor.name||""}function Ki(t,e){return Xi(t)===Xi(e)}function Zi(t,e){return p(e)?e.findIndex((e=>Ki(e,t))):f(e)&&Ki(e,t)?0:-1}const $i=t=>"_"===t[0]||"$stable"===t,Qi=t=>p(t)?t.map(Is):[Is(t)],ts=(t,e,i)=>{if(e._n)return e;const s=function(t,e=Ee,i){if(!e)return t;if(t._n)return t;const s=(...i)=>{s._d&&vs(-1);const o=Je(e);let n;try{n=t(...i)}finally{Je(o),s._d&&vs(1)}return n};return s._n=!0,s._c=!0,s._d=!0,s}(((...t)=>Qi(e(...t))),i);return s._c=!1,s},es=(t,e,i)=>{const s=t._ctx;for(const o in t){if($i(o))continue;const i=t[o];if(f(i))e[o]=ts(0,i,s);else if(null!=i){const t=Qi(i);e[o]=()=>t}}},is=(t,e)=>{const i=Qi(e);t.slots.default=()=>i};function ss(t,e,i,s,n=!1){if(p(t))return void t.forEach(((t,o)=>ss(t,e&&(p(e)?e[o]:e),i,s,n)));if(ri(s)&&!n)return;const r=4&s.shapeFlag?Hs(s.component)||s.component.proxy:s.el,a=n?null:r,{i:l,r:c}=t,h=e&&e.r,u=l.refs===o?l.refs={}:l.refs,d=l.setupState;if(null!=h&&h!==c&&(v(h)?(u[h]=null,_(d,h)&&(d[h]=null)):pe(h)&&(h.value=null)),f(c))ge(c,l,12,[a,u]);else{const e=v(c),s=pe(c);if(e||s){const o=()=>{if(t.f){const i=e?_(d,c)?d[c]:u[c]:c.value;n?p(i)&&m(i,r):p(i)?i.includes(r)||i.push(r):e?(u[c]=[r],_(d,c)&&(d[c]=u[c])):(c.value=[r],t.k&&(u[t.k]=c.value))}else e?(u[c]=a,_(d,c)&&(d[c]=a)):s&&(c.value=a,t.k&&(u[t.k]=a))};a?(o.id=-1,os(o,i)):o()}}}const os=function(t,e){var i;e&&e.pendingBranch?p(t)?e.effects.push(...t):e.effects.push(t):(p(i=t)?Ce.push(...i):Se&&Se.includes(i,i.allowRecurse?Me+1:Me)||Ce.push(i),Te())};function ns(t){return function(t,e){j().__VUE__=!0;const{insert:i,remove:s,patchProp:a,createElement:l,createText:c,createComment:m,setText:u,setElementText:p,parentNode:d,nextSibling:y,setScopeId:f=r,insertStaticContent:v}=t,g=(t,e,i,s=null,o=null,n=null,r=void 0,a=null,l=!!e.dynamicChildren)=>{if(t===e)return;t&&!As(t,e)&&(s=tt(t),H(t,o,n,!0),t=null),-2===e.patchFlag&&(l=!1,e.dynamicChildren=null);const{type:c,ref:h,shapeFlag:m}=e;switch(c){case ms:x(t,e,i,s);break;case us:A(t,e,i,s);break;case _s:null==t&&B(e,i,s,r);break;case hs:L(t,e,i,s,o,n,r,a,l);break;default:1&m?w(t,e,i,s,o,n,r,a,l):6&m?k(t,e,i,s,o,n,r,a,l):(64&m||128&m)&&c.process(t,e,i,s,o,n,r,a,l,st)}null!=h&&o&&ss(h,t&&t.ref,n,e||t,!e)},x=(t,e,s,o)=>{if(null==t)i(e.el=c(e.children),s,o);else{const i=e.el=t.el;e.children!==t.children&&u(i,e.children)}},A=(t,e,s,o)=>{null==t?i(e.el=m(e.children||""),s,o):e.el=t.el},B=(t,e,i,s)=>{[t.el,t.anchor]=v(t.children,e,i,s,t.el,t.anchor)},w=(t,e,i,s,o,n,r,a,l)=>{"svg"===e.type?r="svg":"math"===e.type&&(r="mathml"),null==t?V(e,i,s,o,n,r,a,l):P(t,e,o,n,r,a,l)},V=(t,e,s,o,n,r,c,h)=>{let m,u;const{props:_,shapeFlag:d,transition:y,dirs:f}=t;if(m=t.el=l(t.type,r,_&&_.is,_),8&d?p(m,t.children):16&d&&M(t.children,m,null,o,n,rs(t,r),c,h),f&&oi(t,null,o,"created"),C(m,t,t.scopeId,c,o),_){for(const e in _)"value"===e||S(e)||a(m,e,null,_[e],r,t.children,o,n,Q);"value"in _&&a(m,"value",null,_.value,r),(u=_.onVnodeBeforeMount)&&Ls(u,o,t)}f&&oi(t,null,o,"beforeMount");const v=function(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}(n,y);v&&y.beforeEnter(m),i(m,e,s),((u=_&&_.onVnodeMounted)||v||f)&&os((()=>{u&&Ls(u,o,t),v&&y.enter(m),f&&oi(t,null,o,"mounted")}),n)},C=(t,e,i,s,o)=>{if(i&&f(t,i),s)for(let n=0;n<s.length;n++)f(t,s[n]);if(o&&e===o.subTree){const e=o.vnode;C(t,e,e.scopeId,e.slotScopeIds,o.parent)}},M=(t,e,i,s,o,n,r,a,l=0)=>{for(let c=l;c<t.length;c++){const l=t[c]=a?Fs(t[c]):Is(t[c]);g(null,l,e,i,s,o,n,r,a)}},P=(t,e,i,s,n,r,l)=>{const c=e.el=t.el;let{patchFlag:h,dynamicChildren:m,dirs:u}=e;h|=16&t.patchFlag;const _=t.props||o,d=e.props||o;let y;if(i&&as(i,!1),(y=d.onVnodeBeforeUpdate)&&Ls(y,i,e,t),u&&oi(e,t,i,"beforeUpdate"),i&&as(i,!0),m?I(t.dynamicChildren,m,c,i,s,rs(e,n),r):l||Y(t,e,c,null,i,s,rs(e,n),r,!1),h>0){if(16&h)T(c,e,_,d,i,s,n);else if(2&h&&_.class!==d.class&&a(c,"class",null,d.class,n),4&h&&a(c,"style",_.style,d.style,n),8&h){const o=e.dynamicProps;for(let e=0;e<o.length;e++){const r=o[e],l=_[r],h=d[r];h===l&&"value"!==r||a(c,r,l,h,n,t.children,i,s,Q)}}1&h&&t.children!==e.children&&p(c,e.children)}else l||null!=m||T(c,e,_,d,i,s,n);((y=d.onVnodeUpdated)||u)&&os((()=>{y&&Ls(y,i,e,t),u&&oi(e,t,i,"updated")}),s)},I=(t,e,i,s,o,n,r)=>{for(let a=0;a<e.length;a++){const l=t[a],c=e[a],h=l.el&&(l.type===hs||!As(l,c)||70&l.shapeFlag)?d(l.el):i;g(l,c,h,null,s,o,n,r,!0)}},T=(t,e,i,s,n,r,l)=>{if(i!==s){if(i!==o)for(const o in i)S(o)||o in s||a(t,o,i[o],null,l,e.children,n,r,Q);for(const o in s){if(S(o))continue;const c=s[o],h=i[o];c!==h&&"value"!==o&&a(t,o,h,c,l,e.children,n,r,Q)}"value"in s&&a(t,"value",i.value,s.value,l)}},L=(t,e,s,o,n,r,a,l,h)=>{const m=e.el=t?t.el:c(""),u=e.anchor=t?t.anchor:c("");let{patchFlag:_,dynamicChildren:p,slotScopeIds:d}=e;d&&(l=l?l.concat(d):d),null==t?(i(m,s,o),i(u,s,o),M(e.children||[],s,u,n,r,a,l,h)):_>0&&64&_&&p&&t.dynamicChildren?(I(t.dynamicChildren,p,s,n,r,a,l),(null!=e.key||n&&e===n.subTree)&&ls(t,e,!0)):Y(t,e,s,u,n,r,a,l,h)},k=(t,e,i,s,o,n,r,a,l)=>{e.slotScopeIds=a,null==t?512&e.shapeFlag?o.ctx.activate(e,i,s,r,l):D(e,i,s,o,n,r,l):O(t,e,l)},D=(t,e,i,s,n,r,a)=>{const l=t.component=function(t,e,i){const s=t.type,n=(e?e.appContext:t.appContext)||ks,r={uid:Ds++,vnode:t,type:s,parent:e,appContext:n,root:null,next:null,subTree:null,effect:null,update:null,scope:new Z(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(n.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Hi(s,n),emitsOptions:je(s,n),emit:null,emitted:null,propsDefaults:o,inheritAttrs:s.inheritAttrs,ctx:o,data:o,props:o,attrs:o,slots:o,refs:o,setupState:o,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:i,suspenseId:i?i.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=Oe.bind(null,r),t.ce&&t.ce(r),r}(t,s,n);if(ai(t)&&(l.ctx.renderer=st),function(t,e=!1){e&&Ns(e);const{props:i,children:s}=t.vnode,o=Es(t);(function(t,e,i,s=!1){const o={},n={};N(n,Bs,1),t.propsDefaults=Object.create(null),Wi(t,e,o,n);for(const r in t.propsOptions[0])r in o||(o[r]=void 0);i?t.props=s?o:ie(o,!1,Mt,Gt,Zt):t.type.props?t.props=o:t.props=n,t.attrs=n})(t,i,o,e),((t,e)=>{if(32&t.vnode.shapeFlag){const i=e._;i?(t.slots=ae(e),N(e,"_",i)):es(e,t.slots={})}else t.slots={},e&&is(t,e);N(t.slots,Bs,1)})(t,s);o&&function(t,e){const i=t.type;t.accessCache=Object.create(null),t.proxy=le(new Proxy(t.ctx,Si));const{setup:s}=i;if(s){const i=t.setupContext=s.length>1?function(t){return{get attrs(){return function(t){return t.attrsProxy||(t.attrsProxy=new Proxy(t.attrs,{get:(e,i)=>(yt(t,0,"$attrs"),e[i])}))}(t)},slots:t.slots,emit:t.emit,expose:e=>{t.exposed=e||{}}}}(t):null,o=js(t);nt();const n=ge(s,t,0,[t.props,i]);if(rt(),o(),b(n)){if(n.then(Rs,Rs),e)return n.then((i=>{Ws(t,i,e)})).catch((e=>{be(e,t,0)}));t.asyncDep=n}else Ws(t,n,e)}else Us(t,e)}(t,e);e&&Ns(!1)}(l),l.asyncDep){if(n&&n.registerDep(l,R),!t.el){const t=l.subTree=Ss(us);A(null,t,e,i)}}else R(l,t,e,i,n,r,a)},O=(t,e,i)=>{const s=e.component=t.component;if(function(t,e,i){const{props:s,children:o,component:n}=t,{props:r,children:a,patchFlag:l}=e,c=n.emitsOptions;if(e.dirs||e.transition)return!0;if(!(i&&l>=0))return!(!o&&!a||a&&a.$stable)||s!==r&&(s?!r||Ge(s,r,c):!!r);if(1024&l)return!0;if(16&l)return s?Ge(s,r,c):!!r;if(8&l){const t=e.dynamicProps;for(let e=0;e<t.length;e++){const i=t[e];if(r[i]!==s[i]&&!Re(c,i))return!0}}return!1}(t,e,i)){if(s.asyncDep&&!s.asyncResolved)return void E(s,e,i);s.next=e,function(t){const e=we.indexOf(t);e>Ve&&we.splice(e,1)}(s.update),s.effect.dirty=!0,s.update()}else e.el=t.el,s.vnode=e},R=(t,e,i,s,o,n,a)=>{const l=()=>{if(t.isMounted){let{next:e,bu:i,u:s,parent:r,vnode:c}=t;{const i=cs(t);if(i)return e&&(e.el=c.el,E(t,e,a)),void i.asyncDep.then((()=>{t.isUnmounted||l()}))}let h,m=e;as(t,!1),e?(e.el=c.el,E(t,e,a)):e=c,i&&q(i),(h=e.props&&e.props.onVnodeBeforeUpdate)&&Ls(h,r,e,c),as(t,!0);const u=We(t),_=t.subTree;t.subTree=u,g(_,u,d(_.el),tt(_),t,o,n),e.el=u.el,null===m&&function({vnode:t,parent:e},i){for(;e;){const s=e.subTree;if(s.suspense&&s.suspense.activeBranch===t&&(s.el=t.el),s!==t)break;(t=e.vnode).el=i,e=e.parent}}(t,u.el),s&&os(s,o),(h=e.props&&e.props.onVnodeUpdated)&&os((()=>Ls(h,r,e,c)),o)}else{let r;const{el:a,props:l}=e,{bm:c,m:h,parent:m}=t,u=ri(e);if(as(t,!1),c&&q(c),!u&&(r=l&&l.onVnodeBeforeMount)&&Ls(r,m,e),as(t,!0),a&&at){const i=()=>{t.subTree=We(t),at(a,t.subTree,t,o,null)};u?e.type.__asyncLoader().then((()=>!t.isUnmounted&&i())):i()}else{const r=t.subTree=We(t);g(null,r,i,s,t,o,n),e.el=r.el}if(h&&os(h,o),!u&&(r=l&&l.onVnodeMounted)){const t=e;os((()=>Ls(r,m,t)),o)}(256&e.shapeFlag||m&&ri(m.vnode)&&256&m.vnode.shapeFlag)&&t.a&&os(t.a,o),t.isMounted=!0,e=i=s=null}},c=t.effect=new $(l,r,(()=>Fe(h)),t.scope),h=t.update=()=>{c.dirty&&c.run()};h.id=t.uid,as(t,!0),h()},E=(t,e,i)=>{e.component=t;const s=t.vnode.props;t.vnode=e,t.next=null,function(t,e,i,s){const{props:o,attrs:n,vnode:{patchFlag:r}}=t,a=ae(o),[l]=t.propsOptions;let c=!1;if(!(s||r>0)||16&r){let s;Wi(t,e,o,n)&&(c=!0);for(const n in a)e&&(_(e,n)||(s=F(n))!==n&&_(e,s))||(l?!i||void 0===i[n]&&void 0===i[s]||(o[n]=Ui(l,a,n,void 0,t,!0)):delete o[n]);if(n!==a)for(const t in n)e&&_(e,t)||(delete n[t],c=!0)}else if(8&r){const i=t.vnode.dynamicProps;for(let s=0;s<i.length;s++){let r=i[s];if(Re(t.emitsOptions,r))continue;const h=e[r];if(l)if(_(n,r))h!==n[r]&&(n[r]=h,c=!0);else{const e=z(r);o[e]=Ui(l,a,e,h,t,!1)}else h!==n[r]&&(n[r]=h,c=!0)}}c&&ft(t,"set","$attrs")}(t,e.props,s,i),((t,e,i)=>{const{vnode:s,slots:n}=t;let r=!0,a=o;if(32&s.shapeFlag){const t=e._;t?i&&1===t?r=!1:(h(n,e),i||1!==t||delete n._):(r=!e.$stable,es(e,n)),a=e}else e&&(is(t,e),a={default:1});if(r)for(const o in n)$i(o)||null!=a[o]||delete n[o]})(t,e.children,i),nt(),Le(t),rt()},Y=(t,e,i,s,o,n,r,a,l=!1)=>{const c=t&&t.children,h=t?t.shapeFlag:0,m=e.children,{patchFlag:u,shapeFlag:_}=e;if(u>0){if(128&u)return void W(c,m,i,s,o,n,r,a,l);if(256&u)return void J(c,m,i,s,o,n,r,a,l)}8&_?(16&h&&Q(c,o,n),m!==c&&p(i,m)):16&h?16&_?W(c,m,i,s,o,n,r,a,l):Q(c,o,n,!0):(8&h&&p(i,""),16&_&&M(m,i,s,o,n,r,a,l))},J=(t,e,i,s,o,r,a,l,c)=>{e=e||n;const h=(t=t||n).length,m=e.length,u=Math.min(h,m);let _;for(_=0;_<u;_++){const s=e[_]=c?Fs(e[_]):Is(e[_]);g(t[_],s,i,null,o,r,a,l,c)}h>m?Q(t,o,r,!0,!1,u):M(e,i,s,o,r,a,l,c,u)},W=(t,e,i,s,o,r,a,l,c)=>{let h=0;const m=e.length;let u=t.length-1,_=m-1;for(;h<=u&&h<=_;){const s=t[h],n=e[h]=c?Fs(e[h]):Is(e[h]);if(!As(s,n))break;g(s,n,i,null,o,r,a,l,c),h++}for(;h<=u&&h<=_;){const s=t[u],n=e[_]=c?Fs(e[_]):Is(e[_]);if(!As(s,n))break;g(s,n,i,null,o,r,a,l,c),u--,_--}if(h>u){if(h<=_){const t=_+1,n=t<m?e[t].el:s;for(;h<=_;)g(null,e[h]=c?Fs(e[h]):Is(e[h]),i,n,o,r,a,l,c),h++}}else if(h>_)for(;h<=u;)H(t[h],o,r,!0),h++;else{const p=h,d=h,y=new Map;for(h=d;h<=_;h++){const t=e[h]=c?Fs(e[h]):Is(e[h]);null!=t.key&&y.set(t.key,h)}let f,v=0;const x=_-d+1;let b=!1,A=0;const B=new Array(x);for(h=0;h<x;h++)B[h]=0;for(h=p;h<=u;h++){const s=t[h];if(v>=x){H(s,o,r,!0);continue}let n;if(null!=s.key)n=y.get(s.key);else for(f=d;f<=_;f++)if(0===B[f-d]&&As(s,e[f])){n=f;break}void 0===n?H(s,o,r,!0):(B[n-d]=h+1,n>=A?A=n:b=!0,g(s,e[n],i,null,o,r,a,l,c),v++)}const w=b?function(t){const e=t.slice(),i=[0];let s,o,n,r,a;const l=t.length;for(s=0;s<l;s++){const l=t[s];if(0!==l){if(o=i[i.length-1],t[o]<l){e[s]=o,i.push(s);continue}for(n=0,r=i.length-1;n<r;)a=n+r>>1,t[i[a]]<l?n=a+1:r=a;l<t[i[n]]&&(n>0&&(e[s]=i[n-1]),i[n]=s)}}for(n=i.length,r=i[n-1];n-- >0;)i[n]=r,r=e[r];return i}(B):n;for(f=w.length-1,h=x-1;h>=0;h--){const t=d+h,n=e[t],u=t+1<m?e[t+1].el:s;0===B[h]?g(null,n,i,u,o,r,a,l,c):b&&(f<0||h!==w[f]?U(n,i,u,2):f--)}}},U=(t,e,s,o,n=null)=>{const{el:r,type:a,transition:l,children:c,shapeFlag:h}=t;if(6&h)U(t.component.subTree,e,s,o);else if(128&h)t.suspense.move(e,s,o);else if(64&h)a.move(t,e,s,st);else if(a!==hs)if(a!==_s)if(2!==o&&1&h&&l)if(0===o)l.beforeEnter(r),i(r,e,s),os((()=>l.enter(r)),n);else{const{leave:t,delayLeave:o,afterLeave:n}=l,a=()=>i(r,e,s),c=()=>{t(r,(()=>{a(),n&&n()}))};o?o(r,a,c):c()}else i(r,e,s);else(({el:t,anchor:e},s,o)=>{let n;for(;t&&t!==e;)n=y(t),i(t,s,o),t=n;i(e,s,o)})(t,e,s);else{i(r,e,s);for(let t=0;t<c.length;t++)U(c[t],e,s,o);i(t.anchor,e,s)}},H=(t,e,i,s=!1,o=!1)=>{const{type:n,props:r,ref:a,children:l,dynamicChildren:c,shapeFlag:h,patchFlag:m,dirs:u}=t;if(null!=a&&ss(a,null,i,t,!0),256&h)return void e.ctx.deactivate(t);const _=1&h&&u,p=!ri(t);let d;if(p&&(d=r&&r.onVnodeBeforeUnmount)&&Ls(d,e,t),6&h)K(t.component,i,s);else{if(128&h)return void t.suspense.unmount(i,s);_&&oi(t,null,e,"beforeUnmount"),64&h?t.type.remove(t,e,i,o,st,s):c&&(n!==hs||m>0&&64&m)?Q(c,e,i,!1,!0):(n===hs&&384&m||!o&&16&h)&&Q(l,e,i),s&&G(t)}(p&&(d=r&&r.onVnodeUnmounted)||_)&&os((()=>{d&&Ls(d,e,t),_&&oi(t,null,e,"unmounted")}),i)},G=t=>{const{type:e,el:i,anchor:o,transition:n}=t;if(e===hs)return void X(i,o);if(e===_s)return void(({el:t,anchor:e})=>{let i;for(;t&&t!==e;)i=y(t),s(t),t=i;s(e)})(t);const r=()=>{s(i),n&&!n.persisted&&n.afterLeave&&n.afterLeave()};if(1&t.shapeFlag&&n&&!n.persisted){const{leave:e,delayLeave:s}=n,o=()=>e(i,r);s?s(t.el,r,o):o()}else r()},X=(t,e)=>{let i;for(;t!==e;)i=y(t),s(t),t=i;s(e)},K=(t,e,i)=>{const{bum:s,scope:o,update:n,subTree:r,um:a}=t;s&&q(s),o.stop(),n&&(n.active=!1,H(r,t,e,i)),a&&os(a,e),os((()=>{t.isUnmounted=!0}),e),e&&e.pendingBranch&&!e.isUnmounted&&t.asyncDep&&!t.asyncResolved&&t.suspenseId===e.pendingId&&(e.deps--,0===e.deps&&e.resolve())},Q=(t,e,i,s=!1,o=!1,n=0)=>{for(let r=n;r<t.length;r++)H(t[r],e,i,s,o)},tt=t=>6&t.shapeFlag?tt(t.component.subTree):128&t.shapeFlag?t.suspense.next():y(t.anchor||t.el);let et=!1;const it=(t,e,i)=>{null==t?e._vnode&&H(e._vnode,null,null,!0):g(e._vnode||null,t,e,null,null,null,i),et||(et=!0,Le(),ke(),et=!1),e._vnode=t},st={p:g,um:H,m:U,r:G,mt:D,mc:M,pc:Y,pbc:I,n:tt,o:t};let ot,at;return{render:it,hydrate:ot,createApp:Ei(it,ot)}}(t)}function rs({type:t,props:e},i){return"svg"===i&&"foreignObject"===t||"mathml"===i&&"annotation-xml"===t&&e&&e.encoding&&e.encoding.includes("html")?void 0:i}function as({effect:t,update:e},i){t.allowRecurse=e.allowRecurse=i}function ls(t,e,i=!1){const s=t.children,o=e.children;if(p(s)&&p(o))for(let n=0;n<s.length;n++){const t=s[n];let e=o[n];1&e.shapeFlag&&!e.dynamicChildren&&((e.patchFlag<=0||32===e.patchFlag)&&(e=o[n]=Fs(o[n]),e.el=t.el),i||ls(t,e)),e.type===ms&&(e.el=t.el)}}function cs(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:cs(e)}const hs=Symbol.for("v-fgt"),ms=Symbol.for("v-txt"),us=Symbol.for("v-cmt"),_s=Symbol.for("v-stc"),ps=[];let ds=null;function ys(t=!1){ps.push(ds=t?null:[])}let fs=1;function vs(t){fs+=t}function gs(t){return t.dynamicChildren=fs>0?ds||n:null,ps.pop(),ds=ps[ps.length-1]||null,fs>0&&ds&&ds.push(t),t}function xs(t,e,i,s,o,n){return gs(Cs(t,e,i,s,o,n,!0))}function bs(t,e,i,s,o){return gs(Ss(t,e,i,s,o,!0))}function As(t,e){return t.type===e.type&&t.key===e.key}const Bs="__vInternal",ws=({key:t})=>null!=t?t:null,Vs=({ref:t,ref_key:e,ref_for:i})=>("number"==typeof t&&(t=""+t),null!=t?v(t)||pe(t)||f(t)?{i:Ee,r:t,k:e,f:!!i}:t:null);function Cs(t,e=null,i=null,s=0,o=null,n=(t===hs?0:1),r=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&ws(e),ref:e&&Vs(e),scopeId:Ye,slotScopeIds:null,children:i,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:n,patchFlag:s,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:Ee};return a?(Ts(l,i),128&n&&t.normalize(l)):i&&(l.shapeFlag|=v(i)?8:16),fs>0&&!r&&ds&&(l.patchFlag>0||6&n)&&32!==l.patchFlag&&ds.push(l),l}const Ss=function(t,e=null,i=null,s=0,o=null,n=!1){if(t&&t!==Xe||(t=us),(r=t)&&!0===r.__v_isVNode){const s=Ms(t,e,!0);return i&&Ts(s,i),fs>0&&!n&&ds&&(6&s.shapeFlag?ds[ds.indexOf(t)]=s:ds.push(s)),s.patchFlag|=-2,s}var r;if(function(t){return f(t)&&"__vccOpts"in t}(t)&&(t=t.__vccOpts),e){e=function(t){return t?re(t)||Bs in t?h({},t):t:null}(e);let{class:t,style:i}=e;t&&!v(t)&&(e.class=U(t)),x(i)&&(re(i)&&!p(i)&&(i=h({},i)),e.style=R(i))}return Cs(t,e,i,s,o,v(t)?1:(t=>t.__isSuspense)(t)?128:(t=>t.__isTeleport)(t)?64:x(t)?4:f(t)?2:0,n,!0)};function Ms(t,e,i=!1){const{props:s,ref:o,patchFlag:n,children:r}=t,a=e?function(...t){const e={};for(let i=0;i<t.length;i++){const s=t[i];for(const t in s)if("class"===t)e.class!==s.class&&(e.class=U([e.class,s.class]));else if("style"===t)e.style=R([e.style,s.style]);else if(l(t)){const i=e[t],o=s[t];!o||i===o||p(i)&&i.includes(o)||(e[t]=i?[].concat(i,o):o)}else""!==t&&(e[t]=s[t])}return e}(s||{},e):s;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:a,key:a&&ws(a),ref:e&&e.ref?i&&o?p(o)?o.concat(Vs(e)):[o,Vs(e)]:Vs(e):o,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:r,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==hs?-1===n?16:16|n:n,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Ms(t.ssContent),ssFallback:t.ssFallback&&Ms(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce}}function Ps(t=" ",e=0){return Ss(ms,null,t,e)}function zs(t="",e=!1){return e?(ys(),bs(us,null,t)):Ss(us,null,t)}function Is(t){return null==t||"boolean"==typeof t?Ss(us):p(t)?Ss(hs,null,t.slice()):"object"==typeof t?Fs(t):Ss(ms,null,String(t))}function Fs(t){return null===t.el&&-1!==t.patchFlag||t.memo?t:Ms(t)}function Ts(t,e){let i=0;const{shapeFlag:s}=t;if(null==e)e=null;else if(p(e))i=16;else if("object"==typeof e){if(65&s){const i=e.default;return void(i&&(i._c&&(i._d=!1),Ts(t,i()),i._c&&(i._d=!0)))}{i=32;const s=e._;s||Bs in e?3===s&&Ee&&(1===Ee.slots._?e._=1:(e._=2,t.patchFlag|=1024)):e._ctx=Ee}}else f(e)?(e={default:e,_ctx:Ee},i=32):(e=String(e),64&s?(i=16,e=[Ps(e)]):i=8);t.children=e,t.shapeFlag|=i}function Ls(t,e,i,s=null){xe(t,e,7,[i,s])}const ks=ji();let qs,Ns,Ds=0,Os=null;{const t=j(),e=(e,i)=>{let s;return(s=t[e])||(s=t[e]=[]),s.push(i),t=>{s.length>1?s.forEach((e=>e(t))):s[0](t)}};qs=e("__VUE_INSTANCE_SETTERS__",(t=>Os=t)),Ns=e("__VUE_SSR_SETTERS__",(t=>Js=t))}const js=t=>{const e=Os;return qs(t),t.scope.on(),()=>{t.scope.off(),qs(e)}},Rs=()=>{Os&&Os.scope.off(),qs(null)};function Es(t){return 4&t.vnode.shapeFlag}let Ys,Js=!1;function Ws(t,e,i){f(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:x(e)&&(t.setupState=ve(e)),Us(t,i)}function Us(t,e,i){const s=t.type;if(!t.render){if(!e&&Ys&&!s.render){const e=s.template||Fi(t).template;if(e){const{isCustomElement:i,compilerOptions:o}=t.appContext.config,{delimiters:n,compilerOptions:r}=s,a=h(h({isCustomElement:i,delimiters:n},o),r);s.render=Ys(e,a)}}t.render=s.render||r}{const e=js(t);nt();try{!function(t){const e=Fi(t),i=t.proxy,s=t.ctx;Pi=!1,e.beforeCreate&&zi(e.beforeCreate,t,"bc");const{data:o,computed:n,methods:a,watch:l,provide:c,inject:h,created:m,beforeMount:u,mounted:_,beforeUpdate:d,updated:y,activated:v,deactivated:g,beforeDestroy:b,beforeUnmount:A,destroyed:B,unmounted:w,render:V,renderTracked:C,renderTriggered:S,errorCaptured:M,serverPrefetch:P,expose:z,inheritAttrs:I,components:F,directives:T,filters:L}=e;if(h&&function(t,e,i=r){p(t)&&(t=qi(t));for(const s in t){const i=t[s];let o;o=x(i)?"default"in i?Ji(i.from||s,i.default,!0):Ji(i.from||s):Ji(i),pe(o)?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>o.value,set:t=>o.value=t}):e[s]=o}}(h,s,null),a)for(const r in a){const t=a[r];f(t)&&(s[r]=t.bind(i))}if(o){const e=o.call(i,i);x(e)&&(t.data=te(e))}if(Pi=!0,n)for(const p in n){const t=n[p],e=f(t)?t.bind(i,i):f(t.get)?t.get.bind(i,i):r,o=!f(t)&&f(t.set)?t.set.bind(i):r,a=Gs({get:e,set:o});Object.defineProperty(s,p,{enumerable:!0,configurable:!0,get:()=>a.value,set:t=>a.value=t})}if(l)for(const r in l)Ii(l[r],s,i,r);if(c){const t=f(c)?c.call(i):c;Reflect.ownKeys(t).forEach((e=>{!function(t,e){if(Os){let i=Os.provides;const s=Os.parent&&Os.parent.provides;s===i&&(i=Os.provides=Object.create(s)),i[t]=e}}(e,t[e])}))}function k(t,e){p(e)?e.forEach((e=>t(e.bind(i)))):e&&t(e.bind(i))}if(m&&zi(m,t,"c"),k(pi,u),k(di,_),k(yi,d),k(fi,y),k(li,v),k(ci,g),k(Bi,M),k(Ai,C),k(bi,S),k(vi,A),k(gi,w),k(xi,P),p(z))if(z.length){const e=t.exposed||(t.exposed={});z.forEach((t=>{Object.defineProperty(e,t,{get:()=>i[t],set:e=>i[t]=e})}))}else t.exposed||(t.exposed={});V&&t.render===r&&(t.render=V),null!=I&&(t.inheritAttrs=I),F&&(t.components=F),T&&(t.directives=T)}(t)}finally{rt(),e()}}}function Hs(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(ve(le(t.exposed)),{get:(e,i)=>i in e?e[i]:i in Vi?Vi[i](t):void 0,has:(t,e)=>e in t||e in Vi}))}const Gs=(t,e)=>{const i=function(t,e,i=!1){let s,o;const n=f(t);return n?(s=t,o=r):(s=t.get,o=t.set),new me(s,o,n||!o,i)}(t,0,Js);return i},Xs="3.4.20",Ks="undefined"!=typeof document?document:null,Zs=Ks&&Ks.createElement("template"),$s={insert:(t,e,i)=>{e.insertBefore(t,i||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,i,s)=>{const o="svg"===e?Ks.createElementNS("http://www.w3.org/2000/svg",t):"mathml"===e?Ks.createElementNS("http://www.w3.org/1998/Math/MathML",t):Ks.createElement(t,i?{is:i}:void 0);return"select"===t&&s&&null!=s.multiple&&o.setAttribute("multiple",s.multiple),o},createText:t=>Ks.createTextNode(t),createComment:t=>Ks.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Ks.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,i,s,o,n){const r=i?i.previousSibling:e.lastChild;if(o&&(o===n||o.nextSibling))for(;e.insertBefore(o.cloneNode(!0),i),o!==n&&(o=o.nextSibling););else{Zs.innerHTML="svg"===s?`<svg>${t}</svg>`:"mathml"===s?`<math>${t}</math>`:t;const o=Zs.content;if("svg"===s||"mathml"===s){const t=o.firstChild;for(;t.firstChild;)o.appendChild(t.firstChild);o.removeChild(t)}e.insertBefore(o,i)}return[r?r.nextSibling:e.firstChild,i?i.previousSibling:e.lastChild]}},Qs=Symbol("_vtc"),to=Symbol("_vod"),eo=Symbol("_vsh"),io=Symbol(""),so=/(^|;)\s*display\s*:/,oo=/\s*!important$/;function no(t,e,i){if(p(i))i.forEach((i=>no(t,e,i)));else if(null==i&&(i=""),e.startsWith("--"))t.setProperty(e,i);else{const s=function(t,e){const i=ao[e];if(i)return i;let s=z(e);if("filter"!==s&&s in t)return ao[e]=s;s=T(s);for(let o=0;o<ro.length;o++){const i=ro[o]+s;if(i in t)return ao[e]=i}return e}(t,e);oo.test(i)?t.setProperty(F(s),i.replace(oo,""),"important"):t[s]=i}}const ro=["Webkit","Moz","ms"],ao={},lo="http://www.w3.org/1999/xlink",co=Symbol("_vei");const ho=/(?:Once|Passive|Capture)$/;let mo=0;const uo=Promise.resolve(),_o=()=>mo||(uo.then((()=>mo=0)),mo=Date.now()),po=t=>111===t.charCodeAt(0)&&110===t.charCodeAt(1)&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,yo=h({patchProp:(t,e,i,s,o,n,r,a,h)=>{const m="svg"===o;"class"===e?function(t,e,i){const s=t[Qs];s&&(e=(e?[e,...s]:[...s]).join(" ")),null==e?t.removeAttribute("class"):i?t.setAttribute("class",e):t.className=e}(t,s,m):"style"===e?function(t,e,i){const s=t.style,o=v(i);let n=!1;if(i&&!o){if(e)if(v(e))for(const t of e.split(";")){const e=t.slice(0,t.indexOf(":")).trim();null==i[e]&&no(s,e,"")}else for(const t in e)null==i[t]&&no(s,t,"");for(const t in i)"display"===t&&(n=!0),no(s,t,i[t])}else if(o){if(e!==i){const t=s[io];t&&(i+=";"+t),s.cssText=i,n=so.test(i)}}else e&&t.removeAttribute("style");to in t&&(t[to]=n?s.display:"",t[eo]&&(s.display="none"))}(t,i,s):l(e)?c(e)||function(t,e,i,s,o=null){const n=t[co]||(t[co]={}),r=n[e];if(s&&r)r.value=s;else{const[i,a]=function(t){let e;if(ho.test(t)){let i;for(e={};i=t.match(ho);)t=t.slice(0,t.length-i[0].length),e[i[0].toLowerCase()]=!0}return[":"===t[2]?t.slice(3):F(t.slice(2)),e]}(e);if(s){const r=n[e]=function(t,e){const i=t=>{if(t._vts){if(t._vts<=i.attached)return}else t._vts=Date.now();xe(function(t,e){if(p(e)){const i=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{i.call(t),t._stopped=!0},e.map((t=>e=>!e._stopped&&t&&t(e)))}return e}(t,i.value),e,5,[t])};return i.value=t,i.attached=_o(),i}(s,o);!function(t,e,i,s){t.addEventListener(e,i,s)}(t,i,r,a)}else r&&(function(t,e,i,s){t.removeEventListener(e,i,s)}(t,i,r,a),n[e]=void 0)}}(t,e,0,s,r):("."===e[0]?(e=e.slice(1),1):"^"===e[0]?(e=e.slice(1),0):function(t,e,i,s){if(s)return"innerHTML"===e||"textContent"===e||!!(e in t&&po(e)&&f(i));if("spellcheck"===e||"draggable"===e||"translate"===e)return!1;if("form"===e)return!1;if("list"===e&&"INPUT"===t.tagName)return!1;if("type"===e&&"TEXTAREA"===t.tagName)return!1;if("width"===e||"height"===e){const e=t.tagName;if("IMG"===e||"VIDEO"===e||"CANVAS"===e||"SOURCE"===e)return!1}return(!po(e)||!v(i))&&e in t}(t,e,s,m))?function(t,e,i,s,o,n,r){if("innerHTML"===e||"textContent"===e)return s&&r(s,o,n),void(t[e]=null==i?"":i);const a=t.tagName;if("value"===e&&"PROGRESS"!==a&&!a.includes("-")){t._value=i;const s=null==i?"":i;return("OPTION"===a?t.getAttribute("value")||"":t.value)!==s&&(t.value=s),void(null==i&&t.removeAttribute(e))}let l=!1;if(""===i||null==i){const s=typeof t[e];"boolean"===s?i=G(i):null==i&&"string"===s?(i="",l=!0):"number"===s&&(i=0,l=!0)}try{t[e]=i}catch(c){}l&&t.removeAttribute(e)}(t,e,s,n,r,a,h):("true-value"===e?t._trueValue=s:"false-value"===e&&(t._falseValue=s),function(t,e,i,s,o){if(s&&e.startsWith("xlink:"))null==i?t.removeAttributeNS(lo,e.slice(6,e.length)):t.setAttributeNS(lo,e,i);else{const s=H(e);null==i||s&&!G(i)?t.removeAttribute(e):t.setAttribute(e,s?"":i)}}(t,e,s,m))}},$s);let fo;const vo=new e.Events.EventEmitter;class go extends i.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}const xo={localStorageName:"com.emanueleferonato.mergy",maxStartBallSize:4,blast:{radius:100,impulse:2},idleTime:500,screen:{width:1920,height:1080},ui:{panelBgColor:4871241,buttonBgColor:2236962,activeText:"#ADFF2F",activeTextNumber:11403055,dangerText:"#FF7F50",pathColor:8421504},gameField:{width:800,height:800,distanceFromBottom:30,borderColor:11184810,y:150,ballY:50},timerNewBall:{widthProgress:300,maxTimeWait:6e4,progressColor:15046256},Box2D:{gravity:50,worldScale:30},bodies:[{size:30,color:14885921,particleSize:10,score:2,textSize:30,textColor:"#ffffff"},{size:35,color:11403055,particleSize:20,score:4,textSize:30,textColor:"#ffffff"},{size:40,color:16049154,particleSize:30,score:8,textSize:40,textColor:"#ffffff"},{size:45,color:16730546,particleSize:40,score:16,textSize:40,textColor:"#ffffff"},{size:50,color:1754873,particleSize:50,score:32,textSize:50,textColor:"#ffffff"},{size:55,color:7747784,particleSize:60,score:64,textSize:50,textColor:"#ffffff"},{size:60,color:9592620,particleSize:70,score:128,textSize:50,textColor:"#ffffff"},{size:65,color:15896092,particleSize:80,score:256,textSize:40,textColor:"#ffffff"},{size:70,color:5341613,particleSize:90,score:512,textSize:40,textColor:"#ffffff"},{size:75,color:9880498,particleSize:100,score:1024,textSize:45,textColor:"#ffffff"},{size:80,color:3092269,particleSize:100,score:2048,textSize:50,textColor:"#ffffff"}]};var bo=function(t,e){return(bo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};function Ao(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}bo(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Bo=function(){return Bo=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Bo.apply(this,arguments)},wo=function(t,e){null==t&&(t={});var i=Bo({},t);for(var s in e)e.hasOwnProperty(s)&&void 0===t[s]&&(i[s]=e[s]);if("function"==typeof Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(e),n=0;n<o.length;n++){var r=o[n];e.propertyIsEnumerable(r)&&void 0===t[r]&&(i[r]=e[r])}return i},Vo=Math.random,Co=1e-9,So=Number.isFinite;function Mo(t,e,i){return void 0===e?(i=1,e=0):void 0===i&&(i=e,e=0),i>e?(t=(t-e)%(i-e))+(t<0?i:e):(t=(t-i)%(e-i))+(t<=0?e:i)}function Po(t,e,i){return t<e?e:t>i?i:t}var zo=Object.create(Math);zo.EPSILON=Co,zo.isFinite=So,zo.nextPowerOfTwo=function(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16)},zo.isPowerOfTwo=function(t){return t>0&&0==(t&t-1)},zo.mod=Mo,zo.clamp=Po,zo.random=function(t,e){return void 0===t?(e=1,t=0):void 0===e&&(e=t,t=0),t===e?t:Vo()*(e-t)+t};var Io=Math.abs,Fo=Math.sqrt,To=Math.max,Lo=Math.min,ko=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);void 0===e?(this.x=0,this.y=0):"object"==typeof e?(this.x=e.x,this.y=e.y):(this.x=e,this.y=i)}return t.prototype._serialize=function(){return{x:this.x,y:this.y}},t._deserialize=function(e){var i=Object.create(t.prototype);return i.x=e.x,i.y=e.y,i},t.zero=function(){var e=Object.create(t.prototype);return e.x=0,e.y=0,e},t.neo=function(e,i){var s=Object.create(t.prototype);return s.x=e,s.y=i,s},t.clone=function(e){return t.neo(e.x,e.y)},t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&Number.isFinite(t.x)&&Number.isFinite(t.y)},t.assert=function(t){},t.prototype.clone=function(){return t.clone(this)},t.prototype.setZero=function(){return this.x=0,this.y=0,this},t.prototype.set=function(t,e){return"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this},t.prototype.setNum=function(t,e){return this.x=t,this.y=e,this},t.prototype.setVec2=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.wSet=function(t,e,i,s){return void 0!==i||void 0!==s?this.setCombine(t,e,i,s):this.setMul(t,e)},t.prototype.setCombine=function(t,e,i,s){var o=t*e.x+i*s.x,n=t*e.y+i*s.y;return this.x=o,this.y=n,this},t.prototype.setMul=function(t,e){var i=t*e.x,s=t*e.y;return this.x=i,this.y=s,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.wAdd=function(t,e,i,s){return void 0!==i||void 0!==s?this.addCombine(t,e,i,s):this.addMul(t,e)},t.prototype.addCombine=function(t,e,i,s){var o=t*e.x+i*s.x,n=t*e.y+i*s.y;return this.x+=o,this.y+=n,this},t.prototype.addMul=function(t,e){var i=t*e.x,s=t*e.y;return this.x+=i,this.y+=s,this},t.prototype.wSub=function(t,e,i,s){return void 0!==i||void 0!==s?this.subCombine(t,e,i,s):this.subMul(t,e)},t.prototype.subCombine=function(t,e,i,s){var o=t*e.x+i*s.x,n=t*e.y+i*s.y;return this.x-=o,this.y-=n,this},t.prototype.subMul=function(t,e){var i=t*e.x,s=t*e.y;return this.x-=i,this.y-=s,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.mul=function(t){return this.x*=t,this.y*=t,this},t.prototype.length=function(){return t.lengthOf(this)},t.prototype.lengthSquared=function(){return t.lengthSquared(this)},t.prototype.normalize=function(){var t=this.length();if(t<Co)return 0;var e=1/t;return this.x*=e,this.y*=e,t},t.lengthOf=function(t){return Fo(t.x*t.x+t.y*t.y)},t.lengthSquared=function(t){return t.x*t.x+t.y*t.y},t.distance=function(t,e){var i=t.x-e.x,s=t.y-e.y;return Fo(i*i+s*s)},t.distanceSquared=function(t,e){var i=t.x-e.x,s=t.y-e.y;return i*i+s*s},t.areEqual=function(t,e){return t===e||"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y},t.skew=function(e){return t.neo(-e.y,e.x)},t.dot=function(t,e){return t.x*e.x+t.y*e.y},t.cross=function(e,i){return"number"==typeof i?t.neo(i*e.y,-i*e.x):"number"==typeof e?t.neo(-e*i.y,e*i.x):e.x*i.y-e.y*i.x},t.crossVec2Vec2=function(t,e){return t.x*e.y-t.y*e.x},t.crossVec2Num=function(e,i){return t.neo(i*e.y,-i*e.x)},t.crossNumVec2=function(e,i){return t.neo(-e*i.y,e*i.x)},t.addCross=function(e,i,s){return"number"==typeof s?t.neo(s*i.y+e.x,-s*i.x+e.y):"number"==typeof i?t.neo(-i*s.y+e.x,i*s.x+e.y):void 0},t.addCrossVec2Num=function(e,i,s){return t.neo(s*i.y+e.x,-s*i.x+e.y)},t.addCrossNumVec2=function(e,i,s){return t.neo(-i*s.y+e.x,i*s.x+e.y)},t.add=function(e,i){return t.neo(e.x+i.x,e.y+i.y)},t.wAdd=function(e,i,s,o){return void 0!==s||void 0!==o?t.combine(e,i,s,o):t.mulNumVec2(e,i)},t.combine=function(e,i,s,o){return t.zero().setCombine(e,i,s,o)},t.sub=function(e,i){return t.neo(e.x-i.x,e.y-i.y)},t.mul=function(e,i){return"object"==typeof e?t.neo(e.x*i,e.y*i):"object"==typeof i?t.neo(e*i.x,e*i.y):void 0},t.mulVec2Num=function(e,i){return t.neo(e.x*i,e.y*i)},t.mulNumVec2=function(e,i){return t.neo(e*i.x,e*i.y)},t.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},t.neg=function(e){return t.neo(-e.x,-e.y)},t.abs=function(e){return t.neo(Io(e.x),Io(e.y))},t.mid=function(e,i){return t.neo(.5*(e.x+i.x),.5*(e.y+i.y))},t.upper=function(e,i){return t.neo(To(e.x,i.x),To(e.y,i.y))},t.lower=function(e,i){return t.neo(Lo(e.x,i.x),Lo(e.y,i.y))},t.prototype.clamp=function(t){var e=this.x*this.x+this.y*this.y;if(e>t*t){var i=t/Fo(e);this.x*=i,this.y*=i}return this},t.clamp=function(e,i){var s=t.neo(e.x,e.y);return s.clamp(i),s},t.scaleFn=function(e,i){return function(s){return t.neo(s.x*e,s.y*i)}},t.translateFn=function(e,i){return function(s){return t.neo(s.x+e,s.y+i)}},t}(),qo=Math.max,No=Math.min,Do=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);this.lowerBound=ko.zero(),this.upperBound=ko.zero(),"object"==typeof e&&this.lowerBound.setVec2(e),"object"==typeof i?this.upperBound.setVec2(i):"object"==typeof e&&this.upperBound.setVec2(e)}return t.prototype.isValid=function(){return t.isValid(this)},t.isValid=function(t){return null!=t&&ko.isValid(t.lowerBound)&&ko.isValid(t.upperBound)&&ko.sub(t.upperBound,t.lowerBound).lengthSquared()>=0},t.assert=function(t){},t.prototype.getCenter=function(){return ko.neo(.5*(this.lowerBound.x+this.upperBound.x),.5*(this.lowerBound.y+this.upperBound.y))},t.prototype.getExtents=function(){return ko.neo(.5*(this.upperBound.x-this.lowerBound.x),.5*(this.upperBound.y-this.lowerBound.y))},t.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},t.prototype.combine=function(t,e){e=e||this;var i=t.lowerBound,s=t.upperBound,o=e.lowerBound,n=e.upperBound,r=No(i.x,o.x),a=No(i.y,o.y),l=qo(n.x,s.x),c=qo(n.y,s.y);this.lowerBound.setNum(r,a),this.upperBound.setNum(l,c)},t.prototype.combinePoints=function(t,e){this.lowerBound.setNum(No(t.x,e.x),No(t.y,e.y)),this.upperBound.setNum(qo(t.x,e.x),qo(t.y,e.y))},t.prototype.set=function(t){this.lowerBound.setNum(t.lowerBound.x,t.lowerBound.y),this.upperBound.setNum(t.upperBound.x,t.upperBound.y)},t.prototype.contains=function(t){var e=!0;return(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y},t.prototype.extend=function(e){return t.extend(this,e),this},t.extend=function(t,e){return t.lowerBound.x-=e,t.lowerBound.y-=e,t.upperBound.x+=e,t.upperBound.y+=e,t},t.testOverlap=function(t,e){var i=e.lowerBound.x-t.upperBound.x,s=t.lowerBound.x-e.upperBound.x,o=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.y-e.upperBound.y;return!(i>0||o>0||s>0||n>0)},t.areEqual=function(t,e){return ko.areEqual(t.lowerBound,e.lowerBound)&&ko.areEqual(t.upperBound,e.upperBound)},t.diff=function(t,e){var i=qo(0,No(t.upperBound.x,e.upperBound.x)-qo(e.lowerBound.x,t.lowerBound.x)),s=qo(0,No(t.upperBound.y,e.upperBound.y)-qo(e.lowerBound.y,t.lowerBound.y));return(t.upperBound.x-t.lowerBound.x)*(t.upperBound.y-t.lowerBound.y)+(e.upperBound.x-e.lowerBound.x)*(e.upperBound.y-e.lowerBound.y)-i*s},t.prototype.rayCast=function(t,e){for(var i=-1/0,s=1/0,o=e.p1,n=ko.sub(e.p2,e.p1),r=ko.abs(n),a=ko.zero(),l="x";null!==l;l="x"===l?"y":null)if(r.x<Co){if(o[l]<this.lowerBound[l]||this.upperBound[l]<o[l])return!1}else{var c=1/n[l],h=(this.lowerBound[l]-o[l])*c,m=(this.upperBound[l]-o[l])*c,u=-1;if(h>m){var _=h;h=m,m=_,u=1}if(h>i&&(a.setZero(),a[l]=u,i=h),i>(s=No(s,m)))return!1}return!(i<0||e.maxFraction<i||(t.fraction=i,t.normal=a,0))},t.prototype.toString=function(){return JSON.stringify(this)},t.combinePoints=function(t,e,i){return t.lowerBound.x=No(e.x,i.x),t.lowerBound.y=No(e.y,i.y),t.upperBound.x=qo(e.x,i.x),t.upperBound.y=qo(e.y,i.y),t},t.combinedPerimeter=function(t,e){var i=No(t.lowerBound.x,e.lowerBound.x),s=No(t.lowerBound.y,e.lowerBound.y);return 2*(qo(t.upperBound.x,e.upperBound.x)-i+qo(t.upperBound.y,e.upperBound.y)-s)},t}(),Oo=Math.PI,jo=function(){function t(){}return Object.defineProperty(t,"polygonRadius",{get:function(){return 2*t.linearSlop},enumerable:!1,configurable:!0}),t.lengthUnitsPerMeter=1,t.maxManifoldPoints=2,t.maxPolygonVertices=12,t.aabbExtension=.1,t.aabbMultiplier=2,t.linearSlop=.005,t.angularSlop=2/180*Oo,t.maxSubSteps=8,t.maxTOIContacts=32,t.maxTOIIterations=20,t.maxDistanceIterations=20,t.velocityThreshold=1,t.maxLinearCorrection=.2,t.maxAngularCorrection=8/180*Oo,t.maxTranslation=2,t.maxRotation=.5*Oo,t.baumgarte=.2,t.toiBaugarte=.75,t.timeToSleep=.5,t.linearSleepTolerance=.01,t.angularSleepTolerance=2/180*Oo,t}(),Ro=function(){function t(){}return Object.defineProperty(t,"maxManifoldPoints",{get:function(){return jo.maxManifoldPoints},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxPolygonVertices",{get:function(){return jo.maxPolygonVertices},enumerable:!1,configurable:!0}),Object.defineProperty(t,"aabbExtension",{get:function(){return jo.aabbExtension*jo.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"aabbMultiplier",{get:function(){return jo.aabbMultiplier},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSlop",{get:function(){return jo.linearSlop*jo.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSlopSquared",{get:function(){return jo.linearSlop*jo.lengthUnitsPerMeter*jo.linearSlop*jo.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"angularSlop",{get:function(){return jo.angularSlop},enumerable:!1,configurable:!0}),Object.defineProperty(t,"polygonRadius",{get:function(){return 2*jo.linearSlop},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxSubSteps",{get:function(){return jo.maxSubSteps},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTOIContacts",{get:function(){return jo.maxTOIContacts},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTOIIterations",{get:function(){return jo.maxTOIIterations},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxDistanceIterations",{get:function(){return jo.maxDistanceIterations},enumerable:!1,configurable:!0}),Object.defineProperty(t,"velocityThreshold",{get:function(){return jo.velocityThreshold*jo.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxLinearCorrection",{get:function(){return jo.maxLinearCorrection*jo.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxAngularCorrection",{get:function(){return jo.maxAngularCorrection},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTranslation",{get:function(){return jo.maxTranslation*jo.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTranslationSquared",{get:function(){return jo.maxTranslation*jo.lengthUnitsPerMeter*jo.maxTranslation*jo.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxRotation",{get:function(){return jo.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxRotationSquared",{get:function(){return jo.maxRotation*jo.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(t,"baumgarte",{get:function(){return jo.baumgarte},enumerable:!1,configurable:!0}),Object.defineProperty(t,"toiBaugarte",{get:function(){return jo.toiBaugarte},enumerable:!1,configurable:!0}),Object.defineProperty(t,"timeToSleep",{get:function(){return jo.timeToSleep},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSleepTolerance",{get:function(){return jo.linearSleepTolerance*jo.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSleepToleranceSqr",{get:function(){return jo.linearSleepTolerance*jo.lengthUnitsPerMeter*jo.linearSleepTolerance*jo.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"angularSleepTolerance",{get:function(){return jo.angularSleepTolerance},enumerable:!1,configurable:!0}),Object.defineProperty(t,"angularSleepToleranceSqr",{get:function(){return jo.angularSleepTolerance*jo.angularSleepTolerance},enumerable:!1,configurable:!0}),t}(),Eo=function(){function t(t){this._list=[],this._max=1/0,this._hasCreateFn=!1,this._createCount=0,this._hasAllocateFn=!1,this._allocateCount=0,this._hasReleaseFn=!1,this._releaseCount=0,this._hasDisposeFn=!1,this._disposeCount=0,this._list=[],this._max=t.max||this._max,this._createFn=t.create,this._hasCreateFn="function"==typeof this._createFn,this._allocateFn=t.allocate,this._hasAllocateFn="function"==typeof this._allocateFn,this._releaseFn=t.release,this._hasReleaseFn="function"==typeof this._releaseFn,this._disposeFn=t.dispose,this._hasDisposeFn="function"==typeof this._disposeFn}return t.prototype.max=function(t){return"number"==typeof t?(this._max=t,this):this._max},t.prototype.size=function(){return this._list.length},t.prototype.allocate=function(){var t;return this._list.length>0?t=this._list.shift():(this._createCount++,t=this._hasCreateFn?this._createFn():{}),this._allocateCount++,this._hasAllocateFn&&this._allocateFn(t),t},t.prototype.release=function(t){this._list.length<this._max?(this._releaseCount++,this._hasReleaseFn&&this._releaseFn(t),this._list.push(t)):(this._disposeCount++,this._hasDisposeFn&&(t=this._disposeFn(t)))},t.prototype.toString=function(){return" +"+this._createCount+" >"+this._allocateCount+" <"+this._releaseCount+" -"+this._disposeCount+" ="+this._list.length+"/"+this._max},t}(),Yo=Math.abs,Jo=Math.max,Wo=function(){function t(t){this.aabb=new Do,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.id=t}return t.prototype.toString=function(){return this.id+": "+this.userData},t.prototype.isLeaf=function(){return null==this.child1},t}(),Uo=new Eo({create:function(){return new Wo},release:function(t){t.userData=null,t.parent=null,t.child1=null,t.child2=null,t.height=-1,t.id=void 0}}),Ho=function(){function t(){this.inputPool=new Eo({create:function(){return{}},release:function(t){}}),this.stackPool=new Eo({create:function(){return[]},release:function(t){t.length=0}}),this.iteratorPool=new Eo({create:function(){return new Go},release:function(t){t.close()}}),this.m_root=null,this.m_nodes={},this.m_lastProxyId=0}return t.prototype.getUserData=function(t){return this.m_nodes[t].userData},t.prototype.getFatAABB=function(t){return this.m_nodes[t].aabb},t.prototype.allocateNode=function(){var t=Uo.allocate();return t.id=++this.m_lastProxyId,this.m_nodes[t.id]=t,t},t.prototype.freeNode=function(t){delete this.m_nodes[t.id],Uo.release(t)},t.prototype.createProxy=function(t,e){var i=this.allocateNode();return i.aabb.set(t),Do.extend(i.aabb,Ro.aabbExtension),i.userData=e,i.height=0,this.insertLeaf(i),i.id},t.prototype.destroyProxy=function(t){var e=this.m_nodes[t];this.removeLeaf(e),this.freeNode(e)},t.prototype.moveProxy=function(t,e,i){var s=this.m_nodes[t];return!s.aabb.contains(e)&&(this.removeLeaf(s),s.aabb.set(e),e=s.aabb,Do.extend(e,Ro.aabbExtension),i.x<0?e.lowerBound.x+=i.x*Ro.aabbMultiplier:e.upperBound.x+=i.x*Ro.aabbMultiplier,i.y<0?e.lowerBound.y+=i.y*Ro.aabbMultiplier:e.upperBound.y+=i.y*Ro.aabbMultiplier,this.insertLeaf(s),!0)},t.prototype.insertLeaf=function(t){if(null==this.m_root)return this.m_root=t,void(this.m_root.parent=null);for(var e=t.aabb,i=this.m_root;!i.isLeaf();){var s=i.child1,o=i.child2,n=i.aabb.getPerimeter(),r=Do.combinedPerimeter(i.aabb,e),a=2*r,l=2*(r-n),c=Do.combinedPerimeter(e,s.aabb)+l;s.isLeaf()||(c-=s.aabb.getPerimeter());var h=Do.combinedPerimeter(e,o.aabb)+l;if(o.isLeaf()||(h-=o.aabb.getPerimeter()),a<c&&a<h)break;i=c<h?s:o}var m=i,u=m.parent,_=this.allocateNode();for(_.parent=u,_.userData=null,_.aabb.combine(e,m.aabb),_.height=m.height+1,null!=u?(u.child1===m?u.child1=_:u.child2=_,_.child1=m,_.child2=t,m.parent=_,t.parent=_):(_.child1=m,_.child2=t,m.parent=_,t.parent=_,this.m_root=_),i=t.parent;null!=i;)s=(i=this.balance(i)).child1,o=i.child2,i.height=1+Jo(s.height,o.height),i.aabb.combine(s.aabb,o.aabb),i=i.parent},t.prototype.removeLeaf=function(t){if(t!==this.m_root){var e,i=t.parent,s=i.parent;if(e=i.child1===t?i.child2:i.child1,null!=s){s.child1===i?s.child1=e:s.child2=e,e.parent=s,this.freeNode(i);for(var o=s;null!=o;){var n=(o=this.balance(o)).child1,r=o.child2;o.aabb.combine(n.aabb,r.aabb),o.height=1+Jo(n.height,r.height),o=o.parent}}else this.m_root=e,e.parent=null,this.freeNode(i)}else this.m_root=null},t.prototype.balance=function(t){var e=t;if(e.isLeaf()||e.height<2)return t;var i=e.child1,s=e.child2,o=s.height-i.height;if(o>1){var n=s.child1,r=s.child2;return s.child1=e,s.parent=e.parent,e.parent=s,null!=s.parent?s.parent.child1===t?s.parent.child1=s:s.parent.child2=s:this.m_root=s,n.height>r.height?(s.child2=n,e.child2=r,r.parent=e,e.aabb.combine(i.aabb,r.aabb),s.aabb.combine(e.aabb,n.aabb),e.height=1+Jo(i.height,r.height),s.height=1+Jo(e.height,n.height)):(s.child2=r,e.child2=n,n.parent=e,e.aabb.combine(i.aabb,n.aabb),s.aabb.combine(e.aabb,r.aabb),e.height=1+Jo(i.height,n.height),s.height=1+Jo(e.height,r.height)),s}if(o<-1){var a=i.child1,l=i.child2;return i.child1=e,i.parent=e.parent,e.parent=i,null!=i.parent?i.parent.child1===e?i.parent.child1=i:i.parent.child2=i:this.m_root=i,a.height>l.height?(i.child2=a,e.child1=l,l.parent=e,e.aabb.combine(s.aabb,l.aabb),i.aabb.combine(e.aabb,a.aabb),e.height=1+Jo(s.height,l.height),i.height=1+Jo(e.height,a.height)):(i.child2=l,e.child1=a,a.parent=e,e.aabb.combine(s.aabb,a.aabb),i.aabb.combine(e.aabb,l.aabb),e.height=1+Jo(s.height,a.height),i.height=1+Jo(e.height,l.height)),i}return e},t.prototype.getHeight=function(){return null==this.m_root?0:this.m_root.height},t.prototype.getAreaRatio=function(){if(null==this.m_root)return 0;for(var t,e=this.m_root.aabb.getPerimeter(),i=0,s=this.iteratorPool.allocate().preorder(this.m_root);t=s.next();)t.height<0||(i+=t.aabb.getPerimeter());return this.iteratorPool.release(s),i/e},t.prototype.computeHeight=function(t){var e;if((e=void 0!==t?this.m_nodes[t]:this.m_root).isLeaf())return 0;var i=this.computeHeight(e.child1.id),s=this.computeHeight(e.child2.id);return 1+Jo(i,s)},t.prototype.validateStructure=function(t){if(null!=t){this.m_root;var e=t.child1,i=t.child2;t.isLeaf()||(this.validateStructure(e),this.validateStructure(i))}},t.prototype.validateMetrics=function(t){if(null!=t){var e=t.child1,i=t.child2;t.isLeaf()||(e.height,i.height,(new Do).combine(e.aabb,i.aabb),this.validateMetrics(e),this.validateMetrics(i))}},t.prototype.validate=function(){},t.prototype.getMaxBalance=function(){for(var t,e=0,i=this.iteratorPool.allocate().preorder(this.m_root);t=i.next();)if(!(t.height<=1)){var s=Yo(t.child2.height-t.child1.height);e=Jo(e,s)}return this.iteratorPool.release(i),e},t.prototype.rebuildBottomUp=function(){for(var t,e=[],i=0,s=this.iteratorPool.allocate().preorder(this.m_root);t=s.next();)t.height<0||(t.isLeaf()?(t.parent=null,e[i]=t,++i):this.freeNode(t));for(this.iteratorPool.release(s);i>1;){for(var o=1/0,n=-1,r=-1,a=0;a<i;++a)for(var l=e[a].aabb,c=a+1;c<i;++c){var h=e[c].aabb,m=Do.combinedPerimeter(l,h);m<o&&(n=a,r=c,o=m)}var u=e[n],_=e[r],p=this.allocateNode();p.child1=u,p.child2=_,p.height=1+Jo(u.height,_.height),p.aabb.combine(u.aabb,_.aabb),p.parent=null,u.parent=p,_.parent=p,e[r]=e[i-1],e[n]=p,--i}this.m_root=e[0]},t.prototype.shiftOrigin=function(t){for(var e,i=this.iteratorPool.allocate().preorder(this.m_root);e=i.next();){var s=e.aabb;s.lowerBound.x-=t.x,s.lowerBound.y-=t.y,s.upperBound.x-=t.x,s.upperBound.y-=t.y}this.iteratorPool.release(i)},t.prototype.query=function(t,e){var i=this.stackPool.allocate();for(i.push(this.m_root);i.length>0;){var s=i.pop();if(null!=s&&Do.testOverlap(s.aabb,t))if(s.isLeaf()){if(!1===e(s.id))return}else i.push(s.child1),i.push(s.child2)}this.stackPool.release(i)},t.prototype.rayCast=function(t,e){var i=t.p1,s=t.p2,o=ko.sub(s,i);o.normalize();var n=ko.crossNumVec2(1,o),r=ko.abs(n),a=t.maxFraction,l=new Do,c=ko.combine(1-a,i,a,s);l.combinePoints(i,c);var h=this.stackPool.allocate(),m=this.inputPool.allocate();for(h.push(this.m_root);h.length>0;){var u=h.pop();if(null!=u&&!1!==Do.testOverlap(u.aabb,l)){var _=u.aabb.getCenter(),p=u.aabb.getExtents();if(!(Yo(ko.dot(n,ko.sub(i,_)))-ko.dot(r,p)>0))if(u.isLeaf()){m.p1=ko.clone(t.p1),m.p2=ko.clone(t.p2),m.maxFraction=a;var d=e(m,u.id);if(0===d)return;d>0&&(a=d,c=ko.combine(1-a,i,a,s),l.combinePoints(i,c))}else h.push(u.child1),h.push(u.child2)}}this.stackPool.release(h),this.inputPool.release(m)},t}(),Go=function(){function t(){this.parents=[],this.states=[]}return t.prototype.preorder=function(t){return this.parents.length=0,this.parents.push(t),this.states.length=0,this.states.push(0),this},t.prototype.next=function(){for(;this.parents.length>0;){var t=this.parents.length-1,e=this.parents[t];if(0===this.states[t])return this.states[t]=1,e;if(1===this.states[t]&&(this.states[t]=2,e.child1))return this.parents.push(e.child1),this.states.push(1),e.child1;if(2===this.states[t]&&(this.states[t]=3,e.child2))return this.parents.push(e.child2),this.states.push(1),e.child2;this.parents.pop(),this.states.pop()}},t.prototype.close=function(){this.parents.length=0},t}(),Xo=Math.max,Ko=Math.min,Zo=function(){function t(){var t=this;this.m_tree=new Ho,this.m_moveBuffer=[],this.query=function(e,i){t.m_tree.query(e,i)},this.queryCallback=function(e){if(e===t.m_queryProxyId)return!0;var i=Ko(e,t.m_queryProxyId),s=Xo(e,t.m_queryProxyId),o=t.m_tree.getUserData(i),n=t.m_tree.getUserData(s);return t.m_callback(o,n),!0}}return t.prototype.getUserData=function(t){return this.m_tree.getUserData(t)},t.prototype.testOverlap=function(t,e){var i=this.m_tree.getFatAABB(t),s=this.m_tree.getFatAABB(e);return Do.testOverlap(i,s)},t.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},t.prototype.getProxyCount=function(){return this.m_moveBuffer.length},t.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},t.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},t.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},t.prototype.rayCast=function(t,e){this.m_tree.rayCast(t,e)},t.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},t.prototype.createProxy=function(t,e){var i=this.m_tree.createProxy(t,e);return this.bufferMove(i),i},t.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_tree.destroyProxy(t)},t.prototype.moveProxy=function(t,e,i){this.m_tree.moveProxy(t,e,i)&&this.bufferMove(t)},t.prototype.touchProxy=function(t){this.bufferMove(t)},t.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},t.prototype.unbufferMove=function(t){for(var e=0;e<this.m_moveBuffer.length;++e)this.m_moveBuffer[e]===t&&(this.m_moveBuffer[e]=null)},t.prototype.updatePairs=function(t){for(this.m_callback=t;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),null!==this.m_queryProxyId){var e=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(e,this.queryCallback)}},t}(),$o=Math.sin,Qo=Math.cos,tn=Math.sqrt;function en(t,e){return{x:t,y:e}}function sn(t,e,i){return t.x=e,t.y=i,t}function on(t,e){return t.x=e.x,t.y=e.y,t}function nn(t){return t.x=0,t.y=0,t}function rn(t){return t.x=-t.x,t.y=-t.y,t}function an(t,e){return t.x+=e.x,t.y+=e.y,t}function ln(t,e){return t.x-=e.x,t.y-=e.y,t}function cn(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t}function hn(t,e){return t.x*=e,t.y*=e,t}function mn(t,e,i){return t.x=e*i.x,t.y=e*i.y,t}function un(t,e,i){return t.x+=e*i.x,t.y+=e*i.y,t}function _n(t,e,i){return t.x-=e*i.x,t.y-=e*i.y,t}function pn(t,e,i,s,o){return t.x=e*i.x+s*o.x,t.y=e*i.y+s*o.y,t}function dn(t,e,i,s,o,n,r){return t.x=e*i.x+s*o.x+n*r.x,t.y=e*i.y+s*o.y+n*r.y,t}function yn(t){var e=tn(t.x*t.x+t.y*t.y);if(e>0){var i=1/e;t.x*=i,t.y*=i}return t}function fn(t,e,i){var s=i*e.y,o=-i*e.x;return t.x=s,t.y=o,t}function vn(t,e,i){var s=-e*i.y,o=e*i.x;return t.x=s,t.y=o,t}function gn(t,e){return t.x*e.y-t.y*e.x}function xn(t,e){return t.x*e.x+t.y*e.y}function bn(t){return t.x*t.x+t.y*t.y}function An(t,e){var i=t.x-e.x,s=t.y-e.y;return tn(i*i+s*s)}function Bn(t,e){var i=t.x-e.x,s=t.y-e.y;return i*i+s*s}function wn(t,e,i){return t.x=e.c*i.x-e.s*i.y,t.y=e.s*i.x+e.c*i.y,t}function Vn(t,e,i){var s=e.c*i.x+e.s*i.y,o=-e.s*i.x+e.c*i.y;return t.x=s,t.y=o,t}function Cn(t,e,i){return{p:en(t,e),q:(s=i,{s:$o(s),c:Qo(s)})};var s}function Sn(t,e){return t.p.x=e.p.x,t.p.y=e.p.y,t.q.s=e.q.s,t.q.c=e.q.c,t}function Mn(t,e,i){var s=e.q.c*i.x-e.q.s*i.y+e.p.x,o=e.q.s*i.x+e.q.c*i.y+e.p.y;return t.x=s,t.y=o,t}function Pn(t,e,i){var s=i.x-e.p.x,o=i.y-e.p.y,n=e.q.c*s+e.q.s*o,r=-e.q.s*s+e.q.c*o;return t.x=n,t.y=r,t}function zn(t,e,i,s){var o=e.q.c*s.x-e.q.s*s.y+e.p.x,n=e.q.s*s.x+e.q.c*s.y+e.p.y,r=o-i.p.x,a=n-i.p.y,l=i.q.c*r+i.q.s*a,c=-i.q.s*r+i.q.c*a;return t.x=l,t.y=c,t}function In(t,e,i){var s=e.q.c*i.q.c+e.q.s*i.q.s,o=e.q.c*i.q.s-e.q.s*i.q.c,n=e.q.c*(i.p.x-e.p.x)+e.q.s*(i.p.y-e.p.y),r=-e.q.s*(i.p.x-e.p.x)+e.q.c*(i.p.y-e.p.y);return t.q.c=s,t.q.s=o,t.p.x=n,t.p.y=r,t}var Fn=Math.sin,Tn=Math.cos,Ln=Math.atan2,kn=function(){function t(e){if(!(this instanceof t))return new t(e);"number"==typeof e?this.setAngle(e):"object"==typeof e?this.setRot(e):this.setIdentity()}return t.neo=function(e){var i=Object.create(t.prototype);return i.setAngle(e),i},t.clone=function(e){var i=Object.create(t.prototype);return i.s=e.s,i.c=e.c,i},t.identity=function(){var e=Object.create(t.prototype);return e.s=0,e.c=1,e},t.isValid=function(t){return null!=t&&Number.isFinite(t.s)&&Number.isFinite(t.c)},t.assert=function(t){},t.prototype.setIdentity=function(){this.s=0,this.c=1},t.prototype.set=function(t){"object"==typeof t?(this.s=t.s,this.c=t.c):(this.s=Fn(t),this.c=Tn(t))},t.prototype.setRot=function(t){this.s=t.s,this.c=t.c},t.prototype.setAngle=function(t){this.s=Fn(t),this.c=Tn(t)},t.prototype.getAngle=function(){return Ln(this.s,this.c)},t.prototype.getXAxis=function(){return ko.neo(this.c,this.s)},t.prototype.getYAxis=function(){return ko.neo(-this.s,this.c)},t.mul=function(e,i){if("c"in i&&"s"in i){var s=t.identity();return s.s=e.s*i.c+e.c*i.s,s.c=e.c*i.c-e.s*i.s,s}if("x"in i&&"y"in i)return ko.neo(e.c*i.x-e.s*i.y,e.s*i.x+e.c*i.y)},t.mulRot=function(e,i){var s=t.identity();return s.s=e.s*i.c+e.c*i.s,s.c=e.c*i.c-e.s*i.s,s},t.mulVec2=function(t,e){return ko.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},t.mulSub=function(t,e,i){var s=t.c*(e.x-i.x)-t.s*(e.y-i.y),o=t.s*(e.x-i.x)+t.c*(e.y-i.y);return ko.neo(s,o)},t.mulT=function(e,i){if("c"in i&&"s"in i){var s=t.identity();return s.s=e.c*i.s-e.s*i.c,s.c=e.c*i.c+e.s*i.s,s}if("x"in i&&"y"in i)return ko.neo(e.c*i.x+e.s*i.y,-e.s*i.x+e.c*i.y)},t.mulTRot=function(e,i){var s=t.identity();return s.s=e.c*i.s-e.s*i.c,s.c=e.c*i.c+e.s*i.s,s},t.mulTVec2=function(t,e){return ko.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},t}(),qn=Math.atan2,Nn=Math.PI,Dn=en(0,0),On=function(){function t(){this.localCenter=ko.zero(),this.c=ko.zero(),this.a=0,this.alpha0=0,this.c0=ko.zero(),this.a0=0}return t.prototype.recycle=function(){nn(this.localCenter),nn(this.c),this.a=0,this.alpha0=0,nn(this.c0),this.a0=0},t.prototype.setTransform=function(t){Mn(Dn,t,this.localCenter),on(this.c,Dn),on(this.c0,Dn),this.a=this.a0=qn(t.q.s,t.q.c)},t.prototype.setLocalCenter=function(t,e){on(this.localCenter,t),Mn(Dn,e,this.localCenter),on(this.c,Dn),on(this.c0,Dn)},t.prototype.getTransform=function(t,e){var i,s;void 0===e&&(e=0),i=t.q,s=(1-e)*this.a0+e*this.a,i.c=Qo(s),i.s=$o(s),pn(t.p,1-e,this.c0,e,this.c),ln(t.p,wn(Dn,t.q,this.localCenter))},t.prototype.advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0);pn(this.c0,e,this.c,1-e,this.c0),this.a0=e*this.a+(1-e)*this.a0,this.alpha0=t},t.prototype.forward=function(){this.a0=this.a,on(this.c0,this.c)},t.prototype.normalize=function(){var t=Mo(this.a0,-Nn,+Nn);this.a-=this.a0-t,this.a0=t},t.prototype.set=function(t){on(this.localCenter,t.localCenter),on(this.c,t.c),this.a=t.a,this.alpha0=t.alpha0,on(this.c0,t.c0),this.a0=t.a0},t}(),jn=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);this.p=ko.zero(),this.q=kn.identity(),void 0!==e&&this.p.setVec2(e),void 0!==i&&this.q.setAngle(i)}return t.clone=function(e){var i=Object.create(t.prototype);return i.p=ko.clone(e.p),i.q=kn.clone(e.q),i},t.neo=function(e,i){var s=Object.create(t.prototype);return s.p=ko.clone(e),s.q=kn.clone(i),s},t.identity=function(){var e=Object.create(t.prototype);return e.p=ko.zero(),e.q=kn.identity(),e},t.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},t.prototype.set=function(t,e){void 0===e?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(e))},t.prototype.setNum=function(t,e){this.p.setVec2(t),this.q.setAngle(e)},t.prototype.setTransform=function(t){this.p.setVec2(t.p),this.q.setRot(t.q)},t.isValid=function(t){return null!=t&&ko.isValid(t.p)&&kn.isValid(t.q)},t.assert=function(t){},t.mul=function(e,i){if(Array.isArray(i)){for(var s=[],o=0;o<i.length;o++)s[o]=t.mul(e,i[o]);return s}return"x"in i&&"y"in i?t.mulVec2(e,i):"p"in i&&"q"in i?t.mulXf(e,i):void 0},t.mulAll=function(e,i){for(var s=[],o=0;o<i.length;o++)s[o]=t.mul(e,i[o]);return s},t.mulFn=function(e){return function(i){return t.mul(e,i)}},t.mulVec2=function(t,e){var i=t.q.c*e.x-t.q.s*e.y+t.p.x,s=t.q.s*e.x+t.q.c*e.y+t.p.y;return ko.neo(i,s)},t.mulXf=function(e,i){var s=t.identity();return s.q=kn.mulRot(e.q,i.q),s.p=ko.add(kn.mulVec2(e.q,i.p),e.p),s},t.mulT=function(e,i){return"x"in i&&"y"in i?t.mulTVec2(e,i):"p"in i&&"q"in i?t.mulTXf(e,i):void 0},t.mulTVec2=function(t,e){var i=e.x-t.p.x,s=e.y-t.p.y,o=t.q.c*i+t.q.s*s,n=-t.q.s*i+t.q.c*s;return ko.neo(o,n)},t.mulTXf=function(e,i){var s=t.identity();return s.q.setRot(kn.mulTRot(e.q,i.q)),s.p.setVec2(kn.mulTVec2(e.q,ko.sub(i.p,e.p))),s},t}(),Rn=function(){return function(){this.v=ko.zero(),this.w=0}}(),En=Math.sin,Yn=Math.cos,Jn=function(){function t(){this.c=ko.zero(),this.a=0}return t.prototype.getTransform=function(t,e){return t.q.c=Yn(this.a),t.q.s=En(this.a),t.p.x=this.c.x-(t.q.c*e.x-t.q.s*e.y),t.p.y=this.c.y-(t.q.s*e.x+t.q.c*e.y),t},t}();function Wn(t,e,i,s){return t.q.c=Yn(s),t.q.s=En(s),t.p.x=i.x-(t.q.c*e.x-t.q.s*e.y),t.p.y=i.y-(t.q.s*e.x+t.q.c*e.y),t}var Un=function(){function t(){this.style={},this.appData={}}return t.isValid=function(t){return null!=t&&"string"==typeof t.m_type&&"number"==typeof t.m_radius},t}(),Hn=new Do,Gn=new Do,Xn=en(0,0),Kn={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535},Zn=function(){return function(t,e){this.aabb=new Do,this.fixture=t,this.childIndex=e,this.proxyId}}(),$n=function(){function t(t,e,i){this.style={},this.appData={},e.shape?(i=e,e=e.shape):"number"==typeof i&&(i={density:i}),i=wo(i,Kn),this.m_body=t,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_density=i.density,this.m_isSensor=i.isSensor,this.m_filterGroupIndex=i.filterGroupIndex,this.m_filterCategoryBits=i.filterCategoryBits,this.m_filterMaskBits=i.filterMaskBits,this.m_shape=e,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var s=this.m_shape.getChildCount(),o=0;o<s;++o)this.m_proxies[o]=new Zn(this,o);this.m_userData=i.userData}return t.prototype._reset=function(){var t=this.getBody(),e=t.m_world.m_broadPhase;this.destroyProxies(e),this.m_shape._reset&&this.m_shape._reset();for(var i=this.m_shape.getChildCount(),s=0;s<i;++s)this.m_proxies[s]=new Zn(this,s);this.createProxies(e,t.m_xf),t.resetMassData()},t.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},t._deserialize=function(e,i,s){var o=s(Un,e.shape);return o&&new t(i,o,e)},t.prototype.getType=function(){return this.m_shape.m_type},t.prototype.getShape=function(){return this.m_shape},t.prototype.isSensor=function(){return this.m_isSensor},t.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},t.prototype.getUserData=function(){return this.m_userData},t.prototype.setUserData=function(t){this.m_userData=t},t.prototype.getBody=function(){return this.m_body},t.prototype.getNext=function(){return this.m_next},t.prototype.getDensity=function(){return this.m_density},t.prototype.setDensity=function(t){this.m_density=t},t.prototype.getFriction=function(){return this.m_friction},t.prototype.setFriction=function(t){this.m_friction=t},t.prototype.getRestitution=function(){return this.m_restitution},t.prototype.setRestitution=function(t){this.m_restitution=t},t.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},t.prototype.rayCast=function(t,e,i){return this.m_shape.rayCast(t,e,this.m_body.getTransform(),i)},t.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},t.prototype.getAABB=function(t){return this.m_proxies[t].aabb},t.prototype.createProxies=function(t,e){this.m_proxyCount=this.m_shape.getChildCount();for(var i=0;i<this.m_proxyCount;++i){var s=this.m_proxies[i];this.m_shape.computeAABB(s.aabb,e,i),s.proxyId=t.createProxy(s.aabb,s)}},t.prototype.destroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];t.destroyProxy(i.proxyId),i.proxyId=null}this.m_proxyCount=0},t.prototype.synchronize=function(t,e,i){for(var s=0;s<this.m_proxyCount;++s){var o=this.m_proxies[s];this.m_shape.computeAABB(Hn,e,o.childIndex),this.m_shape.computeAABB(Gn,i,o.childIndex),o.aabb.combine(Hn,Gn),cn(Xn,i.p,e.p),t.moveProxy(o.proxyId,o.aabb,Xn)}},t.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},t.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},t.prototype.setFilterGroupIndex=function(t){this.m_filterGroupIndex=t,this.refilter()},t.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},t.prototype.setFilterCategoryBits=function(t){this.m_filterCategoryBits=t,this.refilter()},t.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},t.prototype.setFilterMaskBits=function(t){this.m_filterMaskBits=t,this.refilter()},t.prototype.refilter=function(){if(null!=this.m_body){for(var t=this.m_body.getContactList();t;){var e=t.contact,i=e.getFixtureA(),s=e.getFixtureB();i!=this&&s!=this||e.flagForFiltering(),t=t.next}var o=this.m_body.getWorld();if(null!=o)for(var n=o.m_broadPhase,r=0;r<this.m_proxyCount;++r)n.touchProxy(this.m_proxies[r].proxyId)}},t.prototype.shouldCollide=function(t){if(t.m_filterGroupIndex===this.m_filterGroupIndex&&0!==t.m_filterGroupIndex)return t.m_filterGroupIndex>0;var e=0!=(t.m_filterMaskBits&this.m_filterCategoryBits),i=0!=(t.m_filterCategoryBits&this.m_filterMaskBits);return e&&i},t}(),Qn="static",tr="kinematic",er="dynamic",ir=en(0,0),sr=en(0,0),or=en(0,0),nr=en(0,0),rr=Cn(0,0,0),ar={type:Qn,position:ko.zero(),angle:0,linearVelocity:ko.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null},lr=function(){function t(t,e){this.style={},this.appData={},e=wo(e,ar),this.m_world=t,this.m_awakeFlag=e.awake,this.m_autoSleepFlag=e.allowSleep,this.m_bulletFlag=e.bullet,this.m_fixedRotationFlag=e.fixedRotation,this.m_activeFlag=e.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=e.userData,this.m_type=e.type,this.m_type==er?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=jn.identity(),this.m_xf.p.setVec2(e.position),this.m_xf.q.setAngle(e.angle),this.m_sweep=new On,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new Rn,this.c_position=new Jn,this.m_force=ko.zero(),this.m_torque=0,this.m_linearVelocity=ko.clone(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1}return t.prototype._serialize=function(){for(var t=[],e=this.m_fixtureList;e;e=e.m_next)t.push(e);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:t}},t._deserialize=function(e,i,s){var o=new t(i,e);if(e.fixtures)for(var n=e.fixtures.length-1;n>=0;n--){var r=s($n,e.fixtures[n],o);o._addFixture(r)}return o},t.prototype.isWorldLocked=function(){return!(!this.m_world||!this.m_world.isLocked())},t.prototype.getWorld=function(){return this.m_world},t.prototype.getNext=function(){return this.m_next},t.prototype.setUserData=function(t){this.m_userData=t},t.prototype.getUserData=function(){return this.m_userData},t.prototype.getFixtureList=function(){return this.m_fixtureList},t.prototype.getJointList=function(){return this.m_jointList},t.prototype.getContactList=function(){return this.m_contactList},t.prototype.isStatic=function(){return this.m_type==Qn},t.prototype.isDynamic=function(){return this.m_type==er},t.prototype.isKinematic=function(){return this.m_type==tr},t.prototype.setStatic=function(){return this.setType(Qn),this},t.prototype.setDynamic=function(){return this.setType(er),this},t.prototype.setKinematic=function(){return this.setType(tr),this},t.prototype.getType=function(){return this.m_type},t.prototype.setType=function(t){if(1!=this.isWorldLocked()&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==Qn&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e;e=e.next,this.m_world.destroyContact(i.contact)}this.m_contactList=null;for(var s=this.m_world.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)for(var n=0;n<o.m_proxyCount;++n)s.touchProxy(o.m_proxies[n].proxyId)}},t.prototype.isBullet=function(){return this.m_bulletFlag},t.prototype.setBullet=function(t){this.m_bulletFlag=!!t},t.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},t.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,0==this.m_autoSleepFlag&&this.setAwake(!0)},t.prototype.isAwake=function(){return this.m_awakeFlag},t.prototype.setAwake=function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},t.prototype.isActive=function(){return this.m_activeFlag},t.prototype.setActive=function(t){if(t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag){for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.createProxies(e,this.m_xf);this.m_world.m_newFixture=!0}else{for(e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.destroyProxies(e);for(var s=this.m_contactList;s;){var o=s;s=s.next,this.m_world.destroyContact(o.contact)}this.m_contactList=null}},t.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},t.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},t.prototype.getTransform=function(){return this.m_xf},t.prototype.setTransform=function(t,e){if(1!=this.isWorldLocked()){this.m_xf.setNum(t,e),this.m_sweep.setTransform(this.m_xf);for(var i=this.m_world.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)s.synchronize(i,this.m_xf,this.m_xf);this.setAwake(!0)}},t.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},t.prototype.synchronizeFixtures=function(){this.m_sweep.getTransform(rr,0);for(var t=this.m_world.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.synchronize(t,rr,this.m_xf)},t.prototype.advance=function(t){this.m_sweep.advance(t),on(this.m_sweep.c,this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},t.prototype.getPosition=function(){return this.m_xf.p},t.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},t.prototype.getAngle=function(){return this.m_sweep.a},t.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},t.prototype.getWorldCenter=function(){return this.m_sweep.c},t.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},t.prototype.getLinearVelocity=function(){return this.m_linearVelocity},t.prototype.getLinearVelocityFromWorldPoint=function(t){var e=ko.sub(t,this.m_sweep.c);return ko.add(this.m_linearVelocity,ko.crossNumVec2(this.m_angularVelocity,e))},t.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},t.prototype.setLinearVelocity=function(t){this.m_type!=Qn&&(ko.dot(t,t)>0&&this.setAwake(!0),this.m_linearVelocity.setVec2(t))},t.prototype.getAngularVelocity=function(){return this.m_angularVelocity},t.prototype.setAngularVelocity=function(t){this.m_type!=Qn&&(t*t>0&&this.setAwake(!0),this.m_angularVelocity=t)},t.prototype.getLinearDamping=function(){return this.m_linearDamping},t.prototype.setLinearDamping=function(t){this.m_linearDamping=t},t.prototype.getAngularDamping=function(){return this.m_angularDamping},t.prototype.setAngularDamping=function(t){this.m_angularDamping=t},t.prototype.getGravityScale=function(){return this.m_gravityScale},t.prototype.setGravityScale=function(t){this.m_gravityScale=t},t.prototype.getMass=function(){return this.m_mass},t.prototype.getInertia=function(){return this.m_I+this.m_mass*ko.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},t.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),on(t.center,this.m_sweep.localCenter)},t.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,nn(this.m_sweep.localCenter),this.isStatic()||this.isKinematic())return on(this.m_sweep.c0,this.m_xf.p),on(this.m_sweep.c,this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);nn(sr);for(var t=this.m_fixtureList;t;t=t.m_next)if(0!=t.m_density){var e={mass:0,center:en(0,0),I:0};t.getMassData(e),this.m_mass+=e.mass,un(sr,e.mass,e.center),this.m_I+=e.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,mn(sr,this.m_invMass,sr)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==this.m_fixedRotationFlag?(this.m_I-=this.m_mass*xn(sr,sr),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0),on(ir,this.m_sweep.c),this.m_sweep.setLocalCenter(sr,this.m_xf),cn(or,this.m_sweep.c,ir),vn(nr,this.m_angularVelocity,or),an(this.m_linearVelocity,nr)},t.prototype.setMassData=function(t){1!=this.isWorldLocked()&&this.m_type==er&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&0==this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*xn(t.center,t.center),this.m_invI=1/this.m_I),on(ir,this.m_sweep.c),this.m_sweep.setLocalCenter(t.center,this.m_xf),cn(or,this.m_sweep.c,ir),vn(nr,this.m_angularVelocity,or),an(this.m_linearVelocity,nr))},t.prototype.applyForce=function(t,e,i){void 0===i&&(i=!0),this.m_type==er&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=ko.crossVec2Vec2(ko.sub(e,this.m_sweep.c),t)))},t.prototype.applyForceToCenter=function(t,e){void 0===e&&(e=!0),this.m_type==er&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},t.prototype.applyTorque=function(t,e){void 0===e&&(e=!0),this.m_type==er&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},t.prototype.applyLinearImpulse=function(t,e,i){void 0===i&&(i=!0),this.m_type==er&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*ko.crossVec2Vec2(ko.sub(e,this.m_sweep.c),t)))},t.prototype.applyAngularImpulse=function(t,e){void 0===e&&(e=!0),this.m_type==er&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},t.prototype.shouldCollide=function(t){if(this.m_type!=er&&t.m_type!=er)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0},t.prototype._addFixture=function(t){if(1==this.isWorldLocked())return null;if(this.m_activeFlag){var e=this.m_world.m_broadPhase;t.createProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,t.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,t},t.prototype.createFixture=function(t,e){if(1==this.isWorldLocked())return null;var i=new $n(this,t,e);return this._addFixture(i),i},t.prototype.destroyFixture=function(t){if(1!=this.isWorldLocked()){if(this.m_fixtureList===t)this.m_fixtureList=t.m_next;else for(var e=this.m_fixtureList;null!=e;){if(e.m_next===t){e.m_next=t.m_next;break}e=e.m_next}for(var i=this.m_contactList;i;){var s=i.contact;i=i.next;var o=s.getFixtureA(),n=s.getFixtureB();t!=o&&t!=n||this.m_world.destroyContact(s)}if(this.m_activeFlag){var r=this.m_world.m_broadPhase;t.destroyProxies(r)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},t.prototype.getWorldPoint=function(t){return jn.mulVec2(this.m_xf,t)},t.prototype.getWorldVector=function(t){return kn.mulVec2(this.m_xf.q,t)},t.prototype.getLocalPoint=function(t){return jn.mulTVec2(this.m_xf,t)},t.prototype.getLocalVector=function(t){return kn.mulTVec2(this.m_xf.q,t)},t.STATIC="static",t.KINEMATIC="kinematic",t.DYNAMIC="dynamic",t}(),cr=function(){return function(){this.other=null,this.joint=null,this.prev=null,this.next=null}}(),hr=function(){function t(t,e,i){this.m_type="unknown-joint",this.m_prev=null,this.m_next=null,this.m_edgeA=new cr,this.m_edgeB=new cr,this.m_islandFlag=!1,this.style={},this.appData={},e="bodyA"in t?t.bodyA:e,i="bodyB"in t?t.bodyB:i,this.m_bodyA=e,this.m_bodyB=i,this.m_collideConnected=!!t.collideConnected,this.m_userData=t.userData}return t.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},t.prototype.getType=function(){return this.m_type},t.prototype.getBodyA=function(){return this.m_bodyA},t.prototype.getBodyB=function(){return this.m_bodyB},t.prototype.getNext=function(){return this.m_next},t.prototype.getUserData=function(){return this.m_userData},t.prototype.setUserData=function(t){this.m_userData=t},t.prototype.getCollideConnected=function(){return this.m_collideConnected},t.prototype.shiftOrigin=function(t){},t.prototype._resetAnchors=function(t){return this._reset(t)},t}(),mr={gjkCalls:0,gjkIters:0,gjkMaxIters:0,toiTime:0,toiMaxTime:0,toiCalls:0,toiIters:0,toiMaxIters:0,toiRootIters:0,toiMaxRootIters:0,toString:function(t){t="string"==typeof t?t:"\n";var e="";for(var i in this)"function"!=typeof this[i]&&"object"!=typeof this[i]&&(e+=i+": "+this[i]+t);return e}},ur=Math.max,_r=en(0,0),pr=en(0,0),dr=en(0,0),yr=en(0,0),fr=en(0,0),vr=en(0,0),gr=en(0,0);mr.gjkCalls=0,mr.gjkIters=0,mr.gjkMaxIters=0;var xr=function(){function t(){this.proxyA=new wr,this.proxyB=new wr,this.transformA=jn.identity(),this.transformB=jn.identity(),this.useRadii=!1}return t.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),this.useRadii=!1},t}(),br=function(){function t(){this.pointA=en(0,0),this.pointB=en(0,0),this.distance=0,this.iterations=0}return t.prototype.recycle=function(){nn(this.pointA),nn(this.pointB),this.distance=0,this.iterations=0},t}(),Ar=function(){function t(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}return t.prototype.recycle=function(){this.metric=0,this.indexA.length=0,this.indexB.length=0,this.count=0},t}(),Br=function(t,e,i){++mr.gjkCalls;var s=i.proxyA,o=i.proxyB,n=i.transformA,r=i.transformB;Pr.recycle(),Pr.readCache(e,s,n,o,r);for(var a=Pr.m_v,l=Ro.maxDistanceIterations,c=[],h=[],m=0,u=0;u<l;){m=Pr.m_count;for(var _=0;_<m;++_)c[_]=a[_].indexA,h[_]=a[_].indexB;if(Pr.solve(),3===Pr.m_count)break;var p=Pr.getSearchDirection();if(bn(p)<1e-18)break;var d=a[Pr.m_count];d.indexA=s.getSupport(Vn(_r,n.q,mn(_r,-1,p))),Mn(d.wA,n,s.getVertex(d.indexA)),d.indexB=o.getSupport(Vn(_r,r.q,p)),Mn(d.wB,r,o.getVertex(d.indexB)),cn(d.w,d.wB,d.wA),++u,++mr.gjkIters;var y=!1;for(_=0;_<m;++_)if(d.indexA===c[_]&&d.indexB===h[_]){y=!0;break}if(y)break;++Pr.m_count}if(mr.gjkMaxIters=ur(mr.gjkMaxIters,u),Pr.getWitnessPoints(t.pointA,t.pointB),t.distance=An(t.pointA,t.pointB),t.iterations=u,Pr.writeCache(e),i.useRadii){var f=s.m_radius,v=o.m_radius;if(t.distance>f+v&&t.distance>Co)t.distance-=f+v,cn(pr,t.pointB,t.pointA),yn(pr),un(t.pointA,f,pr),_n(t.pointB,v,pr);else{var g=cn(_r,t.pointA,t.pointB);on(t.pointA,g),on(t.pointB,g),t.distance=0}}},wr=function(){function t(){this.m_vertices=[],this.m_count=0,this.m_radius=0}return t.prototype.recycle=function(){this.m_vertices.length=0,this.m_count=0,this.m_radius=0},t.prototype.getVertexCount=function(){return this.m_count},t.prototype.getVertex=function(t){return this.m_vertices[t]},t.prototype.getSupport=function(t){for(var e=-1,i=-1/0,s=0;s<this.m_count;++s){var o=xn(this.m_vertices[s],t);o>i&&(e=s,i=o)}return e},t.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},t.prototype.set=function(t,e){t.computeDistanceProxy(this,e)},t.prototype.setVertices=function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i},t}(),Vr=function(){function t(){this.wA=en(0,0),this.indexA=0,this.wB=en(0,0),this.indexB=0,this.w=en(0,0),this.a=0}return t.prototype.recycle=function(){this.indexA=0,this.indexB=0,nn(this.wA),nn(this.wB),nn(this.w),this.a=0},t.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,on(this.wA,t.wA),on(this.wB,t.wB),on(this.w,t.w),this.a=t.a},t}(),Cr=en(0,0),Sr=en(0,0),Mr=function(){function t(){this.m_v1=new Vr,this.m_v2=new Vr,this.m_v3=new Vr,this.m_v=[this.m_v1,this.m_v2,this.m_v3]}return t.prototype.recycle=function(){this.m_v1.recycle(),this.m_v2.recycle(),this.m_v3.recycle(),this.m_count=0},t.prototype.toString=function(){return 3===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():2===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():1===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},t.prototype.readCache=function(t,e,i,s,o){this.m_count=t.count;for(var n=0;n<this.m_count;++n){(h=this.m_v[n]).indexA=t.indexA[n],h.indexB=t.indexB[n];var r=e.getVertex(h.indexA),a=s.getVertex(h.indexB);Mn(h.wA,i,r),Mn(h.wB,o,a),cn(h.w,h.wB,h.wA),h.a=0}if(this.m_count>1){var l=t.metric,c=this.getMetric();(c<.5*l||2*l<c||c<Co)&&(this.m_count=0)}var h;0===this.m_count&&((h=this.m_v[0]).indexA=0,h.indexB=0,r=e.getVertex(0),a=s.getVertex(0),Mn(h.wA,i,r),Mn(h.wB,o,a),cn(h.w,h.wB,h.wA),h.a=1,this.m_count=1)},t.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var e=0;e<this.m_count;++e)t.indexA[e]=this.m_v[e].indexA,t.indexB[e]=this.m_v[e].indexB},t.prototype.getSearchDirection=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_v3,this.m_count){case 1:return sn(Cr,-t.w.x,-t.w.y);case 2:return cn(dr,e.w,t.w),-gn(dr,t.w)>0?sn(Cr,-dr.y,dr.x):sn(Cr,dr.y,-dr.x);default:return nn(Cr)}},t.prototype.getClosestPoint=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_v3,this.m_count){case 0:case 3:default:return nn(Sr);case 1:return on(Sr,t.w);case 2:return pn(Sr,t.a,t.w,e.a,e.w)}},t.prototype.getWitnessPoints=function(t,e){var i=this.m_v1,s=this.m_v2,o=this.m_v3;switch(this.m_count){case 0:break;case 1:on(t,i.wA),on(e,i.wB);break;case 2:pn(t,i.a,i.wA,s.a,s.wA),pn(e,i.a,i.wB,s.a,s.wB);break;case 3:dn(t,i.a,i.wA,s.a,s.wA,o.a,o.wA),on(e,t)}},t.prototype.getMetric=function(){switch(this.m_count){case 0:case 1:default:return 0;case 2:return An(this.m_v1.w,this.m_v2.w);case 3:return gn(cn(vr,this.m_v2.w,this.m_v1.w),cn(gr,this.m_v3.w,this.m_v1.w))}},t.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3()}},t.prototype.solve2=function(){var t=this.m_v1.w,e=this.m_v2.w;cn(dr,e,t);var i=-xn(t,dr);if(i<=0)return this.m_v1.a=1,void(this.m_count=1);var s=xn(e,dr);if(s<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);var o=1/(s+i);this.m_v1.a=s*o,this.m_v2.a=i*o,this.m_count=2},t.prototype.solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w;cn(dr,e,t);var s=xn(t,dr),o=xn(e,dr),n=-s;cn(yr,i,t);var r=xn(t,yr),a=xn(i,yr),l=-r;cn(fr,i,e);var c=xn(e,fr),h=xn(i,fr),m=-c,u=gn(dr,yr),_=u*gn(e,i),p=u*gn(i,t),d=u*gn(t,e);if(n<=0&&l<=0)return this.m_v1.a=1,void(this.m_count=1);if(o>0&&n>0&&d<=0){var y=1/(o+n);return this.m_v1.a=o*y,this.m_v2.a=n*y,void(this.m_count=2)}if(a>0&&l>0&&p<=0){var f=1/(a+l);return this.m_v1.a=a*f,this.m_v3.a=l*f,this.m_count=2,void this.m_v2.set(this.m_v3)}if(o<=0&&m<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);if(a<=0&&h<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.set(this.m_v3);if(h>0&&m>0&&_<=0){var v=1/(h+m);return this.m_v2.a=h*v,this.m_v3.a=m*v,this.m_count=2,void this.m_v1.set(this.m_v3)}var g=1/(_+p+d);this.m_v1.a=_*g,this.m_v2.a=p*g,this.m_v3.a=d*g,this.m_count=3},t}(),Pr=new Mr,zr=new xr,Ir=new Ar,Fr=new br,Tr=function(t,e,i,s,o,n){return zr.recycle(),zr.proxyA.set(t,e),zr.proxyB.set(i,s),Sn(zr.transformA,o),Sn(zr.transformB,n),zr.useRadii=!0,Fr.recycle(),Ir.recycle(),Br(Fr,Ir,zr),Fr.distance<1e-8};Br.testOverlap=Tr,Br.Input=xr,Br.Output=br,Br.Proxy=wr,Br.Cache=Ar;var Lr,kr,qr=function(){function t(){this.proxyA=new wr,this.proxyB=new wr,this.transformA=jn.identity(),this.transformB=jn.identity(),this.translationB=ko.zero()}return t.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),nn(this.translationB)},t}(),Nr=function(){return function(){this.point=ko.zero(),this.normal=ko.zero(),this.lambda=1,this.iterations=0}}(),Dr=Math.abs,Or=Math.max,jr=function(){function t(){this.proxyA=new wr,this.proxyB=new wr,this.sweepA=new On,this.sweepB=new On}return t.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.sweepA.recycle(),this.sweepB.recycle(),this.tMax=-1},t}();(kr=Lr||(Lr={}))[kr.e_unset=-1]="e_unset",kr[kr.e_unknown=0]="e_unknown",kr[kr.e_failed=1]="e_failed",kr[kr.e_overlapped=2]="e_overlapped",kr[kr.e_touching=3]="e_touching",kr[kr.e_separated=4]="e_separated";var Rr=function(){function t(){this.state=Lr.e_unset,this.t=-1}return t.prototype.recycle=function(){this.state=Lr.e_unset,this.t=-1},t}();mr.toiTime=0,mr.toiMaxTime=0,mr.toiCalls=0,mr.toiIters=0,mr.toiMaxIters=0,mr.toiRootIters=0,mr.toiMaxRootIters=0;var Er,Yr,Jr=new xr,Wr=new br,Ur=new Ar,Hr=Cn(0,0,0),Gr=Cn(0,0,0),Xr=en(0,0),Kr=en(0,0),Zr=en(0,0),$r=en(0,0),Qr=en(0,0),ta=en(0,0),ea=en(0,0),ia=en(0,0),sa=function(t,e){var i=Date.now();++mr.toiCalls,t.state=Lr.e_unknown,t.t=e.tMax;var s=e.proxyA,o=e.proxyB,n=e.sweepA,r=e.sweepB;n.normalize(),r.normalize();var a=e.tMax,l=s.m_radius+o.m_radius,c=Or(Ro.linearSlop,l-3*Ro.linearSlop),h=.25*Ro.linearSlop,m=0,u=Ro.maxTOIIterations,_=0;for(Ur.recycle(),Jr.proxyA.setVertices(s.m_vertices,s.m_count,s.m_radius),Jr.proxyB.setVertices(o.m_vertices,o.m_count,o.m_radius),Jr.useRadii=!1;;){if(n.getTransform(Hr,m),r.getTransform(Gr,m),Sn(Jr.transformA,Hr),Sn(Jr.transformB,Gr),Br(Wr,Ur,Jr),Wr.distance<=0){t.state=Lr.e_overlapped,t.t=0;break}if(Wr.distance<c+h){t.state=Lr.e_touching,t.t=m;break}oa.initialize(Ur,s,n,o,r,m);for(var p=!1,d=a,y=0;;){var f=oa.findMinSeparation(d);if(f>c+h){t.state=Lr.e_separated,t.t=a,p=!0;break}if(f>c-h){m=d;break}var v=oa.evaluate(m);if(v<c-h){t.state=Lr.e_failed,t.t=m,p=!0;break}if(v<=c+h){t.state=Lr.e_touching,t.t=m,p=!0;break}for(var g=0,x=m,b=d;;){var A;A=1&g?x+(c-v)*(b-x)/(f-v):.5*(x+b),++g,++mr.toiRootIters;var B=oa.evaluate(A);if(Dr(B-c)<h){d=A;break}if(B>c?(x=A,v=B):(b=A,f=B),50===g)break}if(mr.toiMaxRootIters=Or(mr.toiMaxRootIters,g),++y===Ro.maxPolygonVertices)break}if(++_,++mr.toiIters,p)break;if(_===u){t.state=Lr.e_failed,t.t=m;break}}mr.toiMaxIters=Or(mr.toiMaxIters,_);var w=function(t){return Date.now()-t}(i);mr.toiMaxTime=Or(mr.toiMaxTime,w),mr.toiTime+=w,oa.recycle()};(Yr=Er||(Er={}))[Yr.e_unset=-1]="e_unset",Yr[Yr.e_points=1]="e_points",Yr[Yr.e_faceA=2]="e_faceA",Yr[Yr.e_faceB=3]="e_faceB";var oa=new(function(){function t(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=Er.e_unset,this.m_localPoint=en(0,0),this.m_axis=en(0,0),this.indexA=-1,this.indexB=-1}return t.prototype.recycle=function(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=Er.e_unset,nn(this.m_localPoint),nn(this.m_axis),this.indexA=-1,this.indexB=-1},t.prototype.initialize=function(t,e,i,s,o,n){var r=t.count;if(this.m_proxyA=e,this.m_proxyB=s,this.m_sweepA=i,this.m_sweepB=o,this.m_sweepA.getTransform(Hr,n),this.m_sweepB.getTransform(Gr,n),1===r){this.m_type=Er.e_points;var a=this.m_proxyA.getVertex(t.indexA[0]),l=this.m_proxyB.getVertex(t.indexB[0]);return Mn(Kr,Hr,a),Mn(Zr,Gr,l),cn(this.m_axis,Zr,Kr),function(t){var e=tn(t.x*t.x+t.y*t.y);if(0!==e){var i=1/e;t.x*=i,t.y*=i}return e}(this.m_axis)}if(t.indexA[0]===t.indexA[1]){this.m_type=Er.e_faceB;var c=s.getVertex(t.indexB[0]),h=s.getVertex(t.indexB[1]);fn(this.m_axis,cn(Xr,h,c),1),yn(this.m_axis),wn($r,Gr.q,this.m_axis),pn(this.m_localPoint,.5,c,.5,h),Mn(Zr,Gr,this.m_localPoint);var m=e.getVertex(t.indexA[0]);return(p=xn(jn.mulVec2(Hr,m),$r)-xn(Zr,$r))<0&&(rn(this.m_axis),p=-p),p}this.m_type=Er.e_faceA;var u=this.m_proxyA.getVertex(t.indexA[0]),_=this.m_proxyA.getVertex(t.indexA[1]);fn(this.m_axis,cn(Xr,_,u),1),yn(this.m_axis),wn($r,Hr.q,this.m_axis),pn(this.m_localPoint,.5,u,.5,_),Mn(Kr,Hr,this.m_localPoint);var p,d=this.m_proxyB.getVertex(t.indexB[0]);return Mn(Zr,Gr,d),(p=xn(Zr,$r)-xn(Kr,$r))<0&&(rn(this.m_axis),p=-p),p},t.prototype.compute=function(t,e){switch(this.m_sweepA.getTransform(Hr,e),this.m_sweepB.getTransform(Gr,e),this.m_type){case Er.e_points:return t&&(Vn(Qr,Hr.q,this.m_axis),Vn(ta,Gr.q,mn(Xr,-1,this.m_axis)),this.indexA=this.m_proxyA.getSupport(Qr),this.indexB=this.m_proxyB.getSupport(ta)),on(ea,this.m_proxyA.getVertex(this.indexA)),on(ia,this.m_proxyB.getVertex(this.indexB)),Mn(Kr,Hr,ea),Mn(Zr,Gr,ia),xn(Zr,this.m_axis)-xn(Kr,this.m_axis);case Er.e_faceA:return wn($r,Hr.q,this.m_axis),Mn(Kr,Hr,this.m_localPoint),t&&(Vn(ta,Gr.q,mn(Xr,-1,$r)),this.indexA=-1,this.indexB=this.m_proxyB.getSupport(ta)),on(ia,this.m_proxyB.getVertex(this.indexB)),Mn(Zr,Gr,ia),xn(Zr,$r)-xn(Kr,$r);case Er.e_faceB:return wn($r,Gr.q,this.m_axis),Mn(Zr,Gr,this.m_localPoint),t&&(Vn(Qr,Hr.q,mn(Xr,-1,$r)),this.indexB=-1,this.indexA=this.m_proxyA.getSupport(Qr)),on(ea,this.m_proxyA.getVertex(this.indexA)),Mn(Kr,Hr,ea),xn(Kr,$r)-xn(Zr,$r);default:return t&&(this.indexA=-1,this.indexB=-1),0}},t.prototype.findMinSeparation=function(t){return this.compute(!0,t)},t.prototype.evaluate=function(t){return this.compute(!1,t)},t}());sa.Input=jr,sa.Output=Rr;var na=Math.abs,ra=Math.sqrt,aa=Math.min,la=function(){function t(){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}return t.prototype.reset=function(t){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=0==t?0:1/t,this.dtRatio=t*this.inv_dt0},t}(),ca=new la,ha=en(0,0),ma=en(0,0),ua=en(0,0),_a=new jr,pa=new Rr,da=new On,ya=new On,fa=new On,va=function(){function t(t){this.contact=t,this.normals=[],this.tangents=[]}return t.prototype.recycle=function(){this.normals.length=0,this.tangents.length=0},Object.defineProperty(t.prototype,"normalImpulses",{get:function(){var t=this.contact,e=this.normals;e.length=0;for(var i=0;i<t.v_points.length;++i)e.push(t.v_points[i].normalImpulse);return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tangentImpulses",{get:function(){var t=this.contact,e=this.tangents;e.length=0;for(var i=0;i<t.v_points.length;++i)e.push(t.v_points[i].tangentImpulse);return e},enumerable:!1,configurable:!0}),t}(),ga=function(){function t(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}return t.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},t.prototype.addBody=function(t){this.m_bodies.push(t)},t.prototype.addContact=function(t){this.m_contacts.push(t)},t.prototype.addJoint=function(t){this.m_joints.push(t)},t.prototype.solveWorld=function(t){for(var e=this.m_world,i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1;for(var s=e.m_contactList;s;s=s.m_next)s.m_islandFlag=!1;for(var o=e.m_jointList;o;o=o.m_next)o.m_islandFlag=!1;for(var n=this.m_stack,r=e.m_bodyList;r;r=r.m_next)if(!r.m_islandFlag&&0!=r.isAwake()&&0!=r.isActive()&&!r.isStatic()){for(this.clear(),n.push(r),r.m_islandFlag=!0;n.length>0;)if(i=n.pop(),this.addBody(i),i.m_awakeFlag=!0,!i.isStatic()){for(var a=i.m_contactList;a;a=a.next){var l=a.contact;if(!l.m_islandFlag&&0!=l.isEnabled()&&0!=l.isTouching()){var c=l.m_fixtureA.m_isSensor,h=l.m_fixtureB.m_isSensor;c||h||(this.addContact(l),l.m_islandFlag=!0,(u=a.other).m_islandFlag||(n.push(u),u.m_islandFlag=!0))}}for(var m=i.m_jointList;m;m=m.next){var u;1!=m.joint.m_islandFlag&&0!=(u=m.other).isActive()&&(this.addJoint(m.joint),m.joint.m_islandFlag=!0,u.m_islandFlag||(n.push(u),u.m_islandFlag=!0))}}this.solveIsland(t);for(var _=0;_<this.m_bodies.length;++_)(i=this.m_bodies[_]).isStatic()&&(i.m_islandFlag=!1)}},t.prototype.solveIsland=function(t){for(var e=this.m_world,i=e.m_gravity,s=e.m_allowSleep,o=t.dt,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n];on(ha,r.m_sweep.c);var a=r.m_sweep.a;on(ma,r.m_linearVelocity);var l=r.m_angularVelocity;on(r.m_sweep.c0,r.m_sweep.c),r.m_sweep.a0=r.m_sweep.a,r.isDynamic()&&(un(ma,o*r.m_gravityScale,i),un(ma,o*r.m_invMass,r.m_force),l+=o*r.m_invI*r.m_torque,mn(ma,1/(1+o*r.m_linearDamping),ma),l*=1/(1+o*r.m_angularDamping)),on(r.c_position.c,ha),r.c_position.a=a,on(r.c_velocity.v,ma),r.c_velocity.w=l}for(n=0;n<this.m_contacts.length;++n)this.m_contacts[n].initConstraint(t);for(n=0;n<this.m_contacts.length;++n)this.m_contacts[n].initVelocityConstraint(t);if(t.warmStarting)for(n=0;n<this.m_contacts.length;++n)this.m_contacts[n].warmStartConstraint(t);for(n=0;n<this.m_joints.length;++n)this.m_joints[n].initVelocityConstraints(t);for(n=0;n<t.velocityIterations;++n){for(var c=0;c<this.m_joints.length;++c)this.m_joints[c].solveVelocityConstraints(t);for(c=0;c<this.m_contacts.length;++c)this.m_contacts[c].solveVelocityConstraint(t)}for(n=0;n<this.m_contacts.length;++n)this.m_contacts[n].storeConstraintImpulses(t);for(n=0;n<this.m_bodies.length;++n){r=this.m_bodies[n],on(ha,r.c_position.c),a=r.c_position.a,on(ma,r.c_velocity.v),l=r.c_velocity.w,mn(ua,o,ma);var h=bn(ua);if(h>Ro.maxTranslationSquared){var m=Ro.maxTranslation/ra(h);hn(ma,m)}var u=o*l;u*u>Ro.maxRotationSquared&&(l*=m=Ro.maxRotation/na(u)),un(ha,o,ma),a+=o*l,on(r.c_position.c,ha),r.c_position.a=a,on(r.c_velocity.v,ma),r.c_velocity.w=l}var _=!1;for(n=0;n<t.positionIterations;++n){var p=0;for(c=0;c<this.m_contacts.length;++c){var d=this.m_contacts[c].solvePositionConstraint(t);p=aa(p,d)}var y=p>=-3*Ro.linearSlop,f=!0;for(c=0;c<this.m_joints.length;++c){var v=this.m_joints[c].solvePositionConstraints(t);f=f&&v}if(y&&f){_=!0;break}}for(n=0;n<this.m_bodies.length;++n)on((r=this.m_bodies[n]).m_sweep.c,r.c_position.c),r.m_sweep.a=r.c_position.a,on(r.m_linearVelocity,r.c_velocity.v),r.m_angularVelocity=r.c_velocity.w,r.synchronizeTransform();if(this.postSolveIsland(),s){var g=1/0,x=Ro.linearSleepToleranceSqr,b=Ro.angularSleepToleranceSqr;for(n=0;n<this.m_bodies.length;++n)(r=this.m_bodies[n]).isStatic()||(0==r.m_autoSleepFlag||r.m_angularVelocity*r.m_angularVelocity>b||bn(r.m_linearVelocity)>x?(r.m_sleepTime=0,g=0):(r.m_sleepTime+=o,g=aa(g,r.m_sleepTime)));if(g>=Ro.timeToSleep&&_)for(n=0;n<this.m_bodies.length;++n)(r=this.m_bodies[n]).setAwake(!1)}},t.prototype.solveWorldTOI=function(t){var e=this.m_world;if(e.m_stepComplete){for(var i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1,i.m_sweep.alpha0=0;for(var s=e.m_contactList;s;s=s.m_next)s.m_toiFlag=!1,s.m_islandFlag=!1,s.m_toiCount=0,s.m_toi=1}for(;;){for(var o=null,n=1,r=e.m_contactList;r;r=r.m_next)if(0!=r.isEnabled()&&!(r.m_toiCount>Ro.maxSubSteps)){var a=1;if(r.m_toiFlag)a=r.m_toi;else{var l=r.getFixtureA(),c=r.getFixtureB();if(l.isSensor()||c.isSensor())continue;var h=l.getBody(),m=c.getBody(),u=h.isAwake()&&!h.isStatic(),_=m.isAwake()&&!m.isStatic();if(0==u&&0==_)continue;var p=h.isBullet()||!h.isDynamic(),d=m.isBullet()||!m.isDynamic();if(0==p&&0==d)continue;var y=h.m_sweep.alpha0;h.m_sweep.alpha0<m.m_sweep.alpha0?(y=m.m_sweep.alpha0,h.m_sweep.advance(y)):m.m_sweep.alpha0<h.m_sweep.alpha0&&(y=h.m_sweep.alpha0,m.m_sweep.advance(y));var f=r.getChildIndexA(),v=r.getChildIndexB();h.m_sweep,m.m_sweep,_a.proxyA.set(l.getShape(),f),_a.proxyB.set(c.getShape(),v),_a.sweepA.set(h.m_sweep),_a.sweepB.set(m.m_sweep),_a.tMax=1,sa(pa,_a);var g=pa.t;a=pa.state==Lr.e_touching?aa(y+(1-y)*g,1):1,r.m_toi=a,r.m_toiFlag=!0}a<n&&(o=r,n=a)}if(null==o||1-1e-8<n){e.m_stepComplete=!0;break}var x=o.getFixtureA(),b=o.getFixtureB(),A=x.getBody(),B=b.getBody();if(ya.set(A.m_sweep),fa.set(B.m_sweep),A.advance(n),B.advance(n),o.update(e),o.m_toiFlag=!1,++o.m_toiCount,0!=o.isEnabled()&&0!=o.isTouching()){A.setAwake(!0),B.setAwake(!0),this.clear(),this.addBody(A),this.addBody(B),this.addContact(o),A.m_islandFlag=!0,B.m_islandFlag=!0,o.m_islandFlag=!0;for(var w=[A,B],V=0;V<w.length;++V)if((I=w[V]).isDynamic())for(var C=I.m_contactList;C;C=C.next){var S=C.contact;if(!S.m_islandFlag){var M=C.other;if(!M.isDynamic()||I.isBullet()||M.isBullet()){var P=S.m_fixtureA.m_isSensor,z=S.m_fixtureB.m_isSensor;P||z||(da.set(M.m_sweep),0==M.m_islandFlag&&M.advance(n),S.update(e),0!=S.isEnabled()&&0!=S.isTouching()?(S.m_islandFlag=!0,this.addContact(S),M.m_islandFlag||(M.m_islandFlag=!0,M.isStatic()||M.setAwake(!0),this.addBody(M))):(M.m_sweep.set(da),M.synchronizeTransform()))}}}for(ca.reset((1-n)*t.dt),ca.dtRatio=1,ca.positionIterations=20,ca.velocityIterations=t.velocityIterations,ca.warmStarting=!1,this.solveIslandTOI(ca,A,B),V=0;V<this.m_bodies.length;++V){var I;if((I=this.m_bodies[V]).m_islandFlag=!1,I.isDynamic())for(I.synchronizeFixtures(),C=I.m_contactList;C;C=C.next)C.contact.m_toiFlag=!1,C.contact.m_islandFlag=!1}if(e.findNewContacts(),e.m_subStepping){e.m_stepComplete=!1;break}}else o.setEnabled(!1),A.m_sweep.set(ya),B.m_sweep.set(fa),A.synchronizeTransform(),B.synchronizeTransform()}},t.prototype.solveIslandTOI=function(t,e,i){for(var s=0;s<this.m_bodies.length;++s)on((l=this.m_bodies[s]).c_position.c,l.m_sweep.c),l.c_position.a=l.m_sweep.a,on(l.c_velocity.v,l.m_linearVelocity),l.c_velocity.w=l.m_angularVelocity;for(s=0;s<this.m_contacts.length;++s)this.m_contacts[s].initConstraint(t);for(s=0;s<t.positionIterations;++s){for(var o=0,n=0;n<this.m_contacts.length;++n){var r=this.m_contacts[n].solvePositionConstraintTOI(t,e,i);o=aa(o,r)}if(o>=-1.5*Ro.linearSlop)break}for(on(e.m_sweep.c0,e.c_position.c),e.m_sweep.a0=e.c_position.a,on(i.m_sweep.c0,i.c_position.c),i.m_sweep.a0=i.c_position.a,s=0;s<this.m_contacts.length;++s)this.m_contacts[s].initVelocityConstraint(t);for(s=0;s<t.velocityIterations;++s)for(n=0;n<this.m_contacts.length;++n)this.m_contacts[n].solveVelocityConstraint(t);var a=t.dt;for(s=0;s<this.m_bodies.length;++s){var l=this.m_bodies[s];on(ha,l.c_position.c);var c=l.c_position.a;on(ma,l.c_velocity.v);var h=l.c_velocity.w;mn(ua,a,ma);var m=bn(ua);if(m>Ro.maxTranslationSquared){var u=Ro.maxTranslation/ra(m);hn(ma,u)}var _=a*h;_*_>Ro.maxRotationSquared&&(h*=u=Ro.maxRotation/na(_)),un(ha,a,ma),c+=a*h,on(l.c_position.c,ha),l.c_position.a=c,on(l.c_velocity.v,ma),l.c_velocity.w=h,on(l.m_sweep.c,ha),l.m_sweep.a=c,on(l.m_linearVelocity,ma),l.m_angularVelocity=h,l.synchronizeTransform()}this.postSolveIsland()},t.prototype.postSolveIsland=function(){for(var t=0;t<this.m_contacts.length;++t){var e=this.m_contacts[t];this.m_world.postSolve(e,e.m_impulse)}},t}();ga.TimeStep=la;var xa,ba,Aa,Ba,wa,Va,Ca=function(){function t(t,e,i,s){"object"==typeof t&&null!==t?(this.ex=ko.clone(t),this.ey=ko.clone(e)):"number"==typeof t?(this.ex=ko.neo(t,i),this.ey=ko.neo(e,s)):(this.ex=ko.zero(),this.ey=ko.zero())}return t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&ko.isValid(t.ex)&&ko.isValid(t.ey)},t.assert=function(t){},t.prototype.set=function(t,e,i,s){"number"==typeof t&&"number"==typeof e&&"number"==typeof i&&"number"==typeof s?(this.ex.setNum(t,i),this.ey.setNum(e,s)):"object"==typeof t&&"object"==typeof e?(this.ex.setVec2(t),this.ey.setVec2(e)):"object"==typeof t&&(this.ex.setVec2(t.ex),this.ey.setVec2(t.ey))},t.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},t.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},t.prototype.getInverse=function(){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;0!==n&&(n=1/n);var r=new t;return r.ex.x=n*o,r.ey.x=-n*i,r.ex.y=-n*s,r.ey.y=n*e,r},t.prototype.solve=function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;0!==n&&(n=1/n);var r=ko.zero();return r.x=n*(o*t.x-i*t.y),r.y=n*(e*t.y-s*t.x),r},t.mul=function(e,i){if(i&&"x"in i&&"y"in i){var s=e.ex.x*i.x+e.ey.x*i.y,o=e.ex.y*i.x+e.ey.y*i.y;return ko.neo(s,o)}if(i&&"ex"in i&&"ey"in i)return new t(e.ex.x*i.ex.x+e.ey.x*i.ex.y,e.ex.x*i.ey.x+e.ey.x*i.ey.y,e.ex.y*i.ex.x+e.ey.y*i.ex.y,e.ex.y*i.ey.x+e.ey.y*i.ey.y)},t.mulVec2=function(t,e){var i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return ko.neo(i,s)},t.mulMat22=function(e,i){return new t(e.ex.x*i.ex.x+e.ey.x*i.ex.y,e.ex.x*i.ey.x+e.ey.x*i.ey.y,e.ex.y*i.ex.x+e.ey.y*i.ex.y,e.ex.y*i.ey.x+e.ey.y*i.ey.y)},t.mulT=function(e,i){return i&&"x"in i&&"y"in i?ko.neo(ko.dot(i,e.ex),ko.dot(i,e.ey)):i&&"ex"in i&&"ey"in i?new t(ko.neo(ko.dot(e.ex,i.ex),ko.dot(e.ey,i.ex)),ko.neo(ko.dot(e.ex,i.ey),ko.dot(e.ey,i.ey))):void 0},t.mulTVec2=function(t,e){return ko.neo(ko.dot(e,t.ex),ko.dot(e,t.ey))},t.mulTMat22=function(e,i){return new t(ko.neo(ko.dot(e.ex,i.ex),ko.dot(e.ey,i.ex)),ko.neo(ko.dot(e.ex,i.ey),ko.dot(e.ey,i.ey)))},t.abs=function(e){return new t(ko.abs(e.ex),ko.abs(e.ey))},t.add=function(e,i){return new t(ko.add(e.ex,i.ex),ko.add(e.ey,i.ey))},t}(),Sa=Math.sqrt,Ma=en(0,0),Pa=en(0,0),za=en(0,0),Ia=en(0,0),Fa=en(0,0),Ta=en(0,0),La=en(0,0),ka=en(0,0);(ba=xa||(xa={}))[ba.e_unset=-1]="e_unset",ba[ba.e_circles=0]="e_circles",ba[ba.e_faceA=1]="e_faceA",ba[ba.e_faceB=2]="e_faceB",(Ba=Aa||(Aa={}))[Ba.e_unset=-1]="e_unset",Ba[Ba.e_vertex=0]="e_vertex",Ba[Ba.e_face=1]="e_face",(Va=wa||(wa={}))[Va.nullState=0]="nullState",Va[Va.addState=1]="addState",Va[Va.persistState=2]="persistState",Va[Va.removeState=3]="removeState";var qa=function(){function t(){this.v=en(0,0),this.id=new Oa}return t.prototype.set=function(t){on(this.v,t.v),this.id.set(t.id)},t.prototype.recycle=function(){nn(this.v),this.id.recycle()},t}(),Na=function(){function t(){this.localNormal=en(0,0),this.localPoint=en(0,0),this.points=[new Da,new Da],this.pointCount=0}return t.prototype.set=function(t){this.type=t.type,on(this.localNormal,t.localNormal),on(this.localPoint,t.localPoint),this.pointCount=t.pointCount,this.points[0].set(t.points[0]),this.points[1].set(t.points[1])},t.prototype.recycle=function(){this.type=xa.e_unset,nn(this.localNormal),nn(this.localPoint),this.pointCount=0,this.points[0].recycle(),this.points[1].recycle()},t.prototype.getWorldManifold=function(t,e,i,s,o){if(0==this.pointCount)return t;(t=t||new ja).pointCount=this.pointCount;var n=t.normal,r=t.points,a=t.separations;switch(this.type){case xa.e_circles:sn(n,1,0);var l=this.points[0];Mn(Ma,e,this.localPoint),Mn(Pa,s,l.localPoint),cn(Ta,Pa,Ma);var c=bn(Ta);c>1e-18&&mn(n,1/Sa(c),Ta),pn(Ia,1,Ma,i,n),pn(Fa,1,Pa,-o,n),pn(r[0],.5,Ia,.5,Fa),a[0]=xn(cn(za,Fa,Ia),n);break;case xa.e_faceA:wn(n,e.q,this.localNormal),Mn(La,e,this.localPoint);for(var h=0;h<this.pointCount;++h)l=this.points[h],Mn(ka,s,l.localPoint),pn(Ia,1,ka,i-xn(cn(za,ka,La),n),n),pn(Fa,1,ka,-o,n),pn(r[h],.5,Ia,.5,Fa),a[h]=xn(cn(za,Fa,Ia),n);break;case xa.e_faceB:for(wn(n,s.q,this.localNormal),Mn(La,s,this.localPoint),h=0;h<this.pointCount;++h)l=this.points[h],Mn(ka,e,l.localPoint),pn(Fa,1,ka,o-xn(cn(za,ka,La),n),n),pn(Ia,1,ka,-i,n),pn(r[h],.5,Ia,.5,Fa),a[h]=xn(cn(za,Ia,Fa),n);rn(n)}return t},t.clipSegmentToLine=Ea,t.ClipVertex=qa,t.getPointStates=Ra,t.PointState=wa,t}(),Da=function(){function t(){this.localPoint=en(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.id=new Oa}return t.prototype.set=function(t){on(this.localPoint,t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.set(t.id)},t.prototype.recycle=function(){nn(this.localPoint),this.normalImpulse=0,this.tangentImpulse=0,this.id.recycle()},t}(),Oa=function(){function t(){this.key=-1,this.indexA=-1,this.indexB=-1,this.typeA=Aa.e_unset,this.typeB=Aa.e_unset}return t.prototype.setFeatures=function(t,e,i,s){this.indexA=t,this.indexB=i,this.typeA=e,this.typeB=s,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB},t.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB},t.prototype.swapFeatures=function(){var t=this.indexA,e=this.indexB,i=this.typeA,s=this.typeB;this.indexA=e,this.indexB=t,this.typeA=s,this.typeB=i,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB},t.prototype.recycle=function(){this.indexA=0,this.indexB=0,this.typeA=Aa.e_unset,this.typeB=Aa.e_unset,this.key=-1},t}(),ja=function(){function t(){this.normal=en(0,0),this.points=[en(0,0),en(0,0)],this.separations=[0,0],this.pointCount=0}return t.prototype.recycle=function(){nn(this.normal),nn(this.points[0]),nn(this.points[1]),this.separations[0]=0,this.separations[1]=0,this.pointCount=0},t}();function Ra(t,e,i,s){for(var o=0;o<i.pointCount;++o){var n=i.points[o].id;t[o]=wa.removeState;for(var r=0;r<s.pointCount;++r)if(s.points[r].id.key===n.key){t[o]=wa.persistState;break}}for(o=0;o<s.pointCount;++o)for(n=s.points[o].id,e[o]=wa.addState,r=0;r<i.pointCount;++r)if(i.points[r].id.key===n.key){e[o]=wa.persistState;break}}function Ea(t,e,i,s,o){var n=0,r=xn(i,e[0].v)-s,a=xn(i,e[1].v)-s;if(r<=0&&t[n++].set(e[0]),a<=0&&t[n++].set(e[1]),r*a<0){var l=r/(r-a);pn(t[n].v,1-l,e[0].v,l,e[1].v),t[n].id.setFeatures(o,Aa.e_vertex,e[0].id.indexB,Aa.e_face),++n}return n}var Ya=Math.sqrt,Ja=Math.max,Wa=Math.min,Ua=new Eo({create:function(){return new Ml},release:function(t){t.recycle()}}),Ha=new Na,Ga=new ja,Xa=function(){function t(t){this.prev=null,this.next=null,this.other=null,this.contact=t}return t.prototype.recycle=function(){this.prev=null,this.next=null,this.other=null},t}();function Ka(t,e){return Ya(t*e)}function Za(t,e){return t>e?t:e}var $a,Qa,tl=[],el=function(){function t(){this.rA=en(0,0),this.rB=en(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return t.prototype.recycle=function(){nn(this.rA),nn(this.rB),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0},t}(),il=en(0,0),sl=en(0,0),ol=en(0,0),nl=en(0,0),rl=en(0,0),al=Cn(0,0,0),ll=Cn(0,0,0),cl=en(0,0),hl=en(0,0),ml=en(0,0),ul=en(0,0),_l=en(0,0),pl=en(0,0),dl=en(0,0),yl=en(0,0),fl=en(0,0),vl=en(0,0),gl=en(0,0),xl=en(0,0),bl=en(0,0),Al=en(0,0),Bl=en(0,0),wl=en(0,0),Vl=en(0,0),Cl=en(0,0),Sl=en(0,0),Ml=function(){function t(){this.m_nodeA=new Xa(this),this.m_nodeB=new Xa(this),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold=new Na,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse=new va(this),this.v_points=[new el,new el],this.v_normal=en(0,0),this.v_normalMass=new Ca,this.v_K=new Ca,this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0,this.p_localPoints=[en(0,0),en(0,0)],this.p_localNormal=en(0,0),this.p_localPoint=en(0,0),this.p_localCenterA=en(0,0),this.p_localCenterB=en(0,0),this.p_type=xa.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0}return t.prototype.initialize=function(t,e,i,s,o){this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=s,this.m_evaluateFcn=o,this.m_friction=Ka(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Za(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},t.prototype.recycle=function(){this.m_nodeA.recycle(),this.m_nodeB.recycle(),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold.recycle(),this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse.recycle();for(var t=0,e=this.v_points;t<e.length;t++)e[t].recycle();nn(this.v_normal),this.v_normalMass.setZero(),this.v_K.setZero(),this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0;for(var i=0,s=this.p_localPoints;i<s.length;i++)nn(s[i]);nn(this.p_localNormal),nn(this.p_localPoint),nn(this.p_localCenterA),nn(this.p_localCenterB),this.p_type=xa.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0},t.prototype.initConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var s=e.m_body,o=i.m_body;if(null!==s&&null!==o){var n=e.m_shape,r=i.m_shape;if(null!==n&&null!==r){var a=this.m_manifold,l=a.pointCount;this.v_invMassA=s.m_invMass,this.v_invMassB=o.m_invMass,this.v_invIA=s.m_invI,this.v_invIB=o.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=l,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=s.m_invMass,this.p_invMassB=o.m_invMass,this.p_invIA=s.m_invI,this.p_invIB=o.m_invI,on(this.p_localCenterA,s.m_sweep.localCenter),on(this.p_localCenterB,o.m_sweep.localCenter),this.p_radiusA=n.m_radius,this.p_radiusB=r.m_radius,this.p_type=a.type,on(this.p_localNormal,a.localNormal),on(this.p_localPoint,a.localPoint),this.p_pointCount=l;for(var c=0;c<Ro.maxManifoldPoints;++c)this.v_points[c].recycle(),nn(this.p_localPoints[c]);for(c=0;c<l;++c){var h=a.points[c],m=this.v_points[c];t.warmStarting&&(m.normalImpulse=t.dtRatio*h.normalImpulse,m.tangentImpulse=t.dtRatio*h.tangentImpulse),on(this.p_localPoints[c],h.localPoint)}}}}},t.prototype.getManifold=function(){return this.m_manifold},t.prototype.getWorldManifold=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var s=e.m_body,o=i.m_body;if(null!==s&&null!==o){var n=e.m_shape,r=i.m_shape;if(null!==n&&null!==r)return this.m_manifold.getWorldManifold(t,s.getTransform(),n.m_radius,o.getTransform(),r.m_radius)}}},t.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},t.prototype.isEnabled=function(){return this.m_enabledFlag},t.prototype.isTouching=function(){return this.m_touchingFlag},t.prototype.getNext=function(){return this.m_next},t.prototype.getFixtureA=function(){return this.m_fixtureA},t.prototype.getFixtureB=function(){return this.m_fixtureB},t.prototype.getChildIndexA=function(){return this.m_indexA},t.prototype.getChildIndexB=function(){return this.m_indexB},t.prototype.flagForFiltering=function(){this.m_filterFlag=!0},t.prototype.setFriction=function(t){this.m_friction=t},t.prototype.getFriction=function(){return this.m_friction},t.prototype.resetFriction=function(){var t=this.m_fixtureA,e=this.m_fixtureB;null!==t&&null!==e&&(this.m_friction=Ka(t.m_friction,e.m_friction))},t.prototype.setRestitution=function(t){this.m_restitution=t},t.prototype.getRestitution=function(){return this.m_restitution},t.prototype.resetRestitution=function(){var t=this.m_fixtureA,e=this.m_fixtureB;null!==t&&null!==e&&(this.m_restitution=Za(t.m_restitution,e.m_restitution))},t.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},t.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},t.prototype.evaluate=function(t,e,i){var s=this.m_fixtureA,o=this.m_fixtureB;null!==s&&null!==o&&this.m_evaluateFcn(t,e,s,this.m_indexA,i,o,this.m_indexB)},t.prototype.update=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var s=e.m_body,o=i.m_body;if(null!==s&&null!==o){var n=e.m_shape,r=i.m_shape;if(null!==n&&null!==r){this.m_enabledFlag=!0;var a=!1,l=this.m_touchingFlag,c=e.m_isSensor,h=i.m_isSensor,m=c||h,u=s.m_xf,_=o.m_xf;if(m)a=Tr(n,this.m_indexA,r,this.m_indexB,u,_),this.m_manifold.pointCount=0;else{Ha.recycle(),Ha.set(this.m_manifold),this.m_manifold.recycle(),this.evaluate(this.m_manifold,u,_),a=this.m_manifold.pointCount>0;for(var p=0;p<this.m_manifold.pointCount;++p){var d=this.m_manifold.points[p];d.normalImpulse=0,d.tangentImpulse=0;for(var y=0;y<Ha.pointCount;++y){var f=Ha.points[y];if(f.id.key===d.id.key){d.normalImpulse=f.normalImpulse,d.tangentImpulse=f.tangentImpulse;break}}}a!==l&&(s.setAwake(!0),o.setAwake(!0))}this.m_touchingFlag=a;var v="object"==typeof t&&null!==t;!l&&a&&v&&t.beginContact(this),l&&!a&&v&&t.endContact(this),!m&&a&&v&&Ha&&t.preSolve(this,Ha)}}}},t.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t,null,null)},t.prototype.solvePositionConstraintTOI=function(t,e,i){return this._solvePositionConstraint(t,e,i)},t.prototype._solvePositionConstraint=function(t,e,i){var s=null!==e&&null!==i,o=0,n=this.m_fixtureA,r=this.m_fixtureB;if(null===n||null===r)return o;var a=n.m_body,l=r.m_body;if(null===a||null===l)return o;a.c_velocity,l.c_velocity;var c=a.c_position,h=l.c_position,m=this.p_localCenterA,u=this.p_localCenterB,_=0,p=0;s&&a!==e&&a!==i||(_=this.p_invMassA,p=this.p_invIA);var d=0,y=0;s&&l!==e&&l!==i||(d=this.p_invMassB,y=this.p_invIB),on(il,c.c);var f=c.a;on(ol,h.c);for(var v=h.a,g=0;g<this.p_pointCount;++g){Wn(al,m,il,f),Wn(ll,u,ol,v);var x=void 0;switch(this.p_type){case xa.e_circles:Mn(cl,al,this.p_localPoint),Mn(hl,ll,this.p_localPoints[0]),cn(yl,hl,cl),yn(yl),pn(fl,.5,cl,.5,hl),x=xn(hl,yl)-xn(cl,yl)-this.p_radiusA-this.p_radiusB;break;case xa.e_faceA:wn(yl,al.q,this.p_localNormal),Mn(ul,al,this.p_localPoint),Mn(ml,ll,this.p_localPoints[g]),x=xn(ml,yl)-xn(ul,yl)-this.p_radiusA-this.p_radiusB,on(fl,ml);break;case xa.e_faceB:wn(yl,ll.q,this.p_localNormal),Mn(ul,ll,this.p_localPoint),Mn(ml,al,this.p_localPoints[g]),x=xn(ml,yl)-xn(ul,yl)-this.p_radiusA-this.p_radiusB,on(fl,ml),rn(yl);break;default:return o}cn(_l,fl,il),cn(pl,fl,ol),o=Wa(o,x);var b=Po((s?Ro.toiBaugarte:Ro.baumgarte)*(x+Ro.linearSlop),-Ro.maxLinearCorrection,0),A=gn(_l,yl),B=gn(pl,yl),w=_+d+p*A*A+y*B*B;mn(dl,w>0?-b/w:0,yl),_n(il,_,dl),f-=p*gn(_l,dl),un(ol,d,dl),v+=y*gn(pl,dl)}return on(c.c,il),c.a=f,on(h.c,ol),h.a=v,o},t.prototype.initVelocityConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var s=e.m_body,o=i.m_body;if(null!==s&&null!==o){var n=s.c_velocity,r=o.c_velocity,a=s.c_position,l=o.c_position,c=this.p_radiusA,h=this.p_radiusB,m=this.m_manifold,u=this.v_invMassA,_=this.v_invMassB,p=this.v_invIA,d=this.v_invIB,y=this.p_localCenterA,f=this.p_localCenterB;on(il,a.c);var v=a.a;on(sl,n.v);var g=n.w;on(ol,l.c);var x=l.a;on(nl,r.v);var b=r.w;Wn(al,y,il,v),Wn(ll,f,ol,x),Ga.recycle(),m.getWorldManifold(Ga,al,c,ll,h),on(this.v_normal,Ga.normal);for(var A=0;A<this.v_pointCount;++A){var B=this.v_points[A],w=Ga.points[A];cn(B.rA,w,il),cn(B.rB,w,ol);var V=gn(B.rA,this.v_normal),C=gn(B.rB,this.v_normal),S=u+_+p*V*V+d*C*C;B.normalMass=S>0?1/S:0,fn(rl,this.v_normal,1);var M=gn(B.rA,rl),P=gn(B.rB,rl),z=u+_+p*M*M+d*P*P;B.tangentMass=z>0?1/z:0,B.velocityBias=0;var I=0;I+=xn(this.v_normal,nl),I+=xn(this.v_normal,vn(Sl,b,B.rB)),I-=xn(this.v_normal,sl),(I-=xn(this.v_normal,vn(Sl,g,B.rA)))<-Ro.velocityThreshold&&(B.velocityBias=-this.v_restitution*I)}if(2==this.v_pointCount&&t.blockSolve){var F=this.v_points[0],T=this.v_points[1],L=gn(F.rA,this.v_normal),k=gn(F.rB,this.v_normal),q=gn(T.rA,this.v_normal),N=gn(T.rB,this.v_normal),D=u+_+p*L*L+d*k*k,O=u+_+p*q*q+d*N*N,j=u+_+p*L*q+d*k*N;if(D*D<1e3*(D*O-j*j)){this.v_K.ex.setNum(D,j),this.v_K.ey.setNum(j,O);var R=this.v_K.ex.x,E=this.v_K.ey.x,Y=this.v_K.ex.y,J=this.v_K.ey.y,W=R*J-E*Y;0!==W&&(W=1/W),this.v_normalMass.ex.x=W*J,this.v_normalMass.ey.x=-W*E,this.v_normalMass.ex.y=-W*Y,this.v_normalMass.ey.y=W*R}else this.v_pointCount=1}on(a.c,il),a.a=v,on(n.v,sl),n.w=g,on(l.c,ol),l.a=x,on(r.v,nl),r.w=b}}},t.prototype.warmStartConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var s=e.m_body,o=i.m_body;if(null!==s&&null!==o){var n=s.c_velocity,r=o.c_velocity;s.c_position,o.c_position;var a=this.v_invMassA,l=this.v_invIA,c=this.v_invMassB,h=this.v_invIB;on(sl,n.v);var m=n.w;on(nl,r.v);var u=r.w;on(yl,this.v_normal),fn(rl,yl,1);for(var _=0;_<this.v_pointCount;++_){var p=this.v_points[_];pn(dl,p.normalImpulse,yl,p.tangentImpulse,rl),m-=l*gn(p.rA,dl),_n(sl,a,dl),u+=h*gn(p.rB,dl),un(nl,c,dl)}on(n.v,sl),n.w=m,on(r.v,nl),r.w=u}}},t.prototype.storeConstraintImpulses=function(t){for(var e=this.m_manifold,i=0;i<this.v_pointCount;++i)e.points[i].normalImpulse=this.v_points[i].normalImpulse,e.points[i].tangentImpulse=this.v_points[i].tangentImpulse},t.prototype.solveVelocityConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var s=e.m_body,o=i.m_body;if(null!==s&&null!==o){var n=s.c_velocity;s.c_position;var r=o.c_velocity;o.c_position;var a=this.v_invMassA,l=this.v_invIA,c=this.v_invMassB,h=this.v_invIB;on(sl,n.v);var m=n.w;on(nl,r.v);var u=r.w;on(yl,this.v_normal),fn(rl,yl,1);for(var _=this.v_friction,p=0;p<this.v_pointCount;++p){var d=this.v_points[p];nn(vl),an(vl,nl),an(vl,vn(Sl,u,d.rB)),ln(vl,sl),ln(vl,vn(Sl,m,d.rA));var y=xn(vl,rl)-this.v_tangentSpeed,f=d.tangentMass*-y,v=_*d.normalImpulse;f=(x=Po(d.tangentImpulse+f,-v,v))-d.tangentImpulse,d.tangentImpulse=x,mn(dl,f,rl),_n(sl,a,dl),m-=l*gn(d.rA,dl),un(nl,c,dl),u+=h*gn(d.rB,dl)}if(1==this.v_pointCount||0==t.blockSolve)for(var g=0;g<this.v_pointCount;++g){d=this.v_points[g],nn(vl),an(vl,nl),an(vl,vn(Sl,u,d.rB)),ln(vl,sl),ln(vl,vn(Sl,m,d.rA));var x,b=xn(vl,yl);f=-d.normalMass*(b-d.velocityBias),f=(x=Ja(d.normalImpulse+f,0))-d.normalImpulse,d.normalImpulse=x,mn(dl,f,yl),_n(sl,a,dl),m-=l*gn(d.rA,dl),un(nl,c,dl),u+=h*gn(d.rB,dl)}else{var A=this.v_points[0],B=this.v_points[1];sn(Al,A.normalImpulse,B.normalImpulse),nn(gl),an(gl,nl),an(gl,vn(Sl,u,A.rB)),ln(gl,sl),ln(gl,vn(Sl,m,A.rA)),nn(xl),an(xl,nl),an(xl,vn(Sl,u,B.rB)),ln(xl,sl),ln(xl,vn(Sl,m,B.rA));var w=xn(gl,yl),V=xn(xl,yl);for(sn(bl,w-A.velocityBias,V-B.velocityBias),bl.x-=this.v_K.ex.x*Al.x+this.v_K.ey.x*Al.y,bl.y-=this.v_K.ex.y*Al.x+this.v_K.ey.y*Al.y;;){if(nn(Bl),Bl.x=-(this.v_normalMass.ex.x*bl.x+this.v_normalMass.ey.x*bl.y),Bl.y=-(this.v_normalMass.ex.y*bl.x+this.v_normalMass.ey.y*bl.y),Bl.x>=0&&Bl.y>=0){cn(wl,Bl,Al),mn(Vl,wl.x,yl),mn(Cl,wl.y,yl),dn(sl,-a,Vl,-a,Cl,1,sl),m-=l*(gn(A.rA,Vl)+gn(B.rA,Cl)),dn(nl,c,Vl,c,Cl,1,nl),u+=h*(gn(A.rB,Vl)+gn(B.rB,Cl)),A.normalImpulse=Bl.x,B.normalImpulse=Bl.y;break}if(Bl.x=-A.normalMass*bl.x,Bl.y=0,w=0,V=this.v_K.ex.y*Bl.x+bl.y,Bl.x>=0&&V>=0){cn(wl,Bl,Al),mn(Vl,wl.x,yl),mn(Cl,wl.y,yl),dn(sl,-a,Vl,-a,Cl,1,sl),m-=l*(gn(A.rA,Vl)+gn(B.rA,Cl)),dn(nl,c,Vl,c,Cl,1,nl),u+=h*(gn(A.rB,Vl)+gn(B.rB,Cl)),A.normalImpulse=Bl.x,B.normalImpulse=Bl.y;break}if(Bl.x=0,Bl.y=-B.normalMass*bl.y,w=this.v_K.ey.x*Bl.y+bl.x,V=0,Bl.y>=0&&w>=0){cn(wl,Bl,Al),mn(Vl,wl.x,yl),mn(Cl,wl.y,yl),dn(sl,-a,Vl,-a,Cl,1,sl),m-=l*(gn(A.rA,Vl)+gn(B.rA,Cl)),dn(nl,c,Vl,c,Cl,1,nl),u+=h*(gn(A.rB,Vl)+gn(B.rB,Cl)),A.normalImpulse=Bl.x,B.normalImpulse=Bl.y;break}if(Bl.x=0,Bl.y=0,w=bl.x,V=bl.y,w>=0&&V>=0){cn(wl,Bl,Al),mn(Vl,wl.x,yl),mn(Cl,wl.y,yl),dn(sl,-a,Vl,-a,Cl,1,sl),m-=l*(gn(A.rA,Vl)+gn(B.rA,Cl)),dn(nl,c,Vl,c,Cl,1,nl),u+=h*(gn(A.rB,Vl)+gn(B.rB,Cl)),A.normalImpulse=Bl.x,B.normalImpulse=Bl.y;break}break}}on(n.v,sl),n.w=m,on(r.v,nl),r.w=u}}},t.addType=function(t,e,i){tl[t]=tl[t]||{},tl[t][e]=i},t.create=function(t,e,i,s){var o,n=t.m_shape.m_type,r=i.m_shape.m_type,a=Ua.allocate();if(o=tl[n]&&tl[n][r])a.initialize(t,e,i,s,o);else{if(!(o=tl[r]&&tl[r][n]))return null;a.initialize(i,s,t,e,o)}t=a.m_fixtureA,i=a.m_fixtureB,e=a.getChildIndexA(),s=a.getChildIndexB();var l=t.m_body,c=i.m_body;return a.m_nodeA.contact=a,a.m_nodeA.other=c,a.m_nodeA.prev=null,a.m_nodeA.next=l.m_contactList,null!=l.m_contactList&&(l.m_contactList.prev=a.m_nodeA),l.m_contactList=a.m_nodeA,a.m_nodeB.contact=a,a.m_nodeB.other=l,a.m_nodeB.prev=null,a.m_nodeB.next=c.m_contactList,null!=c.m_contactList&&(c.m_contactList.prev=a.m_nodeB),c.m_contactList=a.m_nodeB,0==t.isSensor()&&0==i.isSensor()&&(l.setAwake(!0),c.setAwake(!0)),a},t.destroy=function(t,e){var i=t.m_fixtureA,s=t.m_fixtureB;if(null!==i&&null!==s){var o=i.m_body,n=s.m_body;null!==o&&null!==n&&(t.isTouching()&&e.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==o.m_contactList&&(o.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!i.m_isSensor&&!s.m_isSensor&&(o.setAwake(!0),n.setAwake(!0)),Ua.release(t))}},t}(),Pl={gravity:ko.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3},zl=function(){function t(e){if(!(this instanceof t))return new t(e);this.s_step=new la,e?ko.isValid(e)&&(e={gravity:e}):e={},e=wo(e,Pl),this.m_solver=new ga(this),this.m_broadPhase=new Zo,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=e.allowSleep,this.m_gravity=ko.clone(e.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=e.warmStarting,this.m_continuousPhysics=e.continuousPhysics,this.m_subStepping=e.subStepping,this.m_blockSolve=e.blockSolve,this.m_velocityIterations=e.velocityIterations,this.m_positionIterations=e.positionIterations,this.m_t=0}return t.prototype._serialize=function(){for(var t=[],e=[],i=this.getBodyList();i;i=i.getNext())t.push(i);for(var s=this.getJointList();s;s=s.getNext())"function"==typeof s._serialize&&e.push(s);return{gravity:this.m_gravity,bodies:t,joints:e}},t._deserialize=function(e,i,s){if(!e)return new t;var o=new t(e.gravity);if(e.bodies)for(var n=e.bodies.length-1;n>=0;n-=1)o._addBody(s(lr,e.bodies[n],o));if(e.joints)for(n=e.joints.length-1;n>=0;n--)o.createJoint(s(hr,e.joints[n],o));return o},t.prototype.getBodyList=function(){return this.m_bodyList},t.prototype.getJointList=function(){return this.m_jointList},t.prototype.getContactList=function(){return this.m_contactList},t.prototype.getBodyCount=function(){return this.m_bodyCount},t.prototype.getJointCount=function(){return this.m_jointCount},t.prototype.getContactCount=function(){return this.m_contactCount},t.prototype.setGravity=function(t){this.m_gravity.set(t)},t.prototype.getGravity=function(){return this.m_gravity},t.prototype.isLocked=function(){return this.m_locked},t.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,0==this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.setAwake(!0)},t.prototype.getAllowSleeping=function(){return this.m_allowSleep},t.prototype.setWarmStarting=function(t){this.m_warmStarting=t},t.prototype.getWarmStarting=function(){return this.m_warmStarting},t.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},t.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},t.prototype.setSubStepping=function(t){this.m_subStepping=t},t.prototype.getSubStepping=function(){return this.m_subStepping},t.prototype.setAutoClearForces=function(t){this.m_clearForces=t},t.prototype.getAutoClearForces=function(){return this.m_clearForces},t.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},t.prototype.queryAABB=function(t,e){var i=this.m_broadPhase;this.m_broadPhase.query(t,(function(t){var s=i.getUserData(t);return e(s.fixture)}))},t.prototype.rayCast=function(t,e,i){var s=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:e},(function(t,e){var o=s.getUserData(e),n=o.fixture,r=o.childIndex,a={};if(n.rayCast(a,t,r)){var l=a.fraction,c=ko.add(ko.mulNumVec2(1-l,t.p1),ko.mulNumVec2(l,t.p2));return i(n,c,a.normal,l)}return t.maxFraction}))},t.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},t.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},t.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},t.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},t.prototype.shiftOrigin=function(t){if(!this.m_locked){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.sub(t),e.m_sweep.c0.sub(t),e.m_sweep.c.sub(t);for(var i=this.m_jointList;i;i=i.m_next)i.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},t.prototype._addBody=function(t){this.isLocked()||(t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount)},t.prototype.createBody=function(t,e){if(this.isLocked())return null;var i={};t&&(ko.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t));var s=new lr(this,i);return this._addBody(s),s},t.prototype.createDynamicBody=function(t,e){var i={};return t&&(ko.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t)),i.type="dynamic",this.createBody(i)},t.prototype.createKinematicBody=function(t,e){var i={};return t&&(ko.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t)),i.type="kinematic",this.createBody(i)},t.prototype.destroyBody=function(t){if(!this.isLocked()){if(t.m_destroyed)return!1;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.publish("remove-joint",i.joint),this.destroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var s=t.m_contactList;s;){var o=s;s=s.next,this.destroyContact(o.contact),t.m_contactList=s}t.m_contactList=null;for(var n=t.m_fixtureList;n;){var r=n;n=n.m_next,this.publish("remove-fixture",r),r.destroyProxies(this.m_broadPhase),t.m_fixtureList=n}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",t),!0}},t.prototype.createJoint=function(t){if(this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,0==t.m_collideConnected)for(var e=t.m_bodyB.getContactList();e;e=e.next)e.other==t.m_bodyA&&e.contact.flagForFiltering();return t},t.prototype.destroyJoint=function(t){if(!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,i=t.m_bodyB;if(e.setAwake(!0),i.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,0==t.m_collideConnected)for(var s=i.getContactList();s;)s.other==e&&s.contact.flagForFiltering(),s=s.next;this.publish("remove-joint",t)}},t.prototype.step=function(t,e,i){if(this.publish("pre-step",t),(0|e)!==e&&(e=0),e=e||this.m_velocityIterations,i=i||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,this.s_step.reset(t),this.s_step.velocityIterations=e,this.s_step.positionIterations=i,this.s_step.warmStarting=this.m_warmStarting,this.s_step.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&t>0){this.m_solver.solveWorld(this.s_step);for(var s=this.m_bodyList;s;s=s.getNext())0!=s.m_islandFlag&&(s.isStatic()||s.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&t>0&&this.m_solver.solveWorldTOI(this.s_step),this.m_clearForces&&this.clearForces(),this.m_locked=!1,this.publish("post-step",t)},t.prototype.findNewContacts=function(){var t=this;this.m_broadPhase.updatePairs((function(e,i){return t.createContact(e,i)}))},t.prototype.createContact=function(t,e){var i=t.fixture,s=e.fixture,o=t.childIndex,n=e.childIndex,r=i.getBody(),a=s.getBody();if(r!=a){for(var l=a.getContactList();l;){if(l.other==r){var c=l.contact.getFixtureA(),h=l.contact.getFixtureB(),m=l.contact.getChildIndexA(),u=l.contact.getChildIndexB();if(c==i&&h==s&&m==o&&u==n)return;if(c==s&&h==i&&m==n&&u==o)return}l=l.next}if(0!=a.shouldCollide(r)&&0!=s.shouldCollide(i)){var _=Ml.create(i,o,s,n);null!=_&&(_.m_prev=null,null!=this.m_contactList&&(_.m_next=this.m_contactList,this.m_contactList.m_prev=_),this.m_contactList=_,++this.m_contactCount)}}},t.prototype.updateContacts=function(){for(var t,e=this.m_contactList;t=e;){e=t.getNext();var i=t.getFixtureA(),s=t.getFixtureB(),o=t.getChildIndexA(),n=t.getChildIndexB(),r=i.getBody(),a=s.getBody();if(t.m_filterFlag){if(0==a.shouldCollide(r)){this.destroyContact(t);continue}if(0==s.shouldCollide(i)){this.destroyContact(t);continue}t.m_filterFlag=!1}var l=r.isAwake()&&!r.isStatic(),c=a.isAwake()&&!a.isStatic();if(0!=l||0!=c){var h=i.m_proxies[o].proxyId,m=s.m_proxies[n].proxyId;0!=this.m_broadPhase.testOverlap(h,m)?t.update(this):this.destroyContact(t)}}},t.prototype.destroyContact=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),Ml.destroy(t,this),--this.m_contactCount},t.prototype.on=function(t,e){return"string"!=typeof t||"function"!=typeof e||(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)),this},t.prototype.off=function(t,e){if("string"!=typeof t||"function"!=typeof e)return this;var i=this._listeners&&this._listeners[t];if(!i||!i.length)return this;var s=i.indexOf(e);return s>=0&&i.splice(s,1),this},t.prototype.publish=function(t,e,i,s){var o=this._listeners&&this._listeners[t];if(!o||!o.length)return 0;for(var n=0;n<o.length;n++)o[n].call(this,e,i,s);return o.length},t.prototype.beginContact=function(t){this.publish("begin-contact",t)},t.prototype.endContact=function(t){this.publish("end-contact",t)},t.prototype.preSolve=function(t,e){this.publish("pre-solve",t,e)},t.prototype.postSolve=function(t,e){this.publish("post-solve",t,e)},t}(),Il=function(){function t(e,i,s){if(!(this instanceof t))return new t(e,i,s);void 0===e?(this.x=0,this.y=0,this.z=0):"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z):(this.x=e,this.y=i,this.z=s)}return t.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},t._deserialize=function(e){var i=Object.create(t.prototype);return i.x=e.x,i.y=e.y,i.z=e.z,i},t.neo=function(e,i,s){var o=Object.create(t.prototype);return o.x=e,o.y=i,o.z=s,o},t.zero=function(){var e=Object.create(t.prototype);return e.x=0,e.y=0,e.z=0,e},t.clone=function(e){return t.neo(e.x,e.y,e.z)},t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)},t.assert=function(t){},t.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},t.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.areEqual=function(t,e){return t===e||"object"==typeof t&&null!==t&&"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y&&t.z===e.z},t.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.cross=function(e,i){return new t(e.y*i.z-e.z*i.y,e.z*i.x-e.x*i.z,e.x*i.y-e.y*i.x)},t.add=function(e,i){return new t(e.x+i.x,e.y+i.y,e.z+i.z)},t.sub=function(e,i){return new t(e.x-i.x,e.y-i.y,e.z-i.z)},t.mul=function(e,i){return new t(i*e.x,i*e.y,i*e.z)},t.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},t.neg=function(e){return new t(-e.x,-e.y,-e.z)},t}(),Fl=en(0,0),Tl=en(0,0),Ll=function(t){function e(i,s){var o=this;return o instanceof e?((o=t.call(this)||this).m_type=e.TYPE,o.m_radius=Ro.polygonRadius,o.m_vertex1=i?ko.clone(i):ko.zero(),o.m_vertex2=s?ko.clone(s):ko.zero(),o.m_vertex0=ko.zero(),o.m_vertex3=ko.zero(),o.m_hasVertex0=!1,o.m_hasVertex3=!1,o):new e(i,s)}return Ao(e,t),e.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},e._deserialize=function(t){var i=new e(t.vertex1,t.vertex2);return i.m_hasVertex0&&i.setPrevVertex(t.vertex0),i.m_hasVertex3&&i.setNextVertex(t.vertex3),i},e.prototype._reset=function(){},e.prototype.getRadius=function(){return this.m_radius},e.prototype.getType=function(){return this.m_type},e.prototype.setNext=function(t){return this.setNextVertex(t)},e.prototype.setNextVertex=function(t){return t?(this.m_vertex3.setVec2(t),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},e.prototype.getNextVertex=function(){return this.m_vertex3},e.prototype.setPrev=function(t){return this.setPrevVertex(t)},e.prototype.setPrevVertex=function(t){return t?(this.m_vertex0.setVec2(t),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},e.prototype.getPrevVertex=function(){return this.m_vertex0},e.prototype._set=function(t,e){return this.m_vertex1.setVec2(t),this.m_vertex2.setVec2(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},e.prototype._clone=function(){var t=new e;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_vertex1.setVec2(this.m_vertex1),t.m_vertex2.setVec2(this.m_vertex2),t.m_vertex0.setVec2(this.m_vertex0),t.m_vertex3.setVec2(this.m_vertex3),t.m_hasVertex0=this.m_hasVertex0,t.m_hasVertex3=this.m_hasVertex3,t},e.prototype.getChildCount=function(){return 1},e.prototype.testPoint=function(t,e){return!1},e.prototype.rayCast=function(t,e,i,s){var o=kn.mulTVec2(i.q,ko.sub(e.p1,i.p)),n=kn.mulTVec2(i.q,ko.sub(e.p2,i.p)),r=ko.sub(n,o),a=this.m_vertex1,l=this.m_vertex2,c=ko.sub(l,a),h=ko.neo(c.y,-c.x);h.normalize();var m=ko.dot(h,ko.sub(a,o)),u=ko.dot(h,r);if(0==u)return!1;var _=m/u;if(_<0||e.maxFraction<_)return!1;var p=ko.add(o,ko.mulNumVec2(_,r)),d=ko.sub(l,a),y=ko.dot(d,d);if(0==y)return!1;var f=ko.dot(ko.sub(p,a),d)/y;return!(f<0||1<f||(t.fraction=_,t.normal=m>0?kn.mulVec2(i.q,h).neg():kn.mulVec2(i.q,h),0))},e.prototype.computeAABB=function(t,e,i){Mn(Fl,e,this.m_vertex1),Mn(Tl,e,this.m_vertex2),Do.combinePoints(t,Fl,Tl),Do.extend(t,this.m_radius)},e.prototype.computeMass=function(t,e){t.mass=0,pn(t.center,.5,this.m_vertex1,.5,this.m_vertex2),t.I=0},e.prototype.computeDistanceProxy=function(t){t.m_vertices[0]=this.m_vertex1,t.m_vertices[1]=this.m_vertex2,t.m_vertices.length=2,t.m_count=2,t.m_radius=this.m_radius},e.TYPE="edge",e}(Un),kl=Ll,ql=en(0,0),Nl=en(0,0),Dl=function(t){function e(i,s){var o=this;return o instanceof e?((o=t.call(this)||this).m_type=e.TYPE,o.m_radius=Ro.polygonRadius,o.m_vertices=[],o.m_count=0,o.m_prevVertex=null,o.m_nextVertex=null,o.m_hasPrevVertex=!1,o.m_hasNextVertex=!1,o.m_isLoop=!!s,i&&i.length&&(s?o._createLoop(i):o._createChain(i)),o):new e(i,s)}return Ao(e,t),e.prototype._serialize=function(){var t={type:this.m_type,vertices:this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex,prevVertex:null,nextVertex:null};return this.m_prevVertex&&(t.prevVertex=this.m_prevVertex),this.m_nextVertex&&(t.nextVertex=this.m_nextVertex),t},e._deserialize=function(t,i,s){var o=[];if(t.vertices)for(var n=0;n<t.vertices.length;n++)o.push(s(ko,t.vertices[n]));var r=new e(o,t.isLoop);return t.prevVertex&&r.setPrevVertex(t.prevVertex),t.nextVertex&&r.setNextVertex(t.nextVertex),r},e.prototype.getType=function(){return this.m_type},e.prototype.getRadius=function(){return this.m_radius},e.prototype._createLoop=function(t){if(!(t.length<3)){for(var e=1;e<t.length;++e)t[e-1],t[e];for(this.m_vertices=[],this.m_count=t.length+1,e=0;e<t.length;++e)this.m_vertices[e]=ko.clone(t[e]);return this.m_vertices[t.length]=ko.clone(t[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}},e.prototype._createChain=function(t){for(var e=1;e<t.length;++e)t[e-1],t[e];for(this.m_count=t.length,e=0;e<t.length;++e)this.m_vertices[e]=ko.clone(t[e]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex=null,this.m_nextVertex=null,this},e.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices):this._createChain(this.m_vertices)},e.prototype.setPrevVertex=function(t){this.m_prevVertex=t,this.m_hasPrevVertex=!0},e.prototype.getPrevVertex=function(){return this.m_prevVertex},e.prototype.setNextVertex=function(t){this.m_nextVertex=t,this.m_hasNextVertex=!0},e.prototype.getNextVertex=function(){return this.m_nextVertex},e.prototype._clone=function(){var t=new e;return t._createChain(this.m_vertices),t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_prevVertex=this.m_prevVertex,t.m_nextVertex=this.m_nextVertex,t.m_hasPrevVertex=this.m_hasPrevVertex,t.m_hasNextVertex=this.m_hasNextVertex,t},e.prototype.getChildCount=function(){return this.m_count-1},e.prototype.getChildEdge=function(t,e){t.m_type=Ll.TYPE,t.m_radius=this.m_radius,t.m_vertex1=this.m_vertices[e],t.m_vertex2=this.m_vertices[e+1],e>0?(t.m_vertex0=this.m_vertices[e-1],t.m_hasVertex0=!0):(t.m_vertex0=this.m_prevVertex,t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3=this.m_vertices[e+2],t.m_hasVertex3=!0):(t.m_vertex3=this.m_nextVertex,t.m_hasVertex3=this.m_hasNextVertex)},e.prototype.getVertex=function(t){return t<this.m_count?this.m_vertices[t]:this.m_vertices[0]},e.prototype.isLoop=function(){return this.m_isLoop},e.prototype.testPoint=function(t,e){return!1},e.prototype.rayCast=function(t,e,i,s){return new Ll(this.getVertex(s),this.getVertex(s+1)).rayCast(t,e,i,0)},e.prototype.computeAABB=function(t,e,i){Mn(ql,e,this.getVertex(i)),Mn(Nl,e,this.getVertex(i+1)),Do.combinePoints(t,ql,Nl)},e.prototype.computeMass=function(t,e){t.mass=0,nn(t.center),t.I=0},e.prototype.computeDistanceProxy=function(t,e){t.m_vertices[0]=this.getVertex(e),t.m_vertices[1]=this.getVertex(e+1),t.m_count=2,t.m_radius=this.m_radius},e.TYPE="chain",e}(Un),Ol=Dl,jl=Math.max,Rl=Math.min,El=en(0,0),Yl=en(0,0),Jl=en(0,0),Wl=en(0,0),Ul=en(0,0),Hl=en(0,0),Gl=function(t){function e(i){var s=this;return s instanceof e?((s=t.call(this)||this).m_type=e.TYPE,s.m_radius=Ro.polygonRadius,s.m_centroid=ko.zero(),s.m_vertices=[],s.m_normals=[],s.m_count=0,i&&i.length&&s._set(i),s):new e(i)}return Ao(e,t),e.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},e._deserialize=function(t,i,s){var o=[];if(t.vertices)for(var n=0;n<t.vertices.length;n++)o.push(s(ko,t.vertices[n]));return new e(o)},e.prototype.getType=function(){return this.m_type},e.prototype.getRadius=function(){return this.m_radius},e.prototype._clone=function(){var t=new e;t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_count=this.m_count,t.m_centroid.setVec2(this.m_centroid);for(var i=0;i<this.m_count;i++)t.m_vertices.push(this.m_vertices[i].clone());for(i=0;i<this.m_normals.length;i++)t.m_normals.push(this.m_normals[i].clone());return t},e.prototype.getChildCount=function(){return 1},e.prototype._reset=function(){this._set(this.m_vertices)},e.prototype._set=function(t){if(t.length<3)this._setAsBox(1,1);else{for(var e=Rl(t.length,Ro.maxPolygonVertices),i=[],s=0;s<e;++s){for(var o=t[s],n=!0,r=0;r<i.length;++r)if(ko.distanceSquared(o,i[r])<.25*Ro.linearSlopSquared){n=!1;break}n&&i.push(ko.clone(o))}if((e=i.length)<3)this._setAsBox(1,1);else{var a=0,l=i[0].x;for(s=1;s<e;++s){var c=i[s].x;(c>l||c===l&&i[s].y<i[a].y)&&(a=s,l=c)}for(var h=[],m=0,u=a;;){h[m]=u;var _=0;for(r=1;r<e;++r)if(_!==u){var p=ko.sub(i[_],i[h[m]]),d=(o=ko.sub(i[r],i[h[m]]),ko.crossVec2Vec2(p,o));d<0&&(_=r),0===d&&o.lengthSquared()>p.lengthSquared()&&(_=r)}else _=r;if(++m,u=_,_===a)break}if(m<3)this._setAsBox(1,1);else{for(this.m_count=m,this.m_vertices=[],s=0;s<m;++s)this.m_vertices[s]=i[h[s]];for(s=0;s<m;++s){var y=s,f=s+1<m?s+1:0,v=ko.sub(this.m_vertices[f],this.m_vertices[y]);this.m_normals[s]=ko.crossVec2Num(v,1),this.m_normals[s].normalize()}this.m_centroid=function(t,e){for(var i=ko.zero(),s=0,o=ko.zero(),n=0;n<e;++n){var r=o,a=t[n],l=n+1<e?t[n+1]:t[0],c=ko.sub(a,r),h=ko.sub(l,r),m=.5*ko.crossVec2Vec2(c,h);s+=m,dn(El,1,r,1,a,1,l),un(i,.3333333333333333*m,El)}return i.mul(1/s),i}(this.m_vertices,m)}}}},e.prototype._setAsBox=function(t,e,i,s){if(this.m_vertices[0]=ko.neo(t,-e),this.m_vertices[1]=ko.neo(t,e),this.m_vertices[2]=ko.neo(-t,e),this.m_vertices[3]=ko.neo(-t,-e),this.m_normals[0]=ko.neo(1,0),this.m_normals[1]=ko.neo(0,1),this.m_normals[2]=ko.neo(-1,0),this.m_normals[3]=ko.neo(0,-1),this.m_count=4,i&&ko.isValid(i)){s=s||0,on(this.m_centroid,i);var o=jn.identity();o.p.setVec2(i),o.q.setAngle(s);for(var n=0;n<this.m_count;++n)this.m_vertices[n]=jn.mulVec2(o,this.m_vertices[n]),this.m_normals[n]=kn.mulVec2(o.q,this.m_normals[n])}},e.prototype.testPoint=function(t,e){for(var i=Pn(El,t,e),s=0;s<this.m_count;++s)if(xn(this.m_normals[s],i)-xn(this.m_normals[s],this.m_vertices[s])>0)return!1;return!0},e.prototype.rayCast=function(t,e,i,s){for(var o=kn.mulTVec2(i.q,ko.sub(e.p1,i.p)),n=kn.mulTVec2(i.q,ko.sub(e.p2,i.p)),r=ko.sub(n,o),a=0,l=e.maxFraction,c=-1,h=0;h<this.m_count;++h){var m=ko.dot(this.m_normals[h],ko.sub(this.m_vertices[h],o)),u=ko.dot(this.m_normals[h],r);if(0==u){if(m<0)return!1}else u<0&&m<a*u?(a=m/u,c=h):u>0&&m<l*u&&(l=m/u);if(l<a)return!1}return c>=0&&(t.fraction=a,t.normal=kn.mulVec2(i.q,this.m_normals[c]),!0)},e.prototype.computeAABB=function(t,e,i){for(var s=1/0,o=1/0,n=-1/0,r=-1/0,a=0;a<this.m_count;++a){var l=Mn(El,e,this.m_vertices[a]);s=Rl(s,l.x),n=jl(n,l.x),o=Rl(o,l.y),r=jl(r,l.y)}sn(t.lowerBound,s-this.m_radius,o-this.m_radius),sn(t.upperBound,n+this.m_radius,r+this.m_radius)},e.prototype.computeMass=function(t,e){nn(Ul);var i=0,s=0;nn(Hl);for(var o=0;o<this.m_count;++o)an(Hl,this.m_vertices[o]);mn(Hl,1/this.m_count,Hl);var n,r,a,l=1/3;for(o=0;o<this.m_count;++o){cn(Jl,this.m_vertices[o],Hl),o+1<this.m_count?cn(Wl,this.m_vertices[o+1],Hl):cn(Wl,this.m_vertices[0],Hl);var c=gn(Jl,Wl),h=.5*c;i+=h,pn(El,h*l,Jl,h*l,Wl),an(Ul,El);var m=Jl.x,u=Jl.y,_=Wl.x,p=Wl.y;s+=.25*l*c*(m*m+_*m+_*_+(u*u+p*u+p*p))}t.mass=e*i,mn(Ul,1/i,Ul),n=t.center,r=Ul,a=Hl,n.x=r.x+a.x,n.y=r.x+a.y,t.I=e*s,t.I+=t.mass*(xn(t.center,t.center)-xn(Ul,Ul))},e.prototype.validate=function(){for(var t=0;t<this.m_count;++t){var e=t,i=t<this.m_count-1?e+1:0,s=this.m_vertices[e];cn(Yl,this.m_vertices[i],s);for(var o=0;o<this.m_count;++o)if(o!=e&&o!=i&&gn(Yl,cn(El,this.m_vertices[o],s))<0)return!1}return!0},e.prototype.computeDistanceProxy=function(t){for(var e=0;e<this.m_count;++e)t.m_vertices[e]=this.m_vertices[e];t.m_vertices.length=this.m_count,t.m_count=this.m_count,t.m_radius=this.m_radius},e.TYPE="polygon",e}(Un),Xl=Gl,Kl=function(t){function e(i,s,o,n){var r=this;return r instanceof e?((r=t.call(this)||this)._setAsBox(i,s,o,n),r):new e(i,s,o,n)}return Ao(e,t),e.TYPE="polygon",e}(Gl),Zl=Kl,$l=Math.sqrt,Ql=Math.PI,tc=en(0,0),ec=function(t){function e(i,s){var o=this;return o instanceof e?((o=t.call(this)||this).m_type=e.TYPE,o.m_p=ko.zero(),o.m_radius=1,"object"==typeof i&&ko.isValid(i)?(o.m_p.setVec2(i),"number"==typeof s&&(o.m_radius=s)):"number"==typeof i&&(o.m_radius=i),o):new e(i,s)}return Ao(e,t),e.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},e._deserialize=function(t){return new e(t.p,t.radius)},e.prototype._reset=function(){},e.prototype.getType=function(){return this.m_type},e.prototype.getRadius=function(){return this.m_radius},e.prototype.getCenter=function(){return this.m_p},e.prototype._clone=function(){var t=new e;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_p=this.m_p.clone(),t},e.prototype.getChildCount=function(){return 1},e.prototype.testPoint=function(t,e){return Bn(e,Mn(tc,t,this.m_p))<=this.m_radius*this.m_radius},e.prototype.rayCast=function(t,e,i,s){var o=ko.add(i.p,kn.mulVec2(i.q,this.m_p)),n=ko.sub(e.p1,o),r=ko.dot(n,n)-this.m_radius*this.m_radius,a=ko.sub(e.p2,e.p1),l=ko.dot(n,a),c=ko.dot(a,a),h=l*l-c*r;if(h<0||c<Co)return!1;var m=-(l+$l(h));return 0<=m&&m<=e.maxFraction*c&&(m/=c,t.fraction=m,t.normal=ko.add(n,ko.mulNumVec2(m,a)),t.normal.normalize(),!0)},e.prototype.computeAABB=function(t,e,i){var s=Mn(tc,e,this.m_p);sn(t.lowerBound,s.x-this.m_radius,s.y-this.m_radius),sn(t.upperBound,s.x+this.m_radius,s.y+this.m_radius)},e.prototype.computeMass=function(t,e){t.mass=e*Ql*this.m_radius*this.m_radius,on(t.center,this.m_p),t.I=t.mass*(.5*this.m_radius*this.m_radius+bn(this.m_p))},e.prototype.computeDistanceProxy=function(t){t.m_vertices[0]=this.m_p,t.m_vertices.length=1,t.m_count=1,t.m_radius=this.m_radius},e.TYPE="circle",e}(Un),ic=ec,sc=Math.abs,oc=Math.PI,nc={frequencyHz:0,dampingRatio:0},rc=function(t){function e(i,s,o,n,r){var a=this;if(!(a instanceof e))return new e(i,s,o,n,r);if(o&&n&&"m_type"in n&&"x"in o&&"y"in o){var l=o;o=n,n=l}return i=wo(i,nc),s=(a=t.call(this,i,s,o)||this).m_bodyA,o=a.m_bodyB,a.m_type=e.TYPE,a.m_localAnchorA=ko.clone(n?s.getLocalPoint(n):i.localAnchorA||ko.zero()),a.m_localAnchorB=ko.clone(r?o.getLocalPoint(r):i.localAnchorB||ko.zero()),a.m_length=Number.isFinite(i.length)?i.length:ko.distance(s.getWorldPoint(a.m_localAnchorA),o.getWorldPoint(a.m_localAnchorB)),a.m_frequencyHz=i.frequencyHz,a.m_dampingRatio=i.dampingRatio,a.m_impulse=0,a.m_gamma=0,a.m_bias=0,a}return Ao(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},e._deserialize=function(t,i,s){return(t=Bo({},t)).bodyA=s(lr,t.bodyA,i),t.bodyB=s(lr,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.length>0?this.m_length=+t.length:t.length<0||(t.anchorA||t.anchorA||t.anchorA||t.anchorA)&&(this.m_length=ko.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB))),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.setLength=function(t){this.m_length=t},e.prototype.getLength=function(){return this.m_length},e.prototype.setFrequency=function(t){this.m_frequencyHz=t},e.prototype.getFrequency=function(){return this.m_frequencyHz},e.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return ko.mulNumVec2(this.m_impulse,this.m_u).mul(t)},e.prototype.getReactionTorque=function(t){return 0},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,c=kn.neo(i),h=kn.neo(r);this.m_rA=kn.mulVec2(c,ko.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=kn.mulVec2(h,ko.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=ko.sub(ko.add(n,this.m_rB),ko.add(e,this.m_rA));var m=this.m_u.length();m>Ro.linearSlop?this.m_u.mul(1/m):this.m_u.setNum(0,0);var u=ko.crossVec2Vec2(this.m_rA,this.m_u),_=ko.crossVec2Vec2(this.m_rB,this.m_u),p=this.m_invMassA+this.m_invIA*u*u+this.m_invMassB+this.m_invIB*_*_;if(this.m_mass=0!=p?1/p:0,this.m_frequencyHz>0){var d=m-this.m_length,y=2*oc*this.m_frequencyHz,f=2*this.m_mass*this.m_dampingRatio*y,v=this.m_mass*y*y,g=t.dt;this.m_gamma=g*(f+g*v),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=d*g*v*this.m_gamma,p+=this.m_gamma,this.m_mass=0!=p?1/p:0}else this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse*=t.dtRatio;var x=ko.mulNumVec2(this.m_impulse,this.m_u);s.subMul(this.m_invMassA,x),o-=this.m_invIA*ko.crossVec2Vec2(this.m_rA,x),a.addMul(this.m_invMassB,x),l+=this.m_invIB*ko.crossVec2Vec2(this.m_rB,x)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=l},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=ko.add(e,ko.crossNumVec2(i,this.m_rA)),r=ko.add(s,ko.crossNumVec2(o,this.m_rB)),a=ko.dot(this.m_u,r)-ko.dot(this.m_u,n),l=-this.m_mass*(a+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=l;var c=ko.mulNumVec2(l,this.m_u);e.subMul(this.m_invMassA,c),i-=this.m_invIA*ko.crossVec2Vec2(this.m_rA,c),s.addMul(this.m_invMassB,c),o+=this.m_invIB*ko.crossVec2Vec2(this.m_rB,c),this.m_bodyA.c_velocity.v.setVec2(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.setVec2(s),this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){if(this.m_frequencyHz>0)return!0;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=kn.neo(i),r=kn.neo(o),a=kn.mulSub(n,this.m_localAnchorA,this.m_localCenterA),l=kn.mulSub(r,this.m_localAnchorB,this.m_localCenterB),c=ko.sub(ko.add(s,l),ko.add(e,a)),h=Po(c.normalize()-this.m_length,-Ro.maxLinearCorrection,Ro.maxLinearCorrection),m=-this.m_mass*h,u=ko.mulNumVec2(m,c);return e.subMul(this.m_invMassA,u),i-=this.m_invIA*ko.crossVec2Vec2(a,u),s.addMul(this.m_invMassB,u),o+=this.m_invIB*ko.crossVec2Vec2(l,u),this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(s),this.m_bodyB.c_position.a=o,sc(h)<Ro.linearSlop},e.TYPE="distance-joint",e}(hr),ac={maxForce:0,maxTorque:0},lc=function(t){function e(i,s,o,n){var r=this;return r instanceof e?(i=wo(i,ac),s=(r=t.call(this,i,s,o)||this).m_bodyA,o=r.m_bodyB,r.m_type=e.TYPE,r.m_localAnchorA=ko.clone(n?s.getLocalPoint(n):i.localAnchorA||ko.zero()),r.m_localAnchorB=ko.clone(n?o.getLocalPoint(n):i.localAnchorB||ko.zero()),r.m_linearImpulse=ko.zero(),r.m_angularImpulse=0,r.m_maxForce=i.maxForce,r.m_maxTorque=i.maxTorque,r):new e(i,s,o,n)}return Ao(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}},e._deserialize=function(t,i,s){return(t=Bo({},t)).bodyA=s(lr,t.bodyA,i),t.bodyB=s(lr,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),Number.isFinite(t.maxForce)&&(this.m_maxForce=t.maxForce),Number.isFinite(t.maxTorque)&&(this.m_maxTorque=t.maxTorque)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.setMaxForce=function(t){this.m_maxForce=t},e.prototype.getMaxForce=function(){return this.m_maxForce},e.prototype.setMaxTorque=function(t){this.m_maxTorque=t},e.prototype.getMaxTorque=function(){return this.m_maxTorque},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return ko.mulNumVec2(t,this.m_linearImpulse)},e.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=kn.neo(e),l=kn.neo(o);this.m_rA=kn.mulVec2(a,ko.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=kn.mulVec2(l,ko.sub(this.m_localAnchorB,this.m_localCenterB));var c=this.m_invMassA,h=this.m_invMassB,m=this.m_invIA,u=this.m_invIB,_=new Ca;if(_.ex.x=c+h+m*this.m_rA.y*this.m_rA.y+u*this.m_rB.y*this.m_rB.y,_.ex.y=-m*this.m_rA.x*this.m_rA.y-u*this.m_rB.x*this.m_rB.y,_.ey.x=_.ex.y,_.ey.y=c+h+m*this.m_rA.x*this.m_rA.x+u*this.m_rB.x*this.m_rB.x,this.m_linearMass=_.getInverse(),this.m_angularMass=m+u,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var p=ko.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);i.subMul(c,p),s-=m*(ko.crossVec2Vec2(this.m_rA,p)+this.m_angularImpulse),n.addMul(h,p),r+=u*(ko.crossVec2Vec2(this.m_rB,p)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,l=this.m_invIB,c=t.dt,h=o-i,m=-this.m_angularMass*h,u=this.m_angularImpulse,_=c*this.m_maxTorque;this.m_angularImpulse=Po(this.m_angularImpulse+m,-_,_),i-=a*(m=this.m_angularImpulse-u),o+=l*m,h=ko.sub(ko.add(s,ko.crossNumVec2(o,this.m_rB)),ko.add(e,ko.crossNumVec2(i,this.m_rA))),m=ko.neg(Ca.mulVec2(this.m_linearMass,h)),u=this.m_linearImpulse,this.m_linearImpulse.add(m),_=c*this.m_maxForce,this.m_linearImpulse.lengthSquared()>_*_&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(_)),m=ko.sub(this.m_linearImpulse,u),e.subMul(n,m),i-=a*ko.crossVec2Vec2(this.m_rA,m),s.addMul(r,m),o+=l*ko.crossVec2Vec2(this.m_rB,m),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){return!0},e.TYPE="friction-joint",e}(hr),cc=function(){function t(t,e,i){"object"==typeof t&&null!==t?(this.ex=Il.clone(t),this.ey=Il.clone(e),this.ez=Il.clone(i)):(this.ex=Il.zero(),this.ey=Il.zero(),this.ez=Il.zero())}return t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&Il.isValid(t.ex)&&Il.isValid(t.ey)&&Il.isValid(t.ez)},t.assert=function(t){},t.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},t.prototype.solve33=function(t){var e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,i=this.ey.z*this.ez.x-this.ey.x*this.ez.z,s=this.ey.x*this.ez.y-this.ey.y*this.ez.x,o=this.ex.x*e+this.ex.y*i+this.ex.z*s;0!==o&&(o=1/o);var n=new Il;return e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,i=this.ey.z*this.ez.x-this.ey.x*this.ez.z,s=this.ey.x*this.ez.y-this.ey.y*this.ez.x,n.x=o*(t.x*e+t.y*i+t.z*s),e=t.y*this.ez.z-t.z*this.ez.y,i=t.z*this.ez.x-t.x*this.ez.z,s=t.x*this.ez.y-t.y*this.ez.x,n.y=o*(this.ex.x*e+this.ex.y*i+this.ex.z*s),e=this.ey.y*t.z-this.ey.z*t.y,i=this.ey.z*t.x-this.ey.x*t.z,s=this.ey.x*t.y-this.ey.y*t.x,n.z=o*(this.ex.x*e+this.ex.y*i+this.ex.z*s),n},t.prototype.solve22=function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;0!==n&&(n=1/n);var r=ko.zero();return r.x=n*(o*t.x-i*t.y),r.y=n*(e*t.y-s*t.x),r},t.prototype.getInverse22=function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;0!==n&&(n=1/n),t.ex.x=n*o,t.ey.x=-n*i,t.ex.z=0,t.ex.y=-n*s,t.ey.y=n*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},t.prototype.getSymInverse33=function(t){var e=Il.dot(this.ex,Il.cross(this.ey,this.ez));0!==e&&(e=1/e);var i=this.ex.x,s=this.ey.x,o=this.ez.x,n=this.ey.y,r=this.ez.y,a=this.ez.z;t.ex.x=e*(n*a-r*r),t.ex.y=e*(o*r-s*a),t.ex.z=e*(s*r-o*n),t.ey.x=t.ex.y,t.ey.y=e*(i*a-o*o),t.ey.z=e*(o*s-i*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*n-s*s)},t.mul=function(t,e){if(e&&"z"in e&&"y"in e&&"x"in e){var i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,s=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,o=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new Il(i,s,o)}if(e&&"y"in e&&"x"in e)return i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y,ko.neo(i,s)},t.mulVec3=function(t,e){var i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,s=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,o=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new Il(i,s,o)},t.mulVec2=function(t,e){var i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return ko.neo(i,s)},t.add=function(e,i){return new t(Il.add(e.ex,i.ex),Il.add(e.ey,i.ey),Il.add(e.ez,i.ez))},t}(),hc=Math.abs;(Qa=$a||($a={}))[Qa.inactiveLimit=0]="inactiveLimit",Qa[Qa.atLowerLimit=1]="atLowerLimit",Qa[Qa.atUpperLimit=2]="atUpperLimit",Qa[Qa.equalLimits=3]="equalLimits";var mc,uc=function(t){function e(i,s,o,n){var r,a,l,c,h,m,u=this;return u instanceof e?(i=null!=i?i:{},s=(u=t.call(this,i,s,o)||this).m_bodyA,o=u.m_bodyB,u.m_mass=new cc,u.m_limitState=$a.inactiveLimit,u.m_type=e.TYPE,ko.isValid(n)?u.m_localAnchorA=s.getLocalPoint(n):ko.isValid(i.localAnchorA)?u.m_localAnchorA=ko.clone(i.localAnchorA):u.m_localAnchorA=ko.zero(),ko.isValid(n)?u.m_localAnchorB=o.getLocalPoint(n):ko.isValid(i.localAnchorB)?u.m_localAnchorB=ko.clone(i.localAnchorB):u.m_localAnchorB=ko.zero(),Number.isFinite(i.referenceAngle)?u.m_referenceAngle=i.referenceAngle:u.m_referenceAngle=o.getAngle()-s.getAngle(),u.m_impulse=new Il,u.m_motorImpulse=0,u.m_lowerAngle=null!==(r=i.lowerAngle)&&void 0!==r?r:0,u.m_upperAngle=null!==(a=i.upperAngle)&&void 0!==a?a:0,u.m_maxMotorTorque=null!==(l=i.maxMotorTorque)&&void 0!==l?l:0,u.m_motorSpeed=null!==(c=i.motorSpeed)&&void 0!==c?c:0,u.m_enableLimit=null!==(h=i.enableLimit)&&void 0!==h&&h,u.m_enableMotor=null!==(m=i.enableMotor)&&void 0!==m&&m,u):new e(i,s,o,n)}return Ao(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},e._deserialize=function(t,i,s){return(t=Bo({},t)).bodyA=s(lr,t.bodyA,i),t.bodyB=s(lr,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),Number.isFinite(t.referenceAngle)&&(this.m_referenceAngle=t.referenceAngle),void 0!==t.enableLimit&&(this.m_enableLimit=t.enableLimit),Number.isFinite(t.lowerAngle)&&(this.m_lowerAngle=t.lowerAngle),Number.isFinite(t.upperAngle)&&(this.m_upperAngle=t.upperAngle),Number.isFinite(t.maxMotorTorque)&&(this.m_maxMotorTorque=t.maxMotorTorque),Number.isFinite(t.motorSpeed)&&(this.m_motorSpeed=t.motorSpeed),void 0!==t.enableMotor&&(this.m_enableMotor=t.enableMotor)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getReferenceAngle=function(){return this.m_referenceAngle},e.prototype.getJointAngle=function(){var t=this.m_bodyA;return this.m_bodyB.m_sweep.a-t.m_sweep.a-this.m_referenceAngle},e.prototype.getJointSpeed=function(){var t=this.m_bodyA;return this.m_bodyB.m_angularVelocity-t.m_angularVelocity},e.prototype.isMotorEnabled=function(){return this.m_enableMotor},e.prototype.enableMotor=function(t){t!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t)},e.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},e.prototype.setMotorSpeed=function(t){t!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t)},e.prototype.getMotorSpeed=function(){return this.m_motorSpeed},e.prototype.setMaxMotorTorque=function(t){t!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t)},e.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},e.prototype.isLimitEnabled=function(){return this.m_enableLimit},e.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.prototype.getLowerLimit=function(){return this.m_lowerAngle},e.prototype.getUpperLimit=function(){return this.m_upperAngle},e.prototype.setLimits=function(t,e){t==this.m_lowerAngle&&e==this.m_upperAngle||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return ko.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=kn.neo(e),l=kn.neo(o);this.m_rA=kn.mulVec2(a,ko.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=kn.mulVec2(l,ko.sub(this.m_localAnchorB,this.m_localCenterB));var c=this.m_invMassA,h=this.m_invMassB,m=this.m_invIA,u=this.m_invIB,_=m+u===0;if(this.m_mass.ex.x=c+h+this.m_rA.y*this.m_rA.y*m+this.m_rB.y*this.m_rB.y*u,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*m-this.m_rB.y*this.m_rB.x*u,this.m_mass.ez.x=-this.m_rA.y*m-this.m_rB.y*u,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=c+h+this.m_rA.x*this.m_rA.x*m+this.m_rB.x*this.m_rB.x*u,this.m_mass.ez.y=this.m_rA.x*m+this.m_rB.x*u,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=m+u,this.m_motorMass=m+u,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(0==this.m_enableMotor||_)&&(this.m_motorImpulse=0),this.m_enableLimit&&0==_){var p=o-e-this.m_referenceAngle;hc(this.m_upperAngle-this.m_lowerAngle)<2*Ro.angularSlop?this.m_limitState=$a.equalLimits:p<=this.m_lowerAngle?(this.m_limitState!=$a.atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=$a.atLowerLimit):p>=this.m_upperAngle?(this.m_limitState!=$a.atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=$a.atUpperLimit):(this.m_limitState=$a.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=$a.inactiveLimit;if(t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var d=ko.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(c,d),s-=m*(ko.crossVec2Vec2(this.m_rA,d)+this.m_motorImpulse+this.m_impulse.z),n.addMul(h,d),r+=u*(ko.crossVec2Vec2(this.m_rB,d)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,l=this.m_invIB,c=a+l===0;if(this.m_enableMotor&&this.m_limitState!=$a.equalLimits&&0==c){var h=o-i-this.m_motorSpeed,m=-this.m_motorMass*h,u=this.m_motorImpulse,_=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=Po(this.m_motorImpulse+m,-_,_),i-=a*(m=this.m_motorImpulse-u),o+=l*m}if(this.m_enableLimit&&this.m_limitState!=$a.inactiveLimit&&0==c){var p=ko.zero();p.addCombine(1,s,1,ko.crossNumVec2(o,this.m_rB)),p.subCombine(1,e,1,ko.crossNumVec2(i,this.m_rA));var d=o-i;if(h=new Il(p.x,p.y,d),m=Il.neg(this.m_mass.solve33(h)),this.m_limitState==$a.equalLimits)this.m_impulse.add(m);else if(this.m_limitState==$a.atLowerLimit)if(this.m_impulse.z+m.z<0){var y=ko.combine(-1,p,this.m_impulse.z,ko.neo(this.m_mass.ez.x,this.m_mass.ez.y)),f=this.m_mass.solve22(y);m.x=f.x,m.y=f.y,m.z=-this.m_impulse.z,this.m_impulse.x+=f.x,this.m_impulse.y+=f.y,this.m_impulse.z=0}else this.m_impulse.add(m);else this.m_limitState==$a.atUpperLimit&&(this.m_impulse.z+m.z>0?(y=ko.combine(-1,p,this.m_impulse.z,ko.neo(this.m_mass.ez.x,this.m_mass.ez.y)),f=this.m_mass.solve22(y),m.x=f.x,m.y=f.y,m.z=-this.m_impulse.z,this.m_impulse.x+=f.x,this.m_impulse.y+=f.y,this.m_impulse.z=0):this.m_impulse.add(m));var v=ko.neo(m.x,m.y);e.subMul(n,v),i-=a*(ko.crossVec2Vec2(this.m_rA,v)+m.z),s.addMul(r,v),o+=l*(ko.crossVec2Vec2(this.m_rB,v)+m.z)}else(h=ko.zero()).addCombine(1,s,1,ko.crossNumVec2(o,this.m_rB)),h.subCombine(1,e,1,ko.crossNumVec2(i,this.m_rA)),m=this.m_mass.solve22(ko.neg(h)),this.m_impulse.x+=m.x,this.m_impulse.y+=m.y,e.subMul(n,m),i-=a*ko.crossVec2Vec2(this.m_rA,m),s.addMul(r,m),o+=l*ko.crossVec2Vec2(this.m_rB,m);this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){var e,i=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,r=kn.neo(s),a=kn.neo(n),l=0,c=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=$a.inactiveLimit&&0==c){var h=n-s-this.m_referenceAngle,m=0;if(this.m_limitState==$a.equalLimits){var u=Po(h-this.m_lowerAngle,-Ro.maxAngularCorrection,Ro.maxAngularCorrection);m=-this.m_motorMass*u,l=hc(u)}else this.m_limitState==$a.atLowerLimit?(l=-(u=h-this.m_lowerAngle),u=Po(u+Ro.angularSlop,-Ro.maxAngularCorrection,0),m=-this.m_motorMass*u):this.m_limitState==$a.atUpperLimit&&(l=u=h-this.m_upperAngle,u=Po(u-Ro.angularSlop,0,Ro.maxAngularCorrection),m=-this.m_motorMass*u);s-=this.m_invIA*m,n+=this.m_invIB*m}r.setAngle(s),a.setAngle(n);var _=kn.mulVec2(r,ko.sub(this.m_localAnchorA,this.m_localCenterA)),p=kn.mulVec2(a,ko.sub(this.m_localAnchorB,this.m_localCenterB));(u=ko.zero()).addCombine(1,o,1,p),u.subCombine(1,i,1,_),e=u.length();var d=this.m_invMassA,y=this.m_invMassB,f=this.m_invIA,v=this.m_invIB,g=new Ca;g.ex.x=d+y+f*_.y*_.y+v*p.y*p.y,g.ex.y=-f*_.x*_.y-v*p.x*p.y,g.ey.x=g.ex.y,g.ey.y=d+y+f*_.x*_.x+v*p.x*p.x;var x=ko.neg(g.solve(u));return i.subMul(d,x),s-=f*ko.crossVec2Vec2(_,x),o.addMul(y,x),n+=v*ko.crossVec2Vec2(p,x),this.m_bodyA.c_position.c.setVec2(i),this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=n,e<=Ro.linearSlop&&l<=Ro.angularSlop},e.TYPE="revolute-joint",e}(hr),_c=Math.abs,pc=Math.max,dc=Math.min;!function(t){t[t.inactiveLimit=0]="inactiveLimit",t[t.atLowerLimit=1]="atLowerLimit",t[t.atUpperLimit=2]="atUpperLimit",t[t.equalLimits=3]="equalLimits"}(mc||(mc={}));var yc,fc={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0},vc=function(t){function e(i,s,o,n,r){var a=this;return a instanceof e?(i=wo(i,fc),s=(a=t.call(this,i,s,o)||this).m_bodyA,o=a.m_bodyB,a.m_type=e.TYPE,a.m_localAnchorA=ko.clone(n?s.getLocalPoint(n):i.localAnchorA||ko.zero()),a.m_localAnchorB=ko.clone(n?o.getLocalPoint(n):i.localAnchorB||ko.zero()),a.m_localXAxisA=ko.clone(r?s.getLocalVector(r):i.localAxisA||ko.neo(1,0)),a.m_localXAxisA.normalize(),a.m_localYAxisA=ko.crossNumVec2(1,a.m_localXAxisA),a.m_referenceAngle=Number.isFinite(i.referenceAngle)?i.referenceAngle:o.getAngle()-s.getAngle(),a.m_impulse=new Il,a.m_motorMass=0,a.m_motorImpulse=0,a.m_lowerTranslation=i.lowerTranslation,a.m_upperTranslation=i.upperTranslation,a.m_maxMotorForce=i.maxMotorForce,a.m_motorSpeed=i.motorSpeed,a.m_enableLimit=i.enableLimit,a.m_enableMotor=i.enableMotor,a.m_limitState=mc.inactiveLimit,a.m_axis=ko.zero(),a.m_perp=ko.zero(),a.m_K=new cc,a):new e(i,s,o,n,r)}return Ao(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}},e._deserialize=function(t,i,s){return(t=Bo({},t)).bodyA=s(lr,t.bodyA,i),t.bodyB=s(lr,t.bodyB,i),t.localAxisA=ko.clone(t.localAxisA),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.setVec2(t.localAxisA),this.m_localYAxisA.setVec2(ko.crossNumVec2(1,t.localAxisA))),Number.isFinite(t.referenceAngle)&&(this.m_referenceAngle=t.referenceAngle),void 0!==t.enableLimit&&(this.m_enableLimit=!!t.enableLimit),Number.isFinite(t.lowerTranslation)&&(this.m_lowerTranslation=t.lowerTranslation),Number.isFinite(t.upperTranslation)&&(this.m_upperTranslation=t.upperTranslation),void 0!==t.enableMotor&&(this.m_enableMotor=!!t.enableMotor),Number.isFinite(t.maxMotorForce)&&(this.m_maxMotorForce=t.maxMotorForce),Number.isFinite(t.motorSpeed)&&(this.m_motorSpeed=t.motorSpeed)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getLocalAxisA=function(){return this.m_localXAxisA},e.prototype.getReferenceAngle=function(){return this.m_referenceAngle},e.prototype.getJointTranslation=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_bodyB.getWorldPoint(this.m_localAnchorB),i=ko.sub(e,t),s=this.m_bodyA.getWorldVector(this.m_localXAxisA);return ko.dot(i,s)},e.prototype.getJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB,i=kn.mulVec2(t.m_xf.q,ko.sub(this.m_localAnchorA,t.m_sweep.localCenter)),s=kn.mulVec2(e.m_xf.q,ko.sub(this.m_localAnchorB,e.m_sweep.localCenter)),o=ko.add(t.m_sweep.c,i),n=ko.add(e.m_sweep.c,s),r=ko.sub(n,o),a=kn.mulVec2(t.m_xf.q,this.m_localXAxisA),l=t.m_linearVelocity,c=e.m_linearVelocity,h=t.m_angularVelocity,m=e.m_angularVelocity;return ko.dot(r,ko.crossNumVec2(h,a))+ko.dot(a,ko.sub(ko.addCrossNumVec2(c,m,s),ko.addCrossNumVec2(l,h,i)))},e.prototype.isLimitEnabled=function(){return this.m_enableLimit},e.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.prototype.getLowerLimit=function(){return this.m_lowerTranslation},e.prototype.getUpperLimit=function(){return this.m_upperTranslation},e.prototype.setLimits=function(t,e){t==this.m_lowerTranslation&&e==this.m_upperTranslation||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},e.prototype.isMotorEnabled=function(){return this.m_enableMotor},e.prototype.enableMotor=function(t){t!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t)},e.prototype.setMotorSpeed=function(t){t!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t)},e.prototype.setMaxMotorForce=function(t){t!=this.m_maxMotorForce&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=t)},e.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce},e.prototype.getMotorSpeed=function(){return this.m_motorSpeed},e.prototype.getMotorForce=function(t){return t*this.m_motorImpulse},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return ko.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_impulse.y},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,c=kn.neo(i),h=kn.neo(r),m=kn.mulVec2(c,ko.sub(this.m_localAnchorA,this.m_localCenterA)),u=kn.mulVec2(h,ko.sub(this.m_localAnchorB,this.m_localCenterB)),_=ko.zero();_.addCombine(1,n,1,u),_.subCombine(1,e,1,m);var p=this.m_invMassA,d=this.m_invMassB,y=this.m_invIA,f=this.m_invIB;this.m_axis=kn.mulVec2(c,this.m_localXAxisA),this.m_a1=ko.crossVec2Vec2(ko.add(_,m),this.m_axis),this.m_a2=ko.crossVec2Vec2(u,this.m_axis),this.m_motorMass=p+d+y*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=kn.mulVec2(c,this.m_localYAxisA),this.m_s1=ko.crossVec2Vec2(ko.add(_,m),this.m_perp),this.m_s2=ko.crossVec2Vec2(u,this.m_perp),ko.crossVec2Vec2(m,this.m_perp);var v=p+d+y*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,g=y*this.m_s1+f*this.m_s2,x=y*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2,b=y+f;0==b&&(b=1);var A=y*this.m_a1+f*this.m_a2,B=p+d+y*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2;if(this.m_K.ex.set(v,g,x),this.m_K.ey.set(g,b,A),this.m_K.ez.set(x,A,B),this.m_enableLimit){var w=ko.dot(this.m_axis,_);_c(this.m_upperTranslation-this.m_lowerTranslation)<2*Ro.linearSlop?this.m_limitState=mc.equalLimits:w<=this.m_lowerTranslation?this.m_limitState!=mc.atLowerLimit&&(this.m_limitState=mc.atLowerLimit,this.m_impulse.z=0):w>=this.m_upperTranslation?this.m_limitState!=mc.atUpperLimit&&(this.m_limitState=mc.atUpperLimit,this.m_impulse.z=0):(this.m_limitState=mc.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=mc.inactiveLimit,this.m_impulse.z=0;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var V=ko.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),C=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,S=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;s.subMul(p,V),o-=y*C,a.addMul(d,V),l+=f*S}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=l},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,l=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=mc.equalLimits){var c=ko.dot(this.m_axis,ko.sub(s,e))+this.m_a2*o-this.m_a1*i,h=this.m_motorMass*(this.m_motorSpeed-c),m=this.m_motorImpulse,u=t.dt*this.m_maxMotorForce;this.m_motorImpulse=Po(this.m_motorImpulse+h,-u,u),h=this.m_motorImpulse-m;var _=ko.mulNumVec2(h,this.m_axis),p=h*this.m_a1,d=h*this.m_a2;e.subMul(n,_),i-=a*p,s.addMul(r,_),o+=l*d}var y=ko.zero();if(y.x+=ko.dot(this.m_perp,s)+this.m_s2*o,y.x-=ko.dot(this.m_perp,e)+this.m_s1*i,y.y=o-i,this.m_enableLimit&&this.m_limitState!=mc.inactiveLimit){var f=0;f+=ko.dot(this.m_axis,s)+this.m_a2*o,f-=ko.dot(this.m_axis,e)+this.m_a1*i,c=new Il(y.x,y.y,f);var v=Il.clone(this.m_impulse),g=this.m_K.solve33(Il.neg(c));this.m_impulse.add(g),this.m_limitState==mc.atLowerLimit?this.m_impulse.z=pc(this.m_impulse.z,0):this.m_limitState==mc.atUpperLimit&&(this.m_impulse.z=dc(this.m_impulse.z,0));var x=ko.combine(-1,y,-(this.m_impulse.z-v.z),ko.neo(this.m_K.ez.x,this.m_K.ez.y)),b=ko.add(this.m_K.solve22(x),ko.neo(v.x,v.y));this.m_impulse.x=b.x,this.m_impulse.y=b.y,g=Il.sub(this.m_impulse,v),_=ko.combine(g.x,this.m_perp,g.z,this.m_axis),p=g.x*this.m_s1+g.y+g.z*this.m_a1,d=g.x*this.m_s2+g.y+g.z*this.m_a2,e.subMul(n,_),i-=a*p,s.addMul(r,_),o+=l*d}else g=this.m_K.solve22(ko.neg(y)),this.m_impulse.x+=g.x,this.m_impulse.y+=g.y,_=ko.mulNumVec2(g.x,this.m_perp),p=g.x*this.m_s1+g.y,d=g.x*this.m_s2+g.y,e.subMul(n,_),i-=a*p,s.addMul(r,_),o+=l*d;this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=kn.neo(i),r=kn.neo(o),a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,m=kn.mulVec2(n,ko.sub(this.m_localAnchorA,this.m_localCenterA)),u=kn.mulVec2(r,ko.sub(this.m_localAnchorB,this.m_localCenterB)),_=ko.sub(ko.add(s,u),ko.add(e,m)),p=kn.mulVec2(n,this.m_localXAxisA),d=ko.crossVec2Vec2(ko.add(_,m),p),y=ko.crossVec2Vec2(u,p),f=kn.mulVec2(n,this.m_localYAxisA),v=ko.crossVec2Vec2(ko.add(_,m),f),g=ko.crossVec2Vec2(u,f),x=new Il,b=ko.zero();b.x=ko.dot(f,_),b.y=o-i-this.m_referenceAngle;var A=_c(b.x),B=_c(b.y),w=Ro.linearSlop,V=Ro.maxLinearCorrection,C=!1,S=0;if(this.m_enableLimit){var M=ko.dot(p,_);_c(this.m_upperTranslation-this.m_lowerTranslation)<2*w?(S=Po(M,-V,V),A=pc(A,_c(M)),C=!0):M<=this.m_lowerTranslation?(S=Po(M-this.m_lowerTranslation+w,-V,0),A=Math.max(A,this.m_lowerTranslation-M),C=!0):M>=this.m_upperTranslation&&(S=Po(M-this.m_upperTranslation-w,0,V),A=Math.max(A,M-this.m_upperTranslation),C=!0)}if(C){var P=a+l+c*v*v+h*g*g,z=c*v+h*g,I=c*v*d+h*g*y;0==(k=c+h)&&(k=1);var F=c*d+h*y,T=a+l+c*d*d+h*y*y;(q=new cc).ex.set(P,z,I),q.ey.set(z,k,F),q.ez.set(I,F,T);var L=new Il;L.x=b.x,L.y=b.y,L.z=S,x=q.solve33(Il.neg(L))}else{var k,q;P=a+l+c*v*v+h*g*g,z=c*v+h*g,0==(k=c+h)&&(k=1),(q=new Ca).ex.setNum(P,z),q.ey.setNum(z,k);var N=q.solve(ko.neg(b));x.x=N.x,x.y=N.y,x.z=0}var D=ko.combine(x.x,f,x.z,p),O=x.x*v+x.y+x.z*d,j=x.x*g+x.y+x.z*y;return e.subMul(a,D),i-=c*O,s.addMul(l,D),o+=h*j,this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=s,this.m_bodyB.c_position.a=o,A<=Ro.linearSlop&&B<=Ro.angularSlop},e.TYPE="prismatic-joint",e}(hr),gc={ratio:1},xc=function(t){function e(i,s,o,n,r,a){var l,c,h=this;if(!(h instanceof e))return new e(i,s,o,n,r,a);i=wo(i,gc),s=(h=t.call(this,i,s,o)||this).m_bodyA,o=h.m_bodyB,h.m_type=e.TYPE,h.m_joint1=n||i.joint1,h.m_joint2=r||i.joint2,h.m_ratio=Number.isFinite(a)?a:i.ratio,h.m_type1=h.m_joint1.getType(),h.m_type2=h.m_joint2.getType(),h.m_bodyC=h.m_joint1.getBodyA(),h.m_bodyA=h.m_joint1.getBodyB();var m=h.m_bodyA.m_xf,u=h.m_bodyA.m_sweep.a,_=h.m_bodyC.m_xf,p=h.m_bodyC.m_sweep.a;if(h.m_type1===uc.TYPE){var d=h.m_joint1;h.m_localAnchorC=d.m_localAnchorA,h.m_localAnchorA=d.m_localAnchorB,h.m_referenceAngleA=d.m_referenceAngle,h.m_localAxisC=ko.zero(),l=u-p-h.m_referenceAngleA}else{var y=h.m_joint1;h.m_localAnchorC=y.m_localAnchorA,h.m_localAnchorA=y.m_localAnchorB,h.m_referenceAngleA=y.m_referenceAngle,h.m_localAxisC=y.m_localXAxisA;var f=h.m_localAnchorC,v=kn.mulTVec2(_.q,ko.add(kn.mulVec2(m.q,h.m_localAnchorA),ko.sub(m.p,_.p)));l=ko.dot(v,h.m_localAxisC)-ko.dot(f,h.m_localAxisC)}h.m_bodyD=h.m_joint2.getBodyA(),h.m_bodyB=h.m_joint2.getBodyB();var g=h.m_bodyB.m_xf,x=h.m_bodyB.m_sweep.a,b=h.m_bodyD.m_xf,A=h.m_bodyD.m_sweep.a;if(h.m_type2===uc.TYPE)d=h.m_joint2,h.m_localAnchorD=d.m_localAnchorA,h.m_localAnchorB=d.m_localAnchorB,h.m_referenceAngleB=d.m_referenceAngle,h.m_localAxisD=ko.zero(),c=x-A-h.m_referenceAngleB;else{y=h.m_joint2,h.m_localAnchorD=y.m_localAnchorA,h.m_localAnchorB=y.m_localAnchorB,h.m_referenceAngleB=y.m_referenceAngle,h.m_localAxisD=y.m_localXAxisA;var B=h.m_localAnchorD,w=kn.mulTVec2(b.q,ko.add(kn.mulVec2(g.q,h.m_localAnchorB),ko.sub(g.p,b.p)));c=ko.dot(w,h.m_localAxisD)-ko.dot(B,h.m_localAxisD)}return h.m_constant=l+h.m_ratio*c,h.m_impulse=0,h}return Ao(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}},e._deserialize=function(t,i,s){return(t=Bo({},t)).bodyA=s(lr,t.bodyA,i),t.bodyB=s(lr,t.bodyB,i),t.joint1=s(hr,t.joint1,i),t.joint2=s(hr,t.joint2,i),new e(t)},e.prototype._reset=function(t){Number.isFinite(t.ratio)&&(this.m_ratio=t.ratio)},e.prototype.getJoint1=function(){return this.m_joint1},e.prototype.getJoint2=function(){return this.m_joint2},e.prototype.setRatio=function(t){this.m_ratio=t},e.prototype.getRatio=function(){return this.m_ratio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return ko.mulNumVec2(this.m_impulse,this.m_JvAC).mul(t)},e.prototype.getReactionTorque=function(t){return t*(this.m_impulse*this.m_JwA)},e.prototype.initVelocityConstraints=function(t){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=this.m_bodyC.c_position.a,l=this.m_bodyC.c_velocity.v,c=this.m_bodyC.c_velocity.w,h=this.m_bodyD.c_position.a,m=this.m_bodyD.c_velocity.v,u=this.m_bodyD.c_velocity.w,_=kn.neo(e),p=kn.neo(o),d=kn.neo(a),y=kn.neo(h);if(this.m_mass=0,this.m_type1==uc.TYPE)this.m_JvAC=ko.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var f=kn.mulVec2(d,this.m_localAxisC),v=kn.mulSub(d,this.m_localAnchorC,this.m_lcC),g=kn.mulSub(_,this.m_localAnchorA,this.m_lcA);this.m_JvAC=f,this.m_JwC=ko.crossVec2Vec2(v,f),this.m_JwA=ko.crossVec2Vec2(g,f),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==uc.TYPE)this.m_JvBD=ko.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{f=kn.mulVec2(y,this.m_localAxisD);var x=kn.mulSub(y,this.m_localAnchorD,this.m_lcD),b=kn.mulSub(p,this.m_localAnchorB,this.m_lcB);this.m_JvBD=ko.mulNumVec2(this.m_ratio,f),this.m_JwD=this.m_ratio*ko.crossVec2Vec2(x,f),this.m_JwB=this.m_ratio*ko.crossVec2Vec2(b,f),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.warmStarting?(i.addMul(this.m_mA*this.m_impulse,this.m_JvAC),s+=this.m_iA*this.m_impulse*this.m_JwA,n.addMul(this.m_mB*this.m_impulse,this.m_JvBD),r+=this.m_iB*this.m_impulse*this.m_JwB,l.subMul(this.m_mC*this.m_impulse,this.m_JvAC),c-=this.m_iC*this.m_impulse*this.m_JwC,m.subMul(this.m_mD*this.m_impulse,this.m_JvBD),u-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.setVec2(i),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(n),this.m_bodyB.c_velocity.w=r,this.m_bodyC.c_velocity.v.setVec2(l),this.m_bodyC.c_velocity.w=c,this.m_bodyD.c_velocity.v.setVec2(m),this.m_bodyD.c_velocity.w=u},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_bodyC.c_velocity.v,r=this.m_bodyC.c_velocity.w,a=this.m_bodyD.c_velocity.v,l=this.m_bodyD.c_velocity.w,c=ko.dot(this.m_JvAC,e)-ko.dot(this.m_JvAC,n)+ko.dot(this.m_JvBD,s)-ko.dot(this.m_JvBD,a);c+=this.m_JwA*i-this.m_JwC*r+(this.m_JwB*o-this.m_JwD*l);var h=-this.m_mass*c;this.m_impulse+=h,e.addMul(this.m_mA*h,this.m_JvAC),i+=this.m_iA*h*this.m_JwA,s.addMul(this.m_mB*h,this.m_JvBD),o+=this.m_iB*h*this.m_JwB,n.subMul(this.m_mC*h,this.m_JvAC),r-=this.m_iC*h*this.m_JwC,a.subMul(this.m_mD*h,this.m_JvBD),l-=this.m_iD*h*this.m_JwD,this.m_bodyA.c_velocity.v.setVec2(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.setVec2(s),this.m_bodyB.c_velocity.w=o,this.m_bodyC.c_velocity.v.setVec2(n),this.m_bodyC.c_velocity.w=r,this.m_bodyD.c_velocity.v.setVec2(a),this.m_bodyD.c_velocity.w=l},e.prototype.solvePositionConstraints=function(t){var e,i,s,o,n,r,a,l,c=this.m_bodyA.c_position.c,h=this.m_bodyA.c_position.a,m=this.m_bodyB.c_position.c,u=this.m_bodyB.c_position.a,_=this.m_bodyC.c_position.c,p=this.m_bodyC.c_position.a,d=this.m_bodyD.c_position.c,y=this.m_bodyD.c_position.a,f=kn.neo(h),v=kn.neo(u),g=kn.neo(p),x=kn.neo(y),b=0;if(this.m_type1==uc.TYPE)s=ko.zero(),n=1,a=1,b+=this.m_iA+this.m_iC,e=h-p-this.m_referenceAngleA;else{var A=kn.mulVec2(g,this.m_localAxisC),B=kn.mulSub(g,this.m_localAnchorC,this.m_lcC),w=kn.mulSub(f,this.m_localAnchorA,this.m_lcA);s=A,a=ko.crossVec2Vec2(B,A),n=ko.crossVec2Vec2(w,A),b+=this.m_mC+this.m_mA+this.m_iC*a*a+this.m_iA*n*n;var V=ko.sub(this.m_localAnchorC,this.m_lcC),C=kn.mulTVec2(g,ko.add(w,ko.sub(c,_)));e=ko.dot(ko.sub(C,V),this.m_localAxisC)}if(this.m_type2==uc.TYPE)o=ko.zero(),r=this.m_ratio,l=this.m_ratio,b+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),i=u-y-this.m_referenceAngleB;else{A=kn.mulVec2(x,this.m_localAxisD);var S=kn.mulSub(x,this.m_localAnchorD,this.m_lcD),M=kn.mulSub(v,this.m_localAnchorB,this.m_lcB);o=ko.mulNumVec2(this.m_ratio,A),l=this.m_ratio*ko.crossVec2Vec2(S,A),r=this.m_ratio*ko.crossVec2Vec2(M,A),b+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*l*l+this.m_iB*r*r;var P=ko.sub(this.m_localAnchorD,this.m_lcD),z=kn.mulTVec2(x,ko.add(M,ko.sub(m,d)));i=ko.dot(z,this.m_localAxisD)-ko.dot(P,this.m_localAxisD)}var I=e+this.m_ratio*i-this.m_constant,F=0;return b>0&&(F=-I/b),c.addMul(this.m_mA*F,s),h+=this.m_iA*F*n,m.addMul(this.m_mB*F,o),u+=this.m_iB*F*r,_.subMul(this.m_mC*F,s),p-=this.m_iC*F*a,d.subMul(this.m_mD*F,o),y-=this.m_iD*F*l,this.m_bodyA.c_position.c.setVec2(c),this.m_bodyA.c_position.a=h,this.m_bodyB.c_position.c.setVec2(m),this.m_bodyB.c_position.a=u,this.m_bodyC.c_position.c.setVec2(_),this.m_bodyC.c_position.a=p,this.m_bodyD.c_position.c.setVec2(d),this.m_bodyD.c_position.a=y,0<Ro.linearSlop},e.TYPE="gear-joint",e}(hr),bc={maxForce:1,maxTorque:1,correctionFactor:.3},Ac=function(t){function e(i,s,o){var n=this;return n instanceof e?(i=wo(i,bc),s=(n=t.call(this,i,s,o)||this).m_bodyA,o=n.m_bodyB,n.m_type=e.TYPE,n.m_linearOffset=ko.isValid(i.linearOffset)?ko.clone(i.linearOffset):s.getLocalPoint(o.getPosition()),n.m_angularOffset=Number.isFinite(i.angularOffset)?i.angularOffset:o.getAngle()-s.getAngle(),n.m_linearImpulse=ko.zero(),n.m_angularImpulse=0,n.m_maxForce=i.maxForce,n.m_maxTorque=i.maxTorque,n.m_correctionFactor=i.correctionFactor,n):new e(i,s,o)}return Ao(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}},e._deserialize=function(t,i,s){return(t=Bo({},t)).bodyA=s(lr,t.bodyA,i),t.bodyB=s(lr,t.bodyB,i),new e(t)},e.prototype._reset=function(t){Number.isFinite(t.angularOffset)&&(this.m_angularOffset=t.angularOffset),Number.isFinite(t.maxForce)&&(this.m_maxForce=t.maxForce),Number.isFinite(t.maxTorque)&&(this.m_maxTorque=t.maxTorque),Number.isFinite(t.correctionFactor)&&(this.m_correctionFactor=t.correctionFactor),ko.isValid(t.linearOffset)&&this.m_linearOffset.set(t.linearOffset)},e.prototype.setMaxForce=function(t){this.m_maxForce=t},e.prototype.getMaxForce=function(){return this.m_maxForce},e.prototype.setMaxTorque=function(t){this.m_maxTorque=t},e.prototype.getMaxTorque=function(){return this.m_maxTorque},e.prototype.setCorrectionFactor=function(t){this.m_correctionFactor=t},e.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},e.prototype.setLinearOffset=function(t){t.x==this.m_linearOffset.x&&t.y==this.m_linearOffset.y||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset.set(t))},e.prototype.getLinearOffset=function(){return this.m_linearOffset},e.prototype.setAngularOffset=function(t){t!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=t)},e.prototype.getAngularOffset=function(){return this.m_angularOffset},e.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},e.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},e.prototype.getReactionForce=function(t){return ko.mulNumVec2(t,this.m_linearImpulse)},e.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,c=kn.neo(i),h=kn.neo(r);this.m_rA=kn.mulVec2(c,ko.sub(this.m_linearOffset,this.m_localCenterA)),this.m_rB=kn.mulVec2(h,ko.neg(this.m_localCenterB));var m=this.m_invMassA,u=this.m_invMassB,_=this.m_invIA,p=this.m_invIB,d=new Ca;if(d.ex.x=m+u+_*this.m_rA.y*this.m_rA.y+p*this.m_rB.y*this.m_rB.y,d.ex.y=-_*this.m_rA.x*this.m_rA.y-p*this.m_rB.x*this.m_rB.y,d.ey.x=d.ex.y,d.ey.y=m+u+_*this.m_rA.x*this.m_rA.x+p*this.m_rB.x*this.m_rB.x,this.m_linearMass=d.getInverse(),this.m_angularMass=_+p,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=ko.zero(),this.m_linearError.addCombine(1,n,1,this.m_rB),this.m_linearError.subCombine(1,e,1,this.m_rA),this.m_angularError=r-i-this.m_angularOffset,t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var y=ko.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);s.subMul(m,y),o-=_*(ko.crossVec2Vec2(this.m_rA,y)+this.m_angularImpulse),a.addMul(u,y),l+=p*(ko.crossVec2Vec2(this.m_rB,y)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=l},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,l=this.m_invIB,c=t.dt,h=t.inv_dt,m=o-i+h*this.m_correctionFactor*this.m_angularError,u=-this.m_angularMass*m,_=this.m_angularImpulse,p=c*this.m_maxTorque;this.m_angularImpulse=Po(this.m_angularImpulse+u,-p,p),i-=a*(u=this.m_angularImpulse-_),o+=l*u,(m=ko.zero()).addCombine(1,s,1,ko.crossNumVec2(o,this.m_rB)),m.subCombine(1,e,1,ko.crossNumVec2(i,this.m_rA)),m.addMul(h*this.m_correctionFactor,this.m_linearError),u=ko.neg(Ca.mulVec2(this.m_linearMass,m)),_=ko.clone(this.m_linearImpulse),this.m_linearImpulse.add(u),p=c*this.m_maxForce,this.m_linearImpulse.clamp(p),u=ko.sub(this.m_linearImpulse,_),e.subMul(n,u),i-=a*ko.crossVec2Vec2(this.m_rA,u),s.addMul(r,u),o+=l*ko.crossVec2Vec2(this.m_rB,u),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){return!0},e.TYPE="motor-joint",e}(hr),Bc=Math.PI,wc={maxForce:0,frequencyHz:5,dampingRatio:.7},Vc=function(t){function e(i,s,o,n){var r=this;return r instanceof e?(i=wo(i,wc),s=(r=t.call(this,i,s,o)||this).m_bodyA,o=r.m_bodyB,r.m_type=e.TYPE,ko.isValid(n)?r.m_targetA=ko.clone(n):ko.isValid(i.target)?r.m_targetA=ko.clone(i.target):r.m_targetA=ko.zero(),r.m_localAnchorB=jn.mulTVec2(o.getTransform(),r.m_targetA),r.m_maxForce=i.maxForce,r.m_impulse=ko.zero(),r.m_frequencyHz=i.frequencyHz,r.m_dampingRatio=i.dampingRatio,r.m_beta=0,r.m_gamma=0,r.m_rB=ko.zero(),r.m_localCenterB=ko.zero(),r.m_invMassB=0,r.m_invIB=0,r.m_mass=new Ca,r.m_C=ko.zero(),r):new e(i,s,o,n)}return Ao(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}},e._deserialize=function(t,i,s){(t=Bo({},t)).bodyA=s(lr,t.bodyA,i),t.bodyB=s(lr,t.bodyB,i),t.target=ko.clone(t.target);var o=new e(t);return t._localAnchorB&&(o.m_localAnchorB=t._localAnchorB),o},e.prototype._reset=function(t){Number.isFinite(t.maxForce)&&(this.m_maxForce=t.maxForce),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.setTarget=function(t){ko.areEqual(t,this.m_targetA)||(this.m_bodyB.setAwake(!0),this.m_targetA.set(t))},e.prototype.getTarget=function(){return this.m_targetA},e.prototype.setMaxForce=function(t){this.m_maxForce=t},e.prototype.getMaxForce=function(){return this.m_maxForce},e.prototype.setFrequency=function(t){this.m_frequencyHz=t},e.prototype.getFrequency=function(){return this.m_frequencyHz},e.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return ko.clone(this.m_targetA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return ko.mulNumVec2(t,this.m_impulse)},e.prototype.getReactionTorque=function(t){return 0*t},e.prototype.shiftOrigin=function(t){this.m_targetA.sub(t)},e.prototype.initVelocityConstraints=function(t){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyB.c_position,i=this.m_bodyB.c_velocity,s=e.c,o=e.a,n=i.v,r=i.w,a=kn.neo(o),l=this.m_bodyB.getMass(),c=2*Bc*this.m_frequencyHz,h=2*l*this.m_dampingRatio*c,m=l*(c*c),u=t.dt;this.m_gamma=u*(h+u*m),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=u*m*this.m_gamma,this.m_rB=kn.mulVec2(a,ko.sub(this.m_localAnchorB,this.m_localCenterB));var _=new Ca;_.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,_.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,_.ey.x=_.ex.y,_.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=_.getInverse(),this.m_C.setVec2(s),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),r*=.98,t.warmStarting?(this.m_impulse.mul(t.dtRatio),n.addMul(this.m_invMassB,this.m_impulse),r+=this.m_invIB*ko.crossVec2Vec2(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),i.v.setVec2(n),i.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyB.c_velocity,i=ko.clone(e.v),s=e.w,o=ko.crossNumVec2(s,this.m_rB);o.add(i),o.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),o.neg();var n=Ca.mulVec2(this.m_mass,o),r=ko.clone(this.m_impulse);this.m_impulse.add(n);var a=t.dt*this.m_maxForce;this.m_impulse.clamp(a),n=ko.sub(this.m_impulse,r),i.addMul(this.m_invMassB,n),s+=this.m_invIB*ko.crossVec2Vec2(this.m_rB,n),e.v.setVec2(i),e.w=s},e.prototype.solvePositionConstraints=function(t){return!0},e.TYPE="mouse-joint",e}(hr),Cc=Math.abs,Sc={collideConnected:!0},Mc=function(t){function e(i,s,o,n,r,a,l,c){var h=this;return h instanceof e?(i=wo(i,Sc),s=(h=t.call(this,i,s,o)||this).m_bodyA,o=h.m_bodyB,h.m_type=e.TYPE,h.m_groundAnchorA=ko.clone(n||i.groundAnchorA||ko.neo(-1,1)),h.m_groundAnchorB=ko.clone(r||i.groundAnchorB||ko.neo(1,1)),h.m_localAnchorA=ko.clone(a?s.getLocalPoint(a):i.localAnchorA||ko.neo(-1,0)),h.m_localAnchorB=ko.clone(l?o.getLocalPoint(l):i.localAnchorB||ko.neo(1,0)),h.m_lengthA=Number.isFinite(i.lengthA)?i.lengthA:ko.distance(a,n),h.m_lengthB=Number.isFinite(i.lengthB)?i.lengthB:ko.distance(l,r),h.m_ratio=Number.isFinite(c)?c:i.ratio,h.m_constant=h.m_lengthA+h.m_ratio*h.m_lengthB,h.m_impulse=0,h):new e(i,s,o,n,r,a,l,c)}return Ao(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}},e._deserialize=function(t,i,s){return(t=Bo({},t)).bodyA=s(lr,t.bodyA,i),t.bodyB=s(lr,t.bodyB,i),new e(t)},e.prototype._reset=function(t){ko.isValid(t.groundAnchorA)&&this.m_groundAnchorA.set(t.groundAnchorA),ko.isValid(t.groundAnchorB)&&this.m_groundAnchorB.set(t.groundAnchorB),ko.isValid(t.localAnchorA)?this.m_localAnchorA.set(t.localAnchorA):ko.isValid(t.anchorA)&&this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)),ko.isValid(t.localAnchorB)?this.m_localAnchorB.set(t.localAnchorB):ko.isValid(t.anchorB)&&this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)),Number.isFinite(t.lengthA)&&(this.m_lengthA=t.lengthA),Number.isFinite(t.lengthB)&&(this.m_lengthB=t.lengthB),Number.isFinite(t.ratio)&&(this.m_ratio=t.ratio)},e.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},e.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},e.prototype.getLengthA=function(){return this.m_lengthA},e.prototype.getLengthB=function(){return this.m_lengthB},e.prototype.getRatio=function(){return this.m_ratio},e.prototype.getCurrentLengthA=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_groundAnchorA;return ko.distance(t,e)},e.prototype.getCurrentLengthB=function(){var t=this.m_bodyB.getWorldPoint(this.m_localAnchorB),e=this.m_groundAnchorB;return ko.distance(t,e)},e.prototype.shiftOrigin=function(t){this.m_groundAnchorA.sub(t),this.m_groundAnchorB.sub(t)},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return ko.mulNumVec2(this.m_impulse,this.m_uB).mul(t)},e.prototype.getReactionTorque=function(t){return 0},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,c=kn.neo(i),h=kn.neo(r);this.m_rA=kn.mulVec2(c,ko.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=kn.mulVec2(h,ko.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=ko.sub(ko.add(e,this.m_rA),this.m_groundAnchorA),this.m_uB=ko.sub(ko.add(n,this.m_rB),this.m_groundAnchorB);var m=this.m_uA.length(),u=this.m_uB.length();m>10*Ro.linearSlop?this.m_uA.mul(1/m):this.m_uA.setZero(),u>10*Ro.linearSlop?this.m_uB.mul(1/u):this.m_uB.setZero();var _=ko.crossVec2Vec2(this.m_rA,this.m_uA),p=ko.crossVec2Vec2(this.m_rB,this.m_uB),d=this.m_invMassA+this.m_invIA*_*_,y=this.m_invMassB+this.m_invIB*p*p;if(this.m_mass=d+this.m_ratio*this.m_ratio*y,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.warmStarting){this.m_impulse*=t.dtRatio;var f=ko.mulNumVec2(-this.m_impulse,this.m_uA),v=ko.mulNumVec2(-this.m_ratio*this.m_impulse,this.m_uB);s.addMul(this.m_invMassA,f),o+=this.m_invIA*ko.crossVec2Vec2(this.m_rA,f),a.addMul(this.m_invMassB,v),l+=this.m_invIB*ko.crossVec2Vec2(this.m_rB,v)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=l},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=ko.add(e,ko.crossNumVec2(i,this.m_rA)),r=ko.add(s,ko.crossNumVec2(o,this.m_rB)),a=-ko.dot(this.m_uA,n)-this.m_ratio*ko.dot(this.m_uB,r),l=-this.m_mass*a;this.m_impulse+=l;var c=ko.mulNumVec2(-l,this.m_uA),h=ko.mulNumVec2(-this.m_ratio*l,this.m_uB);e.addMul(this.m_invMassA,c),i+=this.m_invIA*ko.crossVec2Vec2(this.m_rA,c),s.addMul(this.m_invMassB,h),o+=this.m_invIB*ko.crossVec2Vec2(this.m_rB,h),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=kn.neo(i),r=kn.neo(o),a=kn.mulVec2(n,ko.sub(this.m_localAnchorA,this.m_localCenterA)),l=kn.mulVec2(r,ko.sub(this.m_localAnchorB,this.m_localCenterB)),c=ko.sub(ko.add(e,this.m_rA),this.m_groundAnchorA),h=ko.sub(ko.add(s,this.m_rB),this.m_groundAnchorB),m=c.length(),u=h.length();m>10*Ro.linearSlop?c.mul(1/m):c.setZero(),u>10*Ro.linearSlop?h.mul(1/u):h.setZero();var _=ko.crossVec2Vec2(a,c),p=ko.crossVec2Vec2(l,h),d=this.m_invMassA+this.m_invIA*_*_,y=this.m_invMassB+this.m_invIB*p*p,f=d+this.m_ratio*this.m_ratio*y;f>0&&(f=1/f);var v=this.m_constant-m-this.m_ratio*u,g=Cc(v),x=-f*v,b=ko.mulNumVec2(-x,c),A=ko.mulNumVec2(-this.m_ratio*x,h);return e.addMul(this.m_invMassA,b),i+=this.m_invIA*ko.crossVec2Vec2(a,b),s.addMul(this.m_invMassB,A),o+=this.m_invIB*ko.crossVec2Vec2(l,A),this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=s,this.m_bodyB.c_position.a=o,g<Ro.linearSlop},e.TYPE="pulley-joint",e}(hr),Pc=Math.min;!function(t){t[t.inactiveLimit=0]="inactiveLimit",t[t.atLowerLimit=1]="atLowerLimit",t[t.atUpperLimit=2]="atUpperLimit",t[t.equalLimits=3]="equalLimits"}(yc||(yc={}));var zc={maxLength:0},Ic=function(t){function e(i,s,o,n){var r=this;return r instanceof e?(i=wo(i,zc),s=(r=t.call(this,i,s,o)||this).m_bodyA,o=r.m_bodyB,r.m_type=e.TYPE,r.m_localAnchorA=ko.clone(n?s.getLocalPoint(n):i.localAnchorA||ko.neo(-1,0)),r.m_localAnchorB=ko.clone(n?o.getLocalPoint(n):i.localAnchorB||ko.neo(1,0)),r.m_maxLength=i.maxLength,r.m_mass=0,r.m_impulse=0,r.m_length=0,r.m_state=yc.inactiveLimit,r):new e(i,s,o,n)}return Ao(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}},e._deserialize=function(t,i,s){return(t=Bo({},t)).bodyA=s(lr,t.bodyA,i),t.bodyB=s(lr,t.bodyB,i),new e(t)},e.prototype._reset=function(t){Number.isFinite(t.maxLength)&&(this.m_maxLength=t.maxLength)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.setMaxLength=function(t){this.m_maxLength=t},e.prototype.getMaxLength=function(){return this.m_maxLength},e.prototype.getLimitState=function(){return this.m_state},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return ko.mulNumVec2(this.m_impulse,this.m_u).mul(t)},e.prototype.getReactionTorque=function(t){return 0},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,c=kn.neo(i),h=kn.neo(r);this.m_rA=kn.mulSub(c,this.m_localAnchorA,this.m_localCenterA),this.m_rB=kn.mulSub(h,this.m_localAnchorB,this.m_localCenterB),this.m_u=ko.zero(),this.m_u.addCombine(1,n,1,this.m_rB),this.m_u.subCombine(1,e,1,this.m_rA),this.m_length=this.m_u.length();var m=this.m_length-this.m_maxLength;if(this.m_state=m>0?yc.atUpperLimit:yc.inactiveLimit,!(this.m_length>Ro.linearSlop))return this.m_u.setZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.mul(1/this.m_length);var u=ko.crossVec2Vec2(this.m_rA,this.m_u),_=ko.crossVec2Vec2(this.m_rB,this.m_u),p=this.m_invMassA+this.m_invIA*u*u+this.m_invMassB+this.m_invIB*_*_;if(this.m_mass=0!=p?1/p:0,t.warmStarting){this.m_impulse*=t.dtRatio;var d=ko.mulNumVec2(this.m_impulse,this.m_u);s.subMul(this.m_invMassA,d),o-=this.m_invIA*ko.crossVec2Vec2(this.m_rA,d),a.addMul(this.m_invMassB,d),l+=this.m_invIB*ko.crossVec2Vec2(this.m_rB,d)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=l},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=ko.addCrossNumVec2(e,i,this.m_rA),r=ko.addCrossNumVec2(s,o,this.m_rB),a=this.m_length-this.m_maxLength,l=ko.dot(this.m_u,ko.sub(r,n));a<0&&(l+=t.inv_dt*a);var c=-this.m_mass*l,h=this.m_impulse;this.m_impulse=Pc(0,this.m_impulse+c),c=this.m_impulse-h;var m=ko.mulNumVec2(c,this.m_u);e.subMul(this.m_invMassA,m),i-=this.m_invIA*ko.crossVec2Vec2(this.m_rA,m),s.addMul(this.m_invMassB,m),o+=this.m_invIB*ko.crossVec2Vec2(this.m_rB,m),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=kn.neo(i),r=kn.neo(o),a=kn.mulSub(n,this.m_localAnchorA,this.m_localCenterA),l=kn.mulSub(r,this.m_localAnchorB,this.m_localCenterB),c=ko.zero();c.addCombine(1,s,1,l),c.subCombine(1,e,1,a);var h=c.normalize(),m=h-this.m_maxLength;m=Po(m,0,Ro.maxLinearCorrection);var u=-this.m_mass*m,_=ko.mulNumVec2(u,c);return e.subMul(this.m_invMassA,_),i-=this.m_invIA*ko.crossVec2Vec2(a,_),s.addMul(this.m_invMassB,_),o+=this.m_invIB*ko.crossVec2Vec2(l,_),this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(s),this.m_bodyB.c_position.a=o,h-this.m_maxLength<Ro.linearSlop},e.TYPE="rope-joint",e}(hr),Fc=Math.abs,Tc=Math.PI,Lc={frequencyHz:0,dampingRatio:0},kc=function(t){function e(i,s,o,n){var r=this;return r instanceof e?(i=wo(i,Lc),s=(r=t.call(this,i,s,o)||this).m_bodyA,o=r.m_bodyB,r.m_type=e.TYPE,r.m_localAnchorA=ko.clone(n?s.getLocalPoint(n):i.localAnchorA||ko.zero()),r.m_localAnchorB=ko.clone(n?o.getLocalPoint(n):i.localAnchorB||ko.zero()),r.m_referenceAngle=Number.isFinite(i.referenceAngle)?i.referenceAngle:o.getAngle()-s.getAngle(),r.m_frequencyHz=i.frequencyHz,r.m_dampingRatio=i.dampingRatio,r.m_impulse=new Il,r.m_bias=0,r.m_gamma=0,r.m_rA,r.m_rB,r.m_localCenterA,r.m_localCenterB,r.m_invMassA,r.m_invMassB,r.m_invIA,r.m_invIB,r.m_mass=new cc,r):new e(i,s,o,n)}return Ao(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},e._deserialize=function(t,i,s){return(t=Bo({},t)).bodyA=s(lr,t.bodyA,i),t.bodyB=s(lr,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getReferenceAngle=function(){return this.m_referenceAngle},e.prototype.setFrequency=function(t){this.m_frequencyHz=t},e.prototype.getFrequency=function(){return this.m_frequencyHz},e.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return ko.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=kn.neo(e),l=kn.neo(o);this.m_rA=kn.mulVec2(a,ko.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=kn.mulVec2(l,ko.sub(this.m_localAnchorB,this.m_localCenterB));var c=this.m_invMassA,h=this.m_invMassB,m=this.m_invIA,u=this.m_invIB,_=new cc;if(_.ex.x=c+h+this.m_rA.y*this.m_rA.y*m+this.m_rB.y*this.m_rB.y*u,_.ey.x=-this.m_rA.y*this.m_rA.x*m-this.m_rB.y*this.m_rB.x*u,_.ez.x=-this.m_rA.y*m-this.m_rB.y*u,_.ex.y=_.ey.x,_.ey.y=c+h+this.m_rA.x*this.m_rA.x*m+this.m_rB.x*this.m_rB.x*u,_.ez.y=this.m_rA.x*m+this.m_rB.x*u,_.ex.z=_.ez.x,_.ey.z=_.ez.y,_.ez.z=m+u,this.m_frequencyHz>0){_.getInverse22(this.m_mass);var p=m+u,d=p>0?1/p:0,y=o-e-this.m_referenceAngle,f=2*Tc*this.m_frequencyHz,v=2*d*this.m_dampingRatio*f,g=d*f*f,x=t.dt;this.m_gamma=x*(v+x*g),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=y*x*g*this.m_gamma,p+=this.m_gamma,this.m_mass.ez.z=0!=p?1/p:0}else 0==_.ez.z?(_.getInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(_.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(t.warmStarting){this.m_impulse.mul(t.dtRatio);var b=ko.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(c,b),s-=m*(ko.crossVec2Vec2(this.m_rA,b)+this.m_impulse.z),n.addMul(h,b),r+=u*(ko.crossVec2Vec2(this.m_rB,b)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,l=this.m_invIB;if(this.m_frequencyHz>0){var c=o-i,h=-this.m_mass.ez.z*(c+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=h,i-=a*h,o+=l*h,(_=ko.zero()).addCombine(1,s,1,ko.crossNumVec2(o,this.m_rB)),_.subCombine(1,e,1,ko.crossNumVec2(i,this.m_rA));var m=ko.neg(cc.mulVec2(this.m_mass,_));this.m_impulse.x+=m.x,this.m_impulse.y+=m.y;var u=ko.clone(m);e.subMul(n,u),i-=a*ko.crossVec2Vec2(this.m_rA,u),s.addMul(r,u),o+=l*ko.crossVec2Vec2(this.m_rB,u)}else{var _;(_=ko.zero()).addCombine(1,s,1,ko.crossNumVec2(o,this.m_rB)),_.subCombine(1,e,1,ko.crossNumVec2(i,this.m_rA)),c=o-i;var p=new Il(_.x,_.y,c),d=Il.neg(cc.mulVec3(this.m_mass,p));this.m_impulse.add(d),u=ko.neo(d.x,d.y),e.subMul(n,u),i-=a*(ko.crossVec2Vec2(this.m_rA,u)+d.z),s.addMul(r,u),o+=l*(ko.crossVec2Vec2(this.m_rB,u)+d.z)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){var e,i,s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=kn.neo(o),l=kn.neo(r),c=this.m_invMassA,h=this.m_invMassB,m=this.m_invIA,u=this.m_invIB,_=kn.mulVec2(a,ko.sub(this.m_localAnchorA,this.m_localCenterA)),p=kn.mulVec2(l,ko.sub(this.m_localAnchorB,this.m_localCenterB)),d=new cc;if(d.ex.x=c+h+_.y*_.y*m+p.y*p.y*u,d.ey.x=-_.y*_.x*m-p.y*p.x*u,d.ez.x=-_.y*m-p.y*u,d.ex.y=d.ey.x,d.ey.y=c+h+_.x*_.x*m+p.x*p.x*u,d.ez.y=_.x*m+p.x*u,d.ex.z=d.ez.x,d.ey.z=d.ez.y,d.ez.z=m+u,this.m_frequencyHz>0){(f=ko.zero()).addCombine(1,n,1,p),f.subCombine(1,s,1,_),e=f.length(),i=0;var y=ko.neg(d.solve22(f));s.subMul(c,y),o-=m*ko.crossVec2Vec2(_,y),n.addMul(h,y),r+=u*ko.crossVec2Vec2(p,y)}else{var f;(f=ko.zero()).addCombine(1,n,1,p),f.subCombine(1,s,1,_);var v=r-o-this.m_referenceAngle;e=f.length(),i=Fc(v);var g=new Il(f.x,f.y,v),x=new Il;if(d.ez.z>0)x=Il.neg(d.solve33(g));else{var b=ko.neg(d.solve22(f));x.set(b.x,b.y,0)}y=ko.neo(x.x,x.y),s.subMul(c,y),o-=m*(ko.crossVec2Vec2(_,y)+x.z),n.addMul(h,y),r+=u*(ko.crossVec2Vec2(p,y)+x.z)}return this.m_bodyA.c_position.c=s,this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=r,e<=Ro.linearSlop&&i<=Ro.angularSlop},e.TYPE="weld-joint",e}(hr),qc=Math.abs,Nc=Math.PI,Dc={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7},Oc=function(t){function e(i,s,o,n,r){var a=this;return a instanceof e?(i=wo(i,Dc),s=(a=t.call(this,i,s,o)||this).m_bodyA,o=a.m_bodyB,a.m_ax=ko.zero(),a.m_ay=ko.zero(),a.m_type=e.TYPE,a.m_localAnchorA=ko.clone(n?s.getLocalPoint(n):i.localAnchorA||ko.zero()),a.m_localAnchorB=ko.clone(n?o.getLocalPoint(n):i.localAnchorB||ko.zero()),ko.isValid(r)?a.m_localXAxisA=s.getLocalVector(r):ko.isValid(i.localAxisA)?a.m_localXAxisA=ko.clone(i.localAxisA):ko.isValid(i.localAxis)?a.m_localXAxisA=ko.clone(i.localAxis):a.m_localXAxisA=ko.neo(1,0),a.m_localYAxisA=ko.crossNumVec2(1,a.m_localXAxisA),a.m_mass=0,a.m_impulse=0,a.m_motorMass=0,a.m_motorImpulse=0,a.m_springMass=0,a.m_springImpulse=0,a.m_maxMotorTorque=i.maxMotorTorque,a.m_motorSpeed=i.motorSpeed,a.m_enableMotor=i.enableMotor,a.m_frequencyHz=i.frequencyHz,a.m_dampingRatio=i.dampingRatio,a.m_bias=0,a.m_gamma=0,a):new e(i,s,o,n,r)}return Ao(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}},e._deserialize=function(t,i,s){return(t=Bo({},t)).bodyA=s(lr,t.bodyA,i),t.bodyB=s(lr,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.setVec2(t.localAxisA),this.m_localYAxisA.setVec2(ko.crossNumVec2(1,t.localAxisA))),void 0!==t.enableMotor&&(this.m_enableMotor=t.enableMotor),Number.isFinite(t.maxMotorTorque)&&(this.m_maxMotorTorque=t.maxMotorTorque),Number.isFinite(t.motorSpeed)&&(this.m_motorSpeed=t.motorSpeed),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getLocalAxisA=function(){return this.m_localXAxisA},e.prototype.getJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.getWorldPoint(this.m_localAnchorA),s=e.getWorldPoint(this.m_localAnchorB),o=ko.sub(s,i),n=t.getWorldVector(this.m_localXAxisA);return ko.dot(o,n)},e.prototype.getJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},e.prototype.isMotorEnabled=function(){return this.m_enableMotor},e.prototype.enableMotor=function(t){t!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t)},e.prototype.setMotorSpeed=function(t){t!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t)},e.prototype.getMotorSpeed=function(){return this.m_motorSpeed},e.prototype.setMaxMotorTorque=function(t){t!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t)},e.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},e.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},e.prototype.setSpringFrequencyHz=function(t){this.m_frequencyHz=t},e.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},e.prototype.setSpringDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return ko.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_motorImpulse},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,o=this.m_invIB,n=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,a=this.m_bodyA.c_velocity.v,l=this.m_bodyA.c_velocity.w,c=this.m_bodyB.c_position.c,h=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,u=this.m_bodyB.c_velocity.w,_=kn.neo(r),p=kn.neo(h),d=kn.mulVec2(_,ko.sub(this.m_localAnchorA,this.m_localCenterA)),y=kn.mulVec2(p,ko.sub(this.m_localAnchorB,this.m_localCenterB)),f=ko.zero();if(f.addCombine(1,c,1,y),f.subCombine(1,n,1,d),this.m_ay=kn.mulVec2(_,this.m_localYAxisA),this.m_sAy=ko.crossVec2Vec2(ko.add(f,d),this.m_ay),this.m_sBy=ko.crossVec2Vec2(y,this.m_ay),this.m_mass=e+i+s*this.m_sAy*this.m_sAy+o*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=kn.mulVec2(_,this.m_localXAxisA),this.m_sAx=ko.crossVec2Vec2(ko.add(f,d),this.m_ax),this.m_sBx=ko.crossVec2Vec2(y,this.m_ax);var v=e+i+s*this.m_sAx*this.m_sAx+o*this.m_sBx*this.m_sBx;if(v>0){this.m_springMass=1/v;var g=ko.dot(f,this.m_ax),x=2*Nc*this.m_frequencyHz,b=2*this.m_springMass*this.m_dampingRatio*x,A=this.m_springMass*x*x,B=t.dt;this.m_gamma=B*(b+B*A),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=g*B*A*this.m_gamma,this.m_springMass=v+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=s+o,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.warmStarting){this.m_impulse*=t.dtRatio,this.m_springImpulse*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var w=ko.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),V=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,C=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;a.subMul(this.m_invMassA,w),l-=this.m_invIA*V,m.addMul(this.m_invMassB,w),u+=this.m_invIB*C}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(a),this.m_bodyA.c_velocity.w=l,this.m_bodyB.c_velocity.v.setVec2(m),this.m_bodyB.c_velocity.w=u},e.prototype.solveVelocityConstraints=function(t){var e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,o=this.m_invIB,n=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,c=ko.dot(this.m_ax,a)-ko.dot(this.m_ax,n)+this.m_sBx*l-this.m_sAx*r,h=-this.m_springMass*(c+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=h;var m=ko.mulNumVec2(h,this.m_ax),u=h*this.m_sAx,_=h*this.m_sBx;n.subMul(e,m),r-=s*u,a.addMul(i,m),c=(l+=o*_)-r-this.m_motorSpeed,h=-this.m_motorMass*c;var p=this.m_motorImpulse,d=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=Po(this.m_motorImpulse+h,-d,d),r-=s*(h=this.m_motorImpulse-p),l+=o*h,c=ko.dot(this.m_ay,a)-ko.dot(this.m_ay,n)+this.m_sBy*l-this.m_sAy*r,h=-this.m_mass*c,this.m_impulse+=h,m=ko.mulNumVec2(h,this.m_ay),u=h*this.m_sAy,_=h*this.m_sBy,n.subMul(e,m),r-=s*u,a.addMul(i,m),l+=o*_,this.m_bodyA.c_velocity.v.setVec2(n),this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=l},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=kn.neo(i),r=kn.neo(o),a=kn.mulVec2(n,ko.sub(this.m_localAnchorA,this.m_localCenterA)),l=kn.mulVec2(r,ko.sub(this.m_localAnchorB,this.m_localCenterB)),c=ko.zero();c.addCombine(1,s,1,l),c.subCombine(1,e,1,a);var h=kn.mulVec2(n,this.m_localYAxisA),m=ko.crossVec2Vec2(ko.add(c,a),h),u=ko.crossVec2Vec2(l,h),_=ko.dot(c,h),p=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,d=0!=p?-_/p:0,y=ko.mulNumVec2(d,h),f=d*m,v=d*u;return e.subMul(this.m_invMassA,y),i-=this.m_invIA*f,s.addMul(this.m_invMassB,y),o+=this.m_invIB*v,this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(s),this.m_bodyB.c_position.a=o,qc(_)<=Ro.linearSlop},e.TYPE="wheel-joint",e}(hr),jc=0;function Rc(t){var e,i=(t=t||{}).rootClass||zl,s=t.preSerialize||function(t){return t},o=t.postSerialize||function(t,e){return t},n=t.preDeserialize||function(t){return t},r=t.postDeserialize||function(t,e){return t},a={World:zl,Body:lr,Joint:hr,Fixture:$n,Shape:Un},l=Bo({Vec2:ko,Vec3:Il},a),c=((e={})[lr.STATIC]=lr,e[lr.DYNAMIC]=lr,e[lr.KINEMATIC]=lr,e[Dl.TYPE]=Dl,e[Kl.TYPE]=Kl,e[Ll.TYPE]=Ll,e[Gl.TYPE]=Gl,e[ec.TYPE]=ec,e[rc.TYPE]=rc,e[lc.TYPE]=lc,e[xc.TYPE]=xc,e[Ac.TYPE]=Ac,e[Vc.TYPE]=Vc,e[vc.TYPE]=vc,e[Mc.TYPE]=Mc,e[uc.TYPE]=uc,e[Ic.TYPE]=Ic,e[kc.TYPE]=kc,e[Oc.TYPE]=Oc,e);this.toJson=function(t){var e=[],i=[t],n={};function r(t,s){if(t.__sid=t.__sid||++jc,!n[t.__sid]){i.push(t);var o={refIndex:e.length+i.length,refType:s};n[t.__sid]=o}return n[t.__sid]}function l(t,e){if("object"!=typeof t||null===t)return t;if("function"==typeof t._serialize){if(t!==e)for(var i in a)if(t instanceof a[i])return r(t,i);c=(n=s(n=t))._serialize(),t=o(c,n)}var n,c;if(Array.isArray(t)){for(var h=[],m=0;m<t.length;m++)h[m]=l(t[m]);t=h}else{for(var m in h={},t)t.hasOwnProperty(m)&&(h[m]=l(t[m]));t=h}return t}for(;i.length;){var c=i.shift(),h=l(c,c);e.push(h)}return e},this.fromJson=function(t){var e={};function s(t,e,i){var s=function(t,e){return e&&e._deserialize||(e=c[t.type]),e&&e._deserialize}(e,t);if(s){var a=s(e=n(e),i,o);return r(a,e)}}function o(i,o,n){if(!o.refIndex)return i&&i._deserialize&&s(i,o,n);i=l[o.refType]||i;var r=o.refIndex;if(!e[r]){var a=s(i,t[r],n);e[r]=a}return e[r]}return i._deserialize(t[0],null,o)}}var Ec=new Rc;Rc.toJson=Ec.toJson,Rc.fromJson=Ec.fromJson;var Yc=function(){function t(){this.width=80,this.height=60,this.x=0,this.y=-10,this.scaleY=-1,this.hz=60,this.speed=1,this.ratio=16,this.background="#222222",this.activeKeys={},this.step=function(t,e){},this.keydown=function(t,e){},this.keyup=function(t,e){},this.statusText="",this.statusMap={}}return t.mount=function(t){throw new Error("Not implemented")},t.start=function(e){var i=t.mount();return i.start(e),i},t.prototype.status=function(t,e){if(void 0!==e){var i=t,s=e;"function"!=typeof s&&"object"!=typeof s&&(this.statusMap[i]=s)}else if(t&&"object"==typeof t)for(var o in t){var n=t[o];"function"!=typeof n&&"object"!=typeof n&&(this.statusMap[o]=n)}else"string"==typeof t&&(this.statusText=t);var r=this.statusText||"";for(var a in this.statusMap){var l=this.statusMap[a];"function"!=typeof l&&(r+=(r&&"\n")+a+": "+l)}this._status(r)},t.prototype.info=function(t){this._info(t)},t.prototype.color=function(t,e,i){return"rgb("+(t=256*t|0)+", "+(e=256*e|0)+", "+(i=256*i|0)+")"},t}();Ml.addType(ec.TYPE,ec.TYPE,(function(t,e,i,s,o,n,r){Uc(t,i.getShape(),e,n.getShape(),o)}));var Jc=en(0,0),Wc=en(0,0),Uc=function(t,e,i,s,o){t.pointCount=0,Mn(Jc,i,e.m_p),Mn(Wc,o,s.m_p);var n=Bn(Wc,Jc),r=e.m_radius+s.m_radius;n>r*r||(t.type=xa.e_circles,on(t.localPoint,e.m_p),nn(t.localNormal),t.pointCount=1,on(t.points[0].localPoint,s.m_p),t.points[0].id.setFeatures(0,Aa.e_vertex,0,Aa.e_vertex))};Ml.addType(Ll.TYPE,ec.TYPE,(function(t,e,i,s,o,n,r){var a=i.getShape(),l=n.getShape();Qc(t,a,e,l,o)})),Ml.addType(Dl.TYPE,ec.TYPE,(function(t,e,i,s,o,n,r){var a=i.getShape(),l=new Ll;a.getChildEdge(l,s);var c=l,h=n.getShape();Qc(t,c,e,h,o)}));var Hc=en(0,0),Gc=en(0,0),Xc=en(0,0),Kc=en(0,0),Zc=en(0,0),$c=en(0,0),Qc=function(t,e,i,s,o){t.pointCount=0,zn(Kc,o,i,s.m_p);var n=e.m_vertex1,r=e.m_vertex2;cn(Hc,r,n);var a=xn(Hc,r)-xn(Hc,Kc),l=xn(Hc,Kc)-xn(Hc,n),c=e.m_radius+s.m_radius;if(l<=0){if(on(Zc,n),Bn(Kc,n)>c*c)return;if(e.m_hasVertex0){var h=e.m_vertex0,m=n;if(cn(Gc,m,h),xn(Gc,m)-xn(Gc,Kc)>0)return}return t.type=xa.e_circles,nn(t.localNormal),on(t.localPoint,Zc),t.pointCount=1,on(t.points[0].localPoint,s.m_p),void t.points[0].id.setFeatures(0,Aa.e_vertex,0,Aa.e_vertex)}if(a<=0){if(on(Zc,r),Bn(Kc,Zc)>c*c)return;if(e.m_hasVertex3){var u=e.m_vertex3,_=r;if(cn(Xc,u,_),xn(Xc,Kc)-xn(Xc,_)>0)return}return t.type=xa.e_circles,nn(t.localNormal),on(t.localPoint,Zc),t.pointCount=1,on(t.points[0].localPoint,s.m_p),void t.points[0].id.setFeatures(1,Aa.e_vertex,0,Aa.e_vertex)}var p=bn(Hc);pn(Zc,a/p,n,l/p,r),Bn(Kc,Zc)>c*c||(vn($c,1,Hc),xn($c,Kc)-xn($c,n)<0&&rn($c),yn($c),t.type=xa.e_faceA,on(t.localNormal,$c),on(t.localPoint,n),t.pointCount=1,on(t.points[0].localPoint,s.m_p),t.points[0].id.setFeatures(0,Aa.e_face,0,Aa.e_vertex))},th=[new qa,new qa],eh=[new qa,new qa],ih=[new qa,new qa],sh=en(0,0),oh=en(0,0),nh=en(0,0),rh=Cn(0,0,0),ah=en(0,0),lh=en(0,0),ch=en(0,0),hh=en(0,0),mh=en(0,0),uh=en(0,0),_h=en(0,0),ph=en(0,0);function dh(t,e,i,s,o){var n=t.m_count,r=i.m_count,a=t.m_normals,l=t.m_vertices,c=i.m_vertices;In(rh,s,e);for(var h=0,m=-1/0,u=0;u<n;++u){wn(nh,rh.q,a[u]),Mn(oh,rh,l[u]);for(var _=1/0,p=0;p<r;++p){var d=xn(nh,c[p])-xn(nh,oh);d<_&&(_=d)}_>m&&(m=_,h=u)}o.maxSeparation=m,o.bestIndex=h}Ml.addType(Gl.TYPE,Gl.TYPE,(function(t,e,i,s,o,n,r){fh(t,i.getShape(),e,n.getShape(),o)}));var yh={maxSeparation:0,bestIndex:0},fh=function(t,e,i,s,o){t.pointCount=0;var n=e.m_radius+s.m_radius;dh(e,i,s,o,yh);var r=yh.bestIndex,a=yh.maxSeparation;if(!(a>n)){dh(s,o,e,i,yh);var l=yh.bestIndex,c=yh.maxSeparation;if(!(c>n)){var h,m,u,_,p,d;c>a+.1*Ro.linearSlop?(h=s,m=e,u=o,_=i,p=l,t.type=xa.e_faceB,d=!0):(h=e,m=s,u=i,_=o,p=r,t.type=xa.e_faceA,d=!1),th[0].recycle(),th[1].recycle(),function(t,e,i,s,o,n){var r,a,l,c,h,m,u,_,p=e.m_normals,d=o.m_count,y=o.m_vertices,f=o.m_normals;r=ph,a=n.q,l=i.q,c=p[s],h=a.c*c.x+a.s*c.y,m=-a.s*c.x+a.c*c.y,u=l.c*h-l.s*m,_=l.s*h+l.c*m,r.x=u,r.y=_;for(var v=0,g=1/0,x=0;x<d;++x){var b=xn(ph,f[x]);b<g&&(g=b,v=x)}var A=v,B=A+1<d?A+1:0;Mn(t[0].v,n,y[A]),t[0].id.setFeatures(s,Aa.e_face,A,Aa.e_vertex),Mn(t[1].v,n,y[B]),t[1].id.setFeatures(s,Aa.e_face,B,Aa.e_vertex)}(th,h,u,p,m,_);var y=h.m_count,f=h.m_vertices,v=p,g=p+1<y?p+1:0;on(ah,f[v]),on(lh,f[g]),cn(ch,lh,ah),yn(ch),fn(hh,ch,1),pn(mh,.5,ah,.5,lh),wn(uh,u.q,ch),fn(_h,uh,1),Mn(ah,u,ah),Mn(lh,u,lh);var x=xn(_h,ah),b=-xn(uh,ah)+n,A=xn(uh,lh)+n;if(!(eh[0].recycle(),eh[1].recycle(),ih[0].recycle(),ih[1].recycle(),sn(sh,-uh.x,-uh.y),Ea(eh,th,sh,b,v)<2||(sn(sh,uh.x,uh.y),Ea(ih,eh,sh,A,g)<2))){on(t.localNormal,hh),on(t.localPoint,mh);for(var B=0,w=0;w<ih.length;++w)if(xn(_h,ih[w].v)-x<=n){var V=t.points[B];Pn(V.localPoint,_,ih[w].v),V.id.set(ih[w].id),d&&V.id.swapFeatures(),++B}t.pointCount=B}}}};Ml.addType(Gl.TYPE,ec.TYPE,(function(t,e,i,s,o,n,r){xh(t,i.getShape(),e,n.getShape(),o)}));var vh=en(0,0),gh=en(0,0),xh=function(t,e,i,s,o){t.pointCount=0,zn(vh,o,i,s.m_p);for(var n=0,r=-1/0,a=e.m_radius+s.m_radius,l=e.m_count,c=e.m_vertices,h=e.m_normals,m=0;m<l;++m){var u=xn(h[m],vh)-xn(h[m],c[m]);if(u>a)return;u>r&&(r=u,n=m)}var _=n,p=_+1<l?_+1:0,d=c[_],y=c[p];if(r<Co)return t.pointCount=1,t.type=xa.e_faceA,on(t.localNormal,h[n]),pn(t.localPoint,.5,d,.5,y),on(t.points[0].localPoint,s.m_p),void t.points[0].id.setFeatures(0,Aa.e_vertex,0,Aa.e_vertex);var f=xn(vh,y)-xn(vh,d)-xn(d,y)+xn(d,d),v=xn(vh,d)-xn(vh,y)-xn(y,d)+xn(y,y);if(f<=0){if(Bn(vh,d)>a*a)return;t.pointCount=1,t.type=xa.e_faceA,cn(t.localNormal,vh,d),yn(t.localNormal),on(t.localPoint,d),on(t.points[0].localPoint,s.m_p),t.points[0].id.setFeatures(0,Aa.e_vertex,0,Aa.e_vertex)}else if(v<=0){if(Bn(vh,y)>a*a)return;t.pointCount=1,t.type=xa.e_faceA,cn(t.localNormal,vh,y),yn(t.localNormal),on(t.localPoint,y),on(t.points[0].localPoint,s.m_p),t.points[0].id.setFeatures(0,Aa.e_vertex,0,Aa.e_vertex)}else{if(pn(gh,.5,d,.5,y),xn(vh,h[_])-xn(gh,h[_])>a)return;t.pointCount=1,t.type=xa.e_faceA,on(t.localNormal,h[_]),on(t.localPoint,gh),on(t.points[0].localPoint,s.m_p),t.points[0].id.setFeatures(0,Aa.e_vertex,0,Aa.e_vertex)}},bh=Math.min;Ml.addType(Ll.TYPE,Gl.TYPE,(function(t,e,i,s,o,n,r){Kh(t,i.getShape(),e,n.getShape(),o)})),Ml.addType(Dl.TYPE,Gl.TYPE,(function(t,e,i,s,o,n,r){i.getShape().getChildEdge(Ch,s),Kh(t,Ch,e,n.getShape(),o)}));var Ah,Bh,wh,Vh,Ch=new Ll;(Bh=Ah||(Ah={}))[Bh.e_unknown=-1]="e_unknown",Bh[Bh.e_edgeA=1]="e_edgeA",Bh[Bh.e_edgeB=2]="e_edgeB",(Vh=wh||(wh={}))[Vh.e_isolated=0]="e_isolated",Vh[Vh.e_concave=1]="e_concave",Vh[Vh.e_convex=2]="e_convex";var Sh=function(){return function(){}}(),Mh=function(){return function(){this.vertices=[],this.normals=[],this.count=0;for(var t=0;t<Ro.maxPolygonVertices;t++)this.vertices.push(en(0,0)),this.normals.push(en(0,0))}}(),Ph=function(){function t(){this.v1=en(0,0),this.v2=en(0,0),this.normal=en(0,0),this.sideNormal1=en(0,0),this.sideNormal2=en(0,0)}return t.prototype.recycle=function(){nn(this.v1),nn(this.v2),nn(this.normal),nn(this.sideNormal1),nn(this.sideNormal2)},t}(),zh=[new qa,new qa],Ih=[new qa,new qa],Fh=[new qa,new qa],Th=new Sh,Lh=new Sh,kh=new Mh,qh=new Ph,Nh=en(0,0),Dh=en(0,0),Oh=en(0,0),jh=en(0,0),Rh=Cn(0,0,0),Eh=en(0,0),Yh=en(0,0),Jh=en(0,0),Wh=en(0,0),Uh=en(0,0),Hh=en(0,0),Gh=en(0,0),Xh=en(0,0),Kh=function(t,e,i,s,o){In(Rh,i,o),Mn(Nh,Rh,s.m_centroid);var n=e.m_vertex0,r=e.m_vertex1,a=e.m_vertex2,l=e.m_vertex3,c=e.m_hasVertex0,h=e.m_hasVertex3;cn(Oh,a,r),yn(Oh),sn(Jh,Oh.y,-Oh.x);var m,u=xn(Jh,Nh)-xn(Jh,r),_=0,p=0,d=!1,y=!1;nn(Yh),nn(Wh),c&&(cn(Dh,r,n),yn(Dh),sn(Yh,Dh.y,-Dh.x),d=gn(Dh,Oh)>=0,_=ko.dot(Yh,Nh)-ko.dot(Yh,n)),h&&(cn(jh,l,a),yn(jh),sn(Wh,jh.y,-jh.x),y=ko.crossVec2Vec2(Oh,jh)>0,p=ko.dot(Wh,Nh)-ko.dot(Wh,a)),nn(Eh),nn(Uh),nn(Hh),c&&h?d&&y?(m=_>=0||u>=0||p>=0)?(on(Eh,Jh),on(Uh,Yh),on(Hh,Wh)):(mn(Eh,-1,Jh),mn(Uh,-1,Jh),mn(Hh,-1,Jh)):d?(m=_>=0||u>=0&&p>=0)?(on(Eh,Jh),on(Uh,Yh),on(Hh,Jh)):(mn(Eh,-1,Jh),mn(Uh,-1,Wh),mn(Hh,-1,Jh)):y?(m=p>=0||_>=0&&u>=0)?(on(Eh,Jh),on(Uh,Jh),on(Hh,Wh)):(mn(Eh,-1,Jh),mn(Uh,-1,Jh),mn(Hh,-1,Yh)):(m=_>=0&&u>=0&&p>=0)?(on(Eh,Jh),on(Uh,Jh),on(Hh,Jh)):(mn(Eh,-1,Jh),mn(Uh,-1,Wh),mn(Hh,-1,Yh)):c?d?(m=_>=0||u>=0)?(on(Eh,Jh),on(Uh,Yh),mn(Hh,-1,Jh)):(mn(Eh,-1,Jh),on(Uh,Jh),mn(Hh,-1,Jh)):(m=_>=0&&u>=0)?(on(Eh,Jh),on(Uh,Jh),mn(Hh,-1,Jh)):(mn(Eh,-1,Jh),on(Uh,Jh),mn(Hh,-1,Yh)):h?y?(m=u>=0||p>=0)?(on(Eh,Jh),mn(Uh,-1,Jh),on(Hh,Wh)):(mn(Eh,-1,Jh),mn(Uh,-1,Jh),on(Hh,Jh)):(m=u>=0&&p>=0)?(on(Eh,Jh),mn(Uh,-1,Jh),on(Hh,Jh)):(mn(Eh,-1,Jh),mn(Uh,-1,Wh),on(Hh,Jh)):(m=u>=0)?(on(Eh,Jh),mn(Uh,-1,Jh),mn(Hh,-1,Jh)):(mn(Eh,-1,Jh),on(Uh,Jh),on(Hh,Jh)),kh.count=s.m_count;for(var f=0;f<s.m_count;++f)Mn(kh.vertices[f],Rh,s.m_vertices[f]),wn(kh.normals[f],Rh.q,s.m_normals[f]);var v=s.m_radius+e.m_radius;for(t.pointCount=0,Th.type=Ah.e_edgeA,Th.index=m?0:1,Th.separation=1/0,f=0;f<kh.count;++f){var g=kh.vertices[f];(x=xn(Eh,g)-xn(Eh,r))<Th.separation&&(Th.separation=x)}if(Th.type!=Ah.e_unknown&&!(Th.separation>v)){for(Lh.type=Ah.e_unknown,Lh.index=-1,Lh.separation=-1/0,sn(Gh,-Eh.y,Eh.x),f=0;f<kh.count;++f){mn(Xh,-1,kh.normals[f]);var x,b=xn(Xh,kh.vertices[f])-xn(Xh,r),A=xn(Xh,kh.vertices[f])-xn(Xh,a);if((x=bh(b,A))>v){Lh.type=Ah.e_edgeB,Lh.index=f,Lh.separation=x;break}if(xn(Xh,Gh)>=0){if(xn(Xh,Eh)-xn(Hh,Eh)<-Ro.angularSlop)continue}else if(xn(Xh,Eh)-xn(Uh,Eh)<-Ro.angularSlop)continue;x>Lh.separation&&(Lh.type=Ah.e_edgeB,Lh.index=f,Lh.separation=x)}if(!(Lh.type!=Ah.e_unknown&&Lh.separation>v)){var B;if(B=Lh.type==Ah.e_unknown?Th:Lh.separation>.98*Th.separation+.001?Lh:Th,Fh[0].recycle(),Fh[1].recycle(),B.type==Ah.e_edgeA){t.type=xa.e_faceA;var w=0,V=xn(Eh,kh.normals[0]);for(f=1;f<kh.count;++f){var C=xn(Eh,kh.normals[f]);C<V&&(V=C,w=f)}var S=w,M=S+1<kh.count?S+1:0;on(Fh[0].v,kh.vertices[S]),Fh[0].id.setFeatures(0,Aa.e_face,S,Aa.e_vertex),on(Fh[1].v,kh.vertices[M]),Fh[1].id.setFeatures(0,Aa.e_face,M,Aa.e_vertex),m?(qh.i1=0,qh.i2=1,on(qh.v1,r),on(qh.v2,a),on(qh.normal,Jh)):(qh.i1=1,qh.i2=0,on(qh.v1,a),on(qh.v2,r),mn(qh.normal,-1,Jh))}else t.type=xa.e_faceB,on(Fh[0].v,r),Fh[0].id.setFeatures(0,Aa.e_vertex,B.index,Aa.e_face),on(Fh[1].v,a),Fh[1].id.setFeatures(0,Aa.e_vertex,B.index,Aa.e_face),qh.i1=B.index,qh.i2=qh.i1+1<kh.count?qh.i1+1:0,on(qh.v1,kh.vertices[qh.i1]),on(qh.v2,kh.vertices[qh.i2]),on(qh.normal,kh.normals[qh.i1]);if(!(sn(qh.sideNormal1,qh.normal.y,-qh.normal.x),sn(qh.sideNormal2,-qh.sideNormal1.x,-qh.sideNormal1.y),qh.sideOffset1=xn(qh.sideNormal1,qh.v1),qh.sideOffset2=xn(qh.sideNormal2,qh.v2),zh[0].recycle(),zh[1].recycle(),Ih[0].recycle(),Ih[1].recycle(),Ea(zh,Fh,qh.sideNormal1,qh.sideOffset1,qh.i1)<Ro.maxManifoldPoints||Ea(Ih,zh,qh.sideNormal2,qh.sideOffset2,qh.i2)<Ro.maxManifoldPoints)){B.type==Ah.e_edgeA?(on(t.localNormal,qh.normal),on(t.localPoint,qh.v1)):(on(t.localNormal,s.m_normals[qh.i1]),on(t.localPoint,s.m_vertices[qh.i1]));var P=0;for(f=0;f<Ro.maxManifoldPoints;++f)if(xn(qh.normal,Ih[f].v)-xn(qh.normal,qh.v1)<=v){var z=t.points[P];B.type==Ah.e_edgeA?(Pn(z.localPoint,Rh,Ih[f].v),z.id.set(Ih[f].id)):(on(z.localPoint,Ih[f].v),z.id.set(Ih[f].id),z.id.swapFeatures()),++P}t.pointCount=P}}}},Zh={CollidePolygons:fh,Settings:Ro,Sweep:On,Manifold:Na,Distance:Br,TimeOfImpact:sa,DynamicTree:Ho,stats:mr},$h=Object.freeze({__proto__:null,Math:zo,Serializer:Rc,Testbed:Yc,testbed:function(t,e){var i,s;"function"==typeof t?(i=t,s=e):"function"==typeof e?(i=e,s=t):s=null!=t?t:e;var o=Yc.mount(s);if(!i)return o;var n=i(o)||o.world;o.start(n)},Vec2:ko,Vec3:Il,Mat22:Ca,Mat33:cc,Transform:jn,Rot:kn,AABB:Do,Shape:Un,FixtureProxy:Zn,Fixture:$n,Body:lr,ContactEdge:Xa,mixFriction:Ka,mixRestitution:Za,VelocityConstraintPoint:el,Contact:Ml,JointEdge:cr,Joint:hr,World:zl,CircleShape:ec,Circle:ic,EdgeShape:Ll,Edge:kl,PolygonShape:Gl,Polygon:Xl,ChainShape:Dl,Chain:Ol,BoxShape:Kl,Box:Zl,CollideCircles:Uc,CollideEdgeCircle:Qc,CollidePolygons:fh,CollidePolygonCircle:xh,CollideEdgePolygon:Kh,DistanceJoint:rc,FrictionJoint:lc,GearJoint:xc,MotorJoint:Ac,MouseJoint:Vc,PrismaticJoint:vc,PulleyJoint:Mc,RevoluteJoint:uc,RopeJoint:Ic,WeldJoint:kc,WheelJoint:Oc,Settings:jo,SettingsInternal:Ro,Sweep:On,get ManifoldType(){return xa},get ContactFeatureType(){return Aa},get PointState(){return wa},ClipVertex:qa,Manifold:Na,ManifoldPoint:Da,ContactID:Oa,WorldManifold:ja,getPointStates:Ra,clipSegmentToLine:Ea,DistanceInput:xr,DistanceOutput:br,SimplexCache:Ar,Distance:Br,DistanceProxy:wr,testOverlap:Tr,ShapeCastInput:qr,ShapeCastOutput:Nr,ShapeCast:function(t,e){t.iterations=0,t.lambda=1,t.normal.setZero(),t.point.setZero();var i=e.proxyA,s=e.proxyB,o=ur(i.m_radius,Ro.polygonRadius),n=o+ur(s.m_radius,Ro.polygonRadius),r=e.transformA,a=e.transformB,l=e.translationB,c=ko.zero(),h=0,m=new Mr;m.m_count=0;for(var u=m.m_v,_=i.getSupport(kn.mulTVec2(r.q,ko.neg(l))),p=jn.mulVec2(r,i.getVertex(_)),d=s.getSupport(kn.mulTVec2(a.q,l)),y=jn.mulVec2(a,s.getVertex(d)),f=ko.sub(p,y),v=ur(Ro.polygonRadius,n-Ro.polygonRadius),g=.5*Ro.linearSlop,x=0;x<20&&f.length()-v>g;){t.iterations+=1,_=i.getSupport(kn.mulTVec2(r.q,ko.neg(f))),p=jn.mulVec2(r,i.getVertex(_)),d=s.getSupport(kn.mulTVec2(a.q,f)),y=jn.mulVec2(a,s.getVertex(d));var b=ko.sub(p,y);f.normalize();var A=ko.dot(f,b),B=ko.dot(f,l);if(A-v>h*B){if(B<=0)return!1;if((h=(A-v)/B)>1)return!1;c.setMul(-1,f),m.m_count=0}var w=u[m.m_count];switch(w.indexA=d,w.wA=ko.combine(1,y,h,l),w.indexB=_,w.wB=p,w.w=ko.sub(w.wB,w.wA),w.a=1,m.m_count+=1,m.m_count){case 1:break;case 2:m.solve2();break;case 3:m.solve3()}if(3==m.m_count)return!1;f.setVec2(m.getClosestPoint()),++x}if(0==x)return!1;var V=ko.zero(),C=ko.zero();return m.getWitnessPoints(C,V),f.lengthSquared()>0&&(c.setMul(-1,f),c.normalize()),t.point=ko.combine(1,V,o,c),t.normal=c,t.lambda=h,t.iterations=x,!0},TOIInput:jr,get TOIOutputState(){return Lr},TOIOutput:Rr,TimeOfImpact:sa,TreeNode:Wo,DynamicTree:Ho,stats:mr,internal:Zh});function Qh(t){return t/xo.Box2D.worldScale}function tm(t){return t*xo.Box2D.worldScale}class em extends i.Scene{constructor(){super({key:"Game"}),this.textPool=[],this.textEffectPool=[],this.newBallPath=null,this.graphics=null,this.newBallPathLine=null,this.newBallNormalLine=null}create(){var t;this.add.image(xo.screen.width/2,xo.screen.height/2,"bg").setAlpha(.5).setDepth(-100),this.click=this.sound.add("click"),this.events.on("pause",(()=>{this.click.pause(),this.click.pause()})),this.audio_ball_start=this.sound.add("ball_start"),this.events.on("pause",(()=>{this.audio_ball_destroy.pause(),this.audio_ball_start.pause()})),this.audio_ball_destroy=this.sound.add("ball_destroy"),this.events.on("resume",(()=>{this.audio_ball_destroy.resume(),this.audio_ball_start.resume()})),this.ids=[],this.ballsAdded=0,this.contactManagement=[],this.emitters=[],this.dummyBalls=[],this.nextBallValueSprites=[],this.objectPool=[],this.currentState=1,this.currentBallValue=Phaser.Math.Between(0,xo.maxStartBallSize),this.nextBallValue=Phaser.Math.Between(0,xo.maxStartBallSize),this.buildEmitters(),this.world=new $h.World(new $h.Vec2(0,xo.Box2D.gravity)),this.baseStartX=this.game.config.width/2-xo.gameField.width/2,this.baseEndX=this.baseStartX+xo.gameField.width,this.baseStartY=this.game.config.height-xo.gameField.distanceFromBottom,this.baseEndY=this.baseStartY-xo.gameField.height;const e=this.baseStartX/2;this.baseEndX;const i=500;this.configTimerNewBall={callback:()=>{this.onResetProgressNewBall(),this.onCreateNewBall(this.game.input.mousePointer)},callbackScope:this,delay:xo.timerNewBall.maxTimeWait,loop:!0},this.triggerTimerNewBall=this.time.addEvent(this.configTimerNewBall),this.createPolygon(this.baseStartX,this.baseStartY,this.baseEndX,this.baseEndY),this.add.image(460,97,"crown").setTint(16776960).setAlpha(.7).setScale(.3).setDepth(10),this.add.nineslice(e-20,150,"panel",0,i,220,33,33,33,33).setTint(xo.ui.panelBgColor).setAlpha(.8);const s=this.add.nineslice(e-20,200,"panel",0,i,120,33,33,33,33).setTint(0).setAlpha(.6);this.levelText=this.add.text(e+140,170,"Level 12",{fontFamily:"Arial",fontSize:30,color:"#ffffff",stroke:"#000000",strokeThickness:1,align:"right"}).setOrigin(.5).setDepth(100),this.add.text(e+210,70,"Our record sdasd",{fontFamily:"Arial",fontSize:20,color:"#ffffff",align:"center"}).setAlpha(.5).setOrigin(1).setDepth(100),this.scoreText=this.add.text(e+200,250,null==(t=this.gameData)?void 0:t.totalScore.toString(),{fontFamily:"Arial Black",fontSize:55,color:"#ffffff",stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(1).setDepth(100),this.bestScoreText=this.add.text(e+140,130,"",{fontFamily:"Arial",fontSize:50,color:"#ffffff",stroke:"#000000",strokeThickness:0,align:"center"}).setOrigin(1).setDepth(100),this.progressScore=this.add.rectangle(e-25,220,i,200,11403055,1).setAlpha(1).setDepth(10),this.progressScore.width=0,this.progressScore.mask=new Phaser.Display.Masks.BitmapMask(this,s),this.add.text(1500,400,"Bomb",{fontFamily:"Arial",fontSize:30,color:"#ffffff",stroke:"#000000",strokeThickness:1,align:"right"}).setOrigin(.5).setDepth(100).setInteractive().on("pointerup",(()=>{this.onRefreshTree()})),this.add.nineslice(e-25,280,"panel",0,i,150+2*xo.bodies[xo.maxStartBallSize].size,33,33,33,33).setOrigin(.5,0).setTint(xo.ui.panelBgColor),this.add.rectangle(e-25,390,xo.timerNewBall.widthProgress+4,12).setFillStyle(0,.5).setDepth(1),this.progressBarNewBall=this.add.rectangle(e-175,390,xo.timerNewBall.widthProgress,8,xo.timerNewBall.progressColor).setOrigin(0,.5).setDepth(2),this.add.tileSprite(this.baseStartX+32,this.baseStartY,xo.gameField.width-64,32,"wall").setOrigin(0).setTint(xo.gameField.borderColor).setDepth(1),this.add.sprite(this.baseStartX-32,this.baseStartY-32,"angle").setOrigin(0).setFlipY(!0).setTint(xo.gameField.borderColor).setDepth(1),this.add.sprite(this.baseEndX-32,this.baseStartY-32,"angle").setOrigin(0).setFlipY(!0).setFlipX(!0).setTint(xo.gameField.borderColor).setDepth(1),this.add.tileSprite(this.baseStartX-32,this.baseEndY,32,xo.gameField.height-32,"wall").setOrigin(0).setTint(xo.gameField.borderColor).setDepth(1),this.add.tileSprite(this.baseEndX,this.baseEndY,32,xo.gameField.height-32,"wall").setOrigin(0).setTint(xo.gameField.borderColor).setDepth(1),this.rectGameArea=this.add.rectangle(this.baseStartX,this.baseEndY,xo.gameField.width,xo.gameField.height,0,.5).setOrigin(0).setDepth(-2),this.rectGameArea.setInteractive(),this.ship=this.add.sprite(0,0,"ship").setScale(.9).setAlpha(.8).setTint(3355443).setInteractive(),this.shipContainer=this.add.container(xo.screen.width/2,xo.gameField.y-xo.bodies[xo.maxStartBallSize].size,[this.ship]);const o=this.add.sprite(0,0,"arrowdownup").setScale(.1).setAlpha(.8).setTint(3355443),n=this.add.circle(0,0,150,16777215,1).setScale(.2).setAlpha(.8).setInteractive({useHandCursor:!0});this.rotator=this.add.container(xo.screen.width/2,xo.gameField.y-xo.bodies[xo.maxStartBallSize].size,[n,o]).setDepth(100).setAlpha(.1),n.on("pointerover",(()=>{this.rotator.setAlpha(1)})),n.on("pointerout",(()=>{this.rotator.setAlpha(.1)})),n.on("pointerup",(()=>{this.onRotateNewBall()}));for(let r=0;r<=xo.maxStartBallSize;r++){const t=this.add.sprite(0,0,"ball"),e=this.add.container(0,xo.gameField.ballY,t);e.add(t),e.setAlpha(1),e.setVisible(!1),t.setDisplaySize(2*xo.bodies[r].size,2*xo.bodies[r].size),t.setTint(xo.bodies[r].color);const i=this.add.text(0,0,xo.bodies[r].score,{fontFamily:"Arial Black",fontSize:xo.bodies[r].textSize,color:xo.bodies[r].textColor,stroke:"#000000",strokeThickness:4,align:"center"}).setDepth(100).setOrigin(.5);e.add(i),this.dummyBalls.push(e);const s=this.add.sprite(0,0,"ball"),o=this.add.container(0,xo.gameField.ballY-xo.bodies[this.currentBallValue].size-xo.bodies[this.nextBallValue].size,s),n=this.add.text(0,0,xo.bodies[r].score,{fontFamily:"Arial Black",fontSize:xo.bodies[r].textSize,color:xo.bodies[r].textColor,stroke:"#000000",strokeThickness:4,align:"center"}).setDepth(100).setAlpha(.5).setOrigin(.5);o.add(n),o.setVisible(!1),s.setTint(xo.bodies[r].color),s.setDisplaySize(2*xo.bodies[r].size,2*xo.bodies[r].size),s.setData({text:n}),this.nextBallValueSprites.push(o)}this.dummyBalls[this.currentBallValue].setVisible(!0),this.nextBallValueSprites[this.nextBallValue].setVisible(!0),this.shipContainer.add([this.dummyBalls[this.currentBallValue],this.nextBallValueSprites[this.nextBallValue]]),this.graphics=this.add.graphics({lineStyle:{width:2,color:xo.ui.pathColor}}),this.newBallPathLine=new Phaser.Geom.Line(this.baseStartX,xo.gameField.y+xo.bodies[this.currentBallValue].size,this.baseStartX,xo.gameField.height+xo.bodies[this.currentBallValue].size+xo.gameField.y+50),this.newBallNormalLine=new Phaser.Geom.Line(this.baseStartX,xo.gameField.height+xo.bodies[this.currentBallValue].size+xo.gameField.y+50,this.baseStartX,(xo.gameField.y+xo.bodies[this.currentBallValue].size)/2),this.newBallPath=this.add.rectangle(this.baseStartX-xo.bodies[this.currentBallValue].size,xo.gameField.y+xo.bodies[this.currentBallValue].size,2*xo.bodies[this.currentBallValue].size,xo.gameField.height+xo.bodies[this.currentBallValue].size+xo.gameField.y+50,16773077,.1).setOrigin(0).setDepth(-1),this.newBallPath.setInteractive().setVisible(!1),this.newBallPath.on("pointerup",this.onCreateNewBall,this),this.rectGameArea.on("pointerup",this.onCreateNewBall,this),this.input.on("pointermove",(t=>{var e;const i=Phaser.Math.Clamp(t.x,this.baseStartX+xo.bodies[this.currentBallValue].size,this.baseEndX-xo.bodies[this.currentBallValue].size);this.shipContainer.setX(i),this.rotator.setX(i),null==(e=this.newBallPath)||e.setX(i-xo.bodies[this.currentBallValue].size),this.world.rayCast($h.Vec2(Qh(i),Qh(xo.gameField.y+xo.bodies[this.currentBallValue].size+10)),$h.Vec2(Qh(i),Qh(xo.screen.height)),((t,e,s,o)=>{var n=t.getBody().getUserData();return n&&0===n?0:(this.redrawPath(i,s,e),o)}))})),this.world.on("pre-solve",(t=>{const e=t.getFixtureA().getBody().getUserData(),i=t.getFixtureB().getBody().getUserData(),s=t.getWorldManifold(null).points[0];0==e.type&&0==i.type&&e.value==i.value&&-1==this.ids.indexOf(e.id)&&-1==this.ids.indexOf(i.id)&&(this.ids.push(e.id),this.ids.push(i.id),this.contactManagement.push({body1:t.getFixtureA().getBody(),body2:t.getFixtureB().getBody(),point:s,value:e.value+1,id1:e.id,id2:i.id}),this.audio_ball_destroy.play())})),this.input.keyboard.on("keyup-SPACE",(()=>this.onRotateNewBall())),vo.emit("start-create",!0),vo.emit("current-scene-ready",this)}changeScene(){this.scene.start("GameOver")}redrawPath(t,e,i){this.graphics.clear(),this.graphics.setVisible(!0);const s=xo.gameField.y+xo.bodies[this.currentBallValue].size,o=tm(i.x),n=tm(i.y);this.newBallPathLine.setFromObjects(new Phaser.Math.Vector2(t,s),new Phaser.Math.Vector2(o,n)),this.graphics.strokeLineShape(this.newBallPathLine);var r=$h.Vec2.combine(1,i,2,e);this.newBallNormalLine.setFromObjects(new Phaser.Math.Vector2(o,n),new Phaser.Math.Vector2(tm(r.x),tm(r.y))),this.graphics.strokeLineShape(this.newBallNormalLine),this.newBallPath.setVisible(!0),this.newBallPath.height=n-s+2*xo.bodies[this.currentBallValue].size,this.newBallPath.width=2*xo.bodies[this.currentBallValue].size}onSetGameData(t){this.gameData=JSON.parse(JSON.stringify(t)),this.onSetScore(),this.gameData.tree&&this.gameData.tree.length>0&&this.gameData.tree.forEach(((t,e)=>{this.time.addEvent({delay:100,callback:()=>{t.v<xo.bodies.length&&this.createBall(tm(t.x),tm(t.y),t.v,t.a)}})}))}onRotateNewBall(){0!=this.currentState&&2!=this.currentState&&(this.currentState=2,this.graphics.setVisible(!1),this.newBallPath.setVisible(!1),this.add.tween({targets:this.dummyBalls[this.currentBallValue],y:{value:xo.gameField.ballY-xo.bodies[this.currentBallValue].size-xo.bodies[this.nextBallValue].size,duration:350,ease:"Back.linear"},onComplete:()=>{this.dummyBalls[this.currentBallValue].x;const t=this.currentBallValue,e=this.nextBallValue;this.nextBallValue=t,this.currentBallValue=e,this.shipContainer.remove(this.dummyBalls[t]),this.shipContainer.remove(this.nextBallValueSprites[e]),this.dummyBalls[t].setVisible(!1),this.nextBallValueSprites[e].setVisible(!1),this.dummyBalls[this.currentBallValue].setY(xo.gameField.ballY),this.dummyBalls[this.currentBallValue].setVisible(!0),this.nextBallValueSprites[this.nextBallValue].setY(xo.gameField.ballY-xo.bodies[this.currentBallValue].size-xo.bodies[this.nextBallValue].size),this.nextBallValueSprites[this.nextBallValue].setVisible(!0),this.shipContainer.add(this.dummyBalls[this.currentBallValue]),this.shipContainer.add(this.nextBallValueSprites[this.nextBallValue]),this.currentState=1}}),this.add.tween({targets:this.nextBallValueSprites[this.nextBallValue],y:{value:xo.gameField.ballY,duration:300,ease:"Back.linear"},onComplete:()=>{}}))}onCreateNewBall(t){2!=this.currentState&&(this.onResetProgressNewBall(),1==this.currentState&&(this.currentState=0,this.graphics.setVisible(!1),this.newBallPath.setVisible(!1),this.shipContainer.remove(this.dummyBalls[this.currentBallValue]),this.dummyBalls[this.currentBallValue].setVisible(!1),this.add.tween({targets:this.nextBallValueSprites[this.nextBallValue],y:{value:xo.gameField.ballY,duration:xo.idleTime-50,ease:"Back.linear"},onComplete:()=>{}}),this.audio_ball_start.play(),this.createBall(Phaser.Math.Clamp(t.x,this.baseStartX+xo.bodies[this.currentBallValue].size,this.baseEndX-xo.bodies[this.currentBallValue].size),xo.gameField.y,this.currentBallValue),this.time.addEvent({delay:xo.idleTime,callback:()=>{this.currentState=1,this.currentBallValue=this.nextBallValue,this.nextBallValue=Phaser.Math.Between(0,xo.maxStartBallSize),this.dummyBalls[this.currentBallValue].setVisible(!0),this.shipContainer.add(this.dummyBalls[this.currentBallValue]),this.nextBallValueSprites[this.currentBallValue].setVisible(!1),this.dummyBalls[this.currentBallValue].setY(xo.gameField.ballY),this.nextBallValueSprites[this.nextBallValue].setY(xo.gameField.ballY-xo.bodies[this.currentBallValue].size-xo.bodies[this.nextBallValue].size),this.nextBallValueSprites[this.nextBallValue].setVisible(!0),this.shipContainer.add(this.nextBallValueSprites[this.nextBallValue])}})))}buildEmitters(){xo.bodies.forEach(((t,e)=>{const i=this.make.graphics({x:0,y:0},!1);i.fillStyle(16777215),i.fillCircle(t.particleSize,t.particleSize,t.particleSize),i.generateTexture("particle_"+e.toString(),2*t.particleSize,2*t.particleSize);let s=this.add.particles(0,0,"particle_"+e.toString(),{lifespan:500,speed:{min:0,max:50},scale:{start:1,end:0},emitting:!1});s.addEmitZone({source:new Phaser.Geom.Circle(0,0,t.size),type:"random",quantity:1}),s.setDepth(1),this.emitters.push(s)}))}createBall(t,e,i,s=0){var o;let n,r;(null==(o=this.objectPool)?void 0:o.length)>1e5?(n=this.objectPool.pop().ball,n.setVisible(!0)):n=this.add.sprite(t,e,"ball"),r=this.add.text(t,e,xo.bodies[i].score,{fontFamily:"Arial Black",fontSize:xo.bodies[i].textSize,color:xo.bodies[i].textColor,stroke:"#000000",strokeThickness:3,align:"center"}).setDepth(100).setOrigin(.5).setAlpha(.8),r.setVisible(!0),n.setDisplaySize(2*xo.bodies[i].size,2*xo.bodies[i].size),n.setTint(xo.bodies[i].color),Phaser.Math.Between(0,8);const a=this.world.createDynamicBody({position:new $h.Vec2(Qh(t),Qh(e)),type:"dynamic",angle:s});a.createFixture(new $h.Circle(Qh(xo.bodies[i].size)),{friction:.3,density:1,restitution:.2}),a.setLinearVelocity(new $h.Vec2(0,this.progressScore.width/500*100)),a.setUserData({sprite:n,type:0,value:i,id:this.ballsAdded,text:r}),this.ballsAdded++}createPolygon(t,e,i,s){const o=this.world.createBody({position:new $h.Vec2(Qh(0),Qh(0))});o.createFixture($h.Chain([$h.Vec2(Qh(t),Qh(s)),$h.Vec2(Qh(t),Qh(e)),$h.Vec2(Qh(i),Qh(e)),$h.Vec2(Qh(i),Qh(s))])),o.setUserData({type:1}),this.polygon2D=o}destroyBall(t){const e=t.getUserData();e.sprite.setVisible(!1),e.text.setVisible(!1),this.objectPool.push({ball:e.sprite,face:e.face,text:e.text}),this.world.destroyBody(t),this.ids.splice(this.ids.indexOf(e.id),1)}onLevelCompleted(){const t=this.game.scene.getScene("NextLevel");this.scene.pause(),t.scene.start()}onGameOver(){const t=this.game.scene.getScene("GameOver");this.scene.pause(),t.scene.start()}onNewGame(){const t=this.time.addEvent({delay:10,callback:e=>{let i=this.world.getBodyList();0==i.getUserData().type?this.destroyBall(i):(t.remove(),this.gameData.level=0,this.gameData.score=0,this.gameData.totalScore=0,this.onNewLevel())},loop:!0})}onContinueGame(){const t=this.time.addEvent({delay:10,callback:e=>{let i=this.world.getBodyList();0==i.getUserData().type?this.destroyBall(i):t.remove()},loop:!0})}onNewLevel(){this.gameData.totalScore+=this.gameData.score,this.gameData.level++,this.gameData.score=0,this.gameData.levelScore=1e3,this.onSetScore(),console.log("onNewLevel: ",this.gameData),setTimeout((()=>{const t=[];for(let e=this.world.getBodyList();e;e=e.getNext()){const i=e.getUserData();if(void 0!==i.value){const s=e.getPosition();t.push({x:Number(s.x.toFixed(1)),y:Number(s.y.toFixed(1)),v:null==i?void 0:i.value,a:Number(e.getAngle().toFixed(1))})}}this.gameData.tree=t,vo.emit("save-data",this.gameData)}),1e3)}updateScore(t){this.gameData.score+=xo.bodies[t].score,this.gameData.totalScore>this.gameData.bestScore&&(this.gameData.bestScore=this.gameData.totalScore),this.onSetScore()}onSetScore(){var t,e;this.scoreText.setText(this.gameData.score.toString()),this.bestScoreText.setText(this.gameData.bestScore.toString()),this.levelText.setText(`Level ${this.gameData.level}`);const i=500/((null==(t=this.gameData)?void 0:t.levelScore)||1e5)*(null==(e=this.gameData)?void 0:e.score);this.tweenProgressScore&&this.tweenProgressScore.destroy(),this.tweenProgressScore=this.add.tween({targets:this.progressScore,width:{value:i,duration:200,ease:"Back.linear"},onComplete:()=>{this.gameData.score>=this.gameData.levelScore&&this.onLevelCompleted()}})}onRefreshTree(){this.add.tween({targets:this.rectGameArea,width:{value:500,duration:1200,ease:"Back.linear"},onComplete:()=>{}})}update(t,e){if(this.progressBarNewBall.width=xo.timerNewBall.widthProgress*(this.triggerTimerNewBall.elapsed/xo.timerNewBall.maxTimeWait),this.world.step(e/1e3,10,8),this.world.clearForces(),this.contactManagement.length>0&&(this.contactManagement.forEach((t=>{this.emitters[t.value-1].explode(50*t.value,tm(t.body1.getPosition().x),tm(t.body1.getPosition().y)),this.emitters[t.value-1].explode(50*t.value,tm(t.body2.getPosition().x),tm(t.body2.getPosition().y)),this.time.addEvent({delay:10,callback:()=>{this.updateScore(t.value-1),this.destroyBall(t.body1),this.destroyBall(t.body2)}});const e=new $h.AABB(new $h.Vec2(t.point.x-Qh(xo.blast.radius),t.point.y-Qh(xo.blast.radius)),new $h.Vec2(t.point.x+Qh(xo.blast.radius),t.point.y+Qh(xo.blast.radius)));if(this.world.queryAABB(e,(e=>{const i=e.getBody(),s=i.getPosition();Math.sqrt(Math.pow(s.x-t.point.x,2)+Math.pow(s.y-t.point.y,2));const o=Math.atan2(s.y-t.point.y,s.x-t.point.x);return i.setLinearVelocity(new $h.Vec2(xo.blast.impulse*Math.cos(o),xo.blast.impulse*Math.sin(o))),!0})),this.time.addEvent({delay:100,callback:()=>{if(t.value<xo.bodies.length){this.createBall(tm(t.point.x),tm(t.point.y),t.value);const e=this.add.text(tm(t.point.x),tm(t.point.y),`+${xo.bodies[t.value-1].score}`,{fontFamily:"Arial Black",fontSize:50,color:"#ffffff",stroke:"#ffffff",align:"center"}).setDepth(100).setOrigin(.5);this.textPool.push(e)}}}),this.textPool.length>1){const e=this.add.text(tm(t.point.x),tm(t.point.y),`x${this.textPool.length}`,{fontFamily:"Arial Black",fontSize:50,color:"#6530ac",stroke:"#6530ac",align:"center"}).setDepth(100).setOrigin(.5);this.textEffectPool.push(e),console.log("combo=",this.textEffectPool.length)}})),this.contactManagement=[]),this.textPool.length>0){const t=[];this.textPool.forEach((e=>{e.y-=2,e.setAlpha(e.alpha-.005),e.alpha<=0&&(e.destroy(),t.push(e))})),this.textPool=this.textPool.filter((e=>!t.includes(e)))}if(this.textEffectPool.length>0){const t=[];this.textEffectPool.forEach((e=>{e.y-=1,e.setFontSize(Number(e.style.fontSize.toString().replace("px",""))+1),e.setAlpha(e.alpha-.008),e.alpha<=0&&(e.destroy(),t.push(e))})),this.textEffectPool=this.textEffectPool.filter((e=>!t.includes(e)))}for(let i=this.world.getBodyList();i;i=i.getNext()){const t=i.getUserData();if(0==t.type){const e=i.getPosition(),s=i.getAngle();t.sprite.setPosition(tm(e.x),tm(e.y)),t.sprite.setRotation(s),t.text.setPosition(tm(e.x),tm(e.y)),t.text.setRotation(s);const o=this.game.config.height;t.sprite.y>o&&3!=this.currentState&&(this.currentState=3,this.dummyBalls[this.currentBallValue].setVisible(!1),this.onGameOver())}}}onResetProgressNewBall(){this.triggerTimerNewBall.reset(this.configTimerNewBall),this.progressBarNewBall.width=xo.timerNewBall.widthProgress}}class im extends Phaser.GameObjects.Text{constructor(t,e,i,s,o){super(t,e,i,s,o),this.setInteractive({useHandCursor:!0})}}class sm extends i.Scene{constructor(){super("GameOver")}create(){this.game_over=this.sound.add("game_over"),this.events.on("pause",(()=>{this.game_over.pause(),this.game_over.pause()}));const t=this.add.rectangle(xo.screen.width/2,xo.screen.height/2,xo.screen.width,xo.screen.height,0,.9).setInteractive();this.text=this.add.text(xo.screen.width/2,250,"Game Over",{fontFamily:"Arial Black",fontSize:0,color:xo.ui.dangerText,stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5).setDepth(100);const e=this.add.nineslice(0,240,"panel",0,500,200,33,33,33,33).setTint(xo.ui.buttonBgColor).setAlpha(1),i=this.add.nineslice(0,240,"panel",0,500,200,33,33,33,33).setTint(xo.ui.buttonBgColor).setAlpha(.1).setDepth(1e3).setInteractive({useHandCursor:!0});this.newButton=new im(this,0,240,"New game",{fontFamily:"Arial Black",fontSize:50,color:"#ffffff",stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5),i.on("pointerover",(()=>{e.setSize(e.width+5,e.height+5),this.newButton.setFontSize(Number(this.newButton.style.fontSize.toString().replace("px",""))+2),this.newButton.setTint(xo.ui.activeTextNumber)})),i.on("pointerout",(()=>{e.setSize(e.width-5,e.height-5),this.newButton.setFontSize(Number(this.newButton.style.fontSize.toString().replace("px",""))-2),this.newButton.setTint(16777215)})),i.on("pointerup",(t=>this.onClickNew(t)));const s=this.add.nineslice(0,0,"panel",0,500,200,33,33,33,33).setTint(xo.ui.buttonBgColor).setAlpha(1),o=this.add.nineslice(0,0,"panel",0,500,200,33,33,33,33).setTint(xo.ui.buttonBgColor).setAlpha(.1).setDepth(1e4).setInteractive({useHandCursor:!0});this.nextButton=new im(this,0,0,"Continue by view adv",{fontFamily:"Arial Black",fontSize:50,color:"#ffffff",stroke:"#000000",strokeThickness:3,align:"center",wordWrap:{width:450,useAdvancedWrap:!0}}).setOrigin(.5),this.continueButton=this.add.container(xo.screen.width/2,500,[s,this.nextButton,o,e,this.newButton,i]).setDepth(1e3),o.on("pointerover",(()=>{s.setSize(s.width+5,s.height+5),this.nextButton.setFontSize(Number(this.nextButton.style.fontSize.toString().replace("px",""))+2),this.nextButton.setTint(xo.ui.activeTextNumber)})),o.on("pointerout",(()=>{s.setSize(s.width-5,s.height-5),this.nextButton.setFontSize(Number(this.nextButton.style.fontSize.toString().replace("px",""))-2),this.nextButton.setTint(16777215)})),o.on("pointerup",(t=>this.onClickContinue(t))),this.panel=this.add.container(0,0,[t,this.text]),this.click=this.sound.add("click"),this.events.on("pause",(()=>{this.click.pause(),this.click.pause()})),this.game_over.play(),this.logoTween=this.tweens.addCounter({from:10,to:100,duration:300,onUpdate:t=>{this.text.setFontSize(t.getValue())}}),vo.emit("current-scene-ready",this)}onClickNew(t){this.click.play(),this.tweens.addCounter({from:100,to:0,duration:300,onUpdate:t=>{this.text.setFontSize(t.getValue())},onComplete:()=>{this.panel.setVisible(!1),this.continueButton.setVisible(!1),this.newButton.setVisible(!1)}});const e=this.game.scene.getScene("Game");null==e||e.scene.resume(),this.scene.get("Game").onNewGame()}onClickContinue(t){this.click.play(),this.tweens.addCounter({from:100,to:0,duration:300,onUpdate:t=>{this.text.setFontSize(t.getValue())},onComplete:()=>{this.panel.setVisible(!1),this.continueButton.setVisible(!1),this.newButton.setVisible(!1)}});const e=this.game.scene.getScene("Game");null==e||e.scene.resume(),this.scene.get("Game").onContinueGame()}changeScene(){this.scene.start("Game")}}class om extends i.Scene{constructor(){var e,i;super("MainMenu"),((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(this,"symbol"!=typeof(e="logoTween")?e+"":e,i)}create(){this.add.image(512,384,"background"),this.logo=this.add.image(512,300,"logo").setDepth(100),this.add.text(512,460,"Main Menu",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setDepth(100).setOrigin(.5),vo.emit("current-scene-ready",this)}changeScene(){this.logoTween&&(this.logoTween.stop(),this.logoTween=null),this.scene.start("Game")}moveLogo(t){this.logoTween?this.logoTween.isPlaying()?this.logoTween.pause():this.logoTween.play():this.logoTween=this.tweens.add({targets:this.logo,x:{value:750,duration:3e3,ease:"Back.easeInOut"},y:{value:80,duration:1500,ease:"Sine.easeOut"},yoyo:!0,repeat:-1,onUpdate:()=>{t({x:Math.floor(this.logo.x),y:Math.floor(this.logo.y)})}})}}class nm extends i.Scene{constructor(){super("Preloader")}init(){this.cameras.main.setBackgroundColor(328965),this.add.rectangle(xo.screen.width/2,xo.screen.height/2,468,32).setStrokeStyle(1,16777215);const t=this.add.rectangle(xo.screen.width/2-230,xo.screen.height/2,4,28,16777215);this.load.on("progress",(e=>{t.width=4+460*e}))}preload(){this.load.setPath("assets"),this.load.atlas("flares","particles/flares.png","particles/flares.json"),this.load.image("logo","logo.png"),this.load.image("star","star.png"),this.load.image("bg","img/bg5.png"),this.load.image("ball","img/ball3.png"),this.load.image("panel","img/panel2.png"),this.load.image("wall","img/wall.png"),this.load.image("angle","img/angle.png"),this.load.image("crown","img/crown.png"),this.load.image("ship","img/ship.png"),this.load.image("rotate","img/rotate.png"),this.load.image("arrowdownup","img/arrowdownup.png"),this.load.spritesheet("faces","img/faces.png",{frameWidth:45,frameHeight:25}),this.load.spritesheet("sound","img/sound.png",{frameWidth:256,frameHeight:256}),this.load.spritesheet("play","img/play.png",{frameWidth:256,frameHeight:256}),this.load.spritesheet("button","img/button2.png",{frameWidth:88,frameHeight:88}),this.load.bitmapFont("font","img/fonts.png","img/fonts.fnt"),this.load.audio("ball_start",["audio/najatie-na-kompyuternuyu-knopku1.mp3"]),this.load.audio("ball_destroy",["audio/ischeznovenie-inoplanetyan.mp3"]),this.load.audio("click",["audio/click.mp3"]),this.load.audio("level_complete",["audio/level_completed.mp3"]),this.load.audio("game_over",["audio/game_over.mp3"])}create(){this.scene.start("Game"),this.scene.start("Control")}}class rm extends Phaser.GameObjects.Sprite{constructor(t,e,i,s,o=0){super(t,e,i,s,o),this.setInteractive({useHandCursor:!0})}}class am extends i.Scene{constructor(){super("Control")}create(){this.click=this.sound.add("click"),this.events.on("pause",(()=>{this.click.pause(),this.click.pause()})),this.textPause=this.add.text(xo.screen.width/2,xo.screen.height/2,"Test",{fontFamily:"Arial Black",fontSize:50,color:"#ffffff",stroke:"#ffffff",align:"center"}).setDepth(1e3).setOrigin(.5),this.textPanel=this.add.rectangle(xo.screen.width/2,xo.screen.height/2,xo.screen.width,xo.screen.height,0,.9),this.add.nineslice(1660,50,"panel",0,500,150,33,33,33,33).setTint(xo.ui.panelBgColor).setOrigin(.5,0).setAlpha(.8),this.pauseButton=new rm(this,1480,60,"play").setScale(.5).setOrigin(.5,0).setDepth(100),this.add.existing(this.pauseButton),this.pauseButton.on("pointerup",(()=>{this.click.play(),this.scene.isPaused("Game")?(console.log("Pause off"),this.scene.resume("Game"),this.pauseButton.setFrame(0),this.tooglePanel(!1)):(console.log("Pause on"),this.scene.pause("Game"),this.pauseButton.setFrame(1),this.tooglePanel(!0),this.textPause.setText("Pause"))})),this.settingButton=new rm(this,1820,this.pauseButton.y,"sound").setScale(.5).setOrigin(.5,0).setDepth(100),this.add.existing(this.settingButton),this.settingButton.on("pointerup",(()=>{this.click.play(),this.game.sound.mute=!this.game.sound.mute})),this.tooglePanel(!1),vo.emit("current-scene-ready",this)}update(){this.game.sound.mute?(this.settingButton.setTint(7829367),this.settingButton.setFrame(0)):(this.settingButton.setTint(16777215),this.settingButton.setFrame(1))}tooglePanel(t){var e,i;null==(e=this.textPause)||e.setVisible(t),null==(i=this.textPanel)||i.setVisible(t)}}class lm extends i.Scene{constructor(){super("NextLevel")}create(){this.level_complete=this.sound.add("level_complete"),this.events.on("pause",(()=>{this.level_complete.pause(),this.level_complete.pause()}));const t=this.add.rectangle(xo.screen.width/2,xo.screen.height/2,xo.screen.width,xo.screen.height,0,.9).setInteractive();this.text=this.add.text(xo.screen.width/2,200,"Level completed",{fontFamily:"Arial Black",fontSize:0,color:"#ADFF2F",stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5).setDepth(100),this.nextButton=new rm(this,xo.screen.width/2,500,"play").setScale(.7).setOrigin(.5,0).setDepth(100).setFrame(1).setInteractive(),this.nextButton.on("pointerup",(t=>this.onClickNext(t))),this.panel=this.add.container(0,0,[t,this.text,this.nextButton]),this.click=this.sound.add("click"),this.events.on("pause",(()=>{this.click.pause(),this.click.pause()})),this.level_complete.play(),this.logoTween=this.tweens.addCounter({from:10,to:100,duration:300,onUpdate:t=>{this.text.setFontSize(t.getValue())}}),vo.emit("current-scene-ready",this)}onClickNext(t){this.click.play(),this.tweens.addCounter({from:100,to:0,duration:300,onUpdate:t=>{this.text.setFontSize(t.getValue())},onComplete:()=>{this.panel.setVisible(!1)}});const e=this.game.scene.getScene("Game");null==e||e.scene.resume(),this.scene.get("Game").onNewLevel()}changeScene(){this.scene.start("MainMenu")}}const cm={mode:e.Scale.FIT,autoCenter:e.Scale.CENTER_BOTH,parent:"game-container",width:xo.screen.width,height:xo.screen.height},hm={type:e.AUTO,backgroundColor:2236962,scale:cm,scene:[go,nm,om,em,sm,am,lm],audio:{disableWebAudio:!0}},mm={id:"game-container"},um={__name:"PhaserGame",emits:["current-active-scene","save-data","start-create"],setup(t,{expose:i,emit:s}){const o=de(),n=de(),r=s;return di((()=>{n.value=("game-container",new e.Game({...hm,parent:"game-container"})),vo.on("current-scene-ready",(t=>{r("current-active-scene",t),o.value=t})),vo.on("save-data",(t=>{r("save-data",t)})),vo.on("start-create",(t=>{r("start-create",t)}))})),gi((()=>{n.value&&(n.value.destroy(!0),n.value=null)})),i({scene:o,game:n}),(t,e)=>(ys(),xs("div",mm))}},_m=Cs("div",{class:"panel"},null,-1),pm=ni({__name:"App",setup(t,{expose:e}){const i=de();de({});const s=de(null),o=t=>{s.value=t},n=t=>{!function(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch{return!1}}(xo.localStorageName,t),s.value=t};e({onSetGameData:o,callbackSaveGameData:()=>{}}),di((()=>{const t=function(t,e){let i;try{i=JSON.parse(localStorage.getItem(t))}catch{i=null}return null==i?{bestScore:0,level:1,score:0,levelScore:100}:i}(xo.localStorageName);o(t)}));const r=de();de({x:0,y:0});const a=t=>{i.value="MainMenu"!==t.scene.key},l=()=>{const t=ae(r.value),e=ae(t.game.scene.getScene("Game"));e&&e.onSetGameData(ae(s.value))};return(t,e)=>(ys(),xs(hs,null,[s.value?(ys(),bs(um,{key:0,ref_key:"phaserRef",ref:r,onCurrentActiveScene:a,onSaveData:n,onStartCreate:l},null,512)):zs("",!0),_m],64))}});window.game=((...t)=>{const e=(fo||(fo=ns(yo))).createApp(...t),{mount:i}=e;return e.mount=t=>{const s=function(t){return v(t)?document.querySelector(t):t}(t);if(!s)return;const o=e._component;f(o)||o.render||o.template||(o.template=s.innerHTML),s.innerHTML="";const n=i(s,!1,function(t){return t instanceof SVGElement?"svg":"function"==typeof MathMLElement&&t instanceof MathMLElement?"mathml":void 0}(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),n},e})(pm).mount("#app");
